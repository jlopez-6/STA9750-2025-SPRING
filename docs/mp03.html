<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jocely Lopez Luna">

<title>The Ultimate Playlist: Valence Synth Wave – STA9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5732d83e2b6a4d0ea9313647c5a03cb2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA9750 Submission Material</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp01.html"> 
<span class="menu-text">CATS Payroll Report</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp02.html"> 
<span class="menu-text">GTA IV 2025 Greenies</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./mp03.html" aria-current="page"> 
<span class="menu-text">The Ultimate Playlist</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#nomination" id="toc-nomination" class="nav-link active" data-scroll-target="#nomination">Nomination</a>
  <ul class="collapse">
  <li><a href="#tracklist" id="toc-tracklist" class="nav-link" data-scroll-target="#tracklist">Tracklist</a></li>
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description">Description</a></li>
  </ul></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import">Data Import</a>
  <ul class="collapse">
  <li><a href="#song-characteristics-dataset" id="toc-song-characteristics-dataset" class="nav-link" data-scroll-target="#song-characteristics-dataset">Song Characteristics Dataset</a></li>
  <li><a href="#playlists-dataset" id="toc-playlists-dataset" class="nav-link" data-scroll-target="#playlists-dataset">Playlists Dataset</a></li>
  </ul></li>
  <li><a href="#initial-exploration" id="toc-initial-exploration" class="nav-link" data-scroll-target="#initial-exploration">Initial Exploration</a>
  <ul class="collapse">
  <li><a href="#identifying-the-characteristics-of-popular-songs" id="toc-identifying-the-characteristics-of-popular-songs" class="nav-link" data-scroll-target="#identifying-the-characteristics-of-popular-songs">Identifying the Characteristics of Popular Songs</a></li>
  </ul></li>
  <li><a href="#playlist-construction" id="toc-playlist-construction" class="nav-link" data-scroll-target="#playlist-construction">Playlist Construction</a>
  <ul class="collapse">
  <li><a href="#choosing-anchor-songs" id="toc-choosing-anchor-songs" class="nav-link" data-scroll-target="#choosing-anchor-songs">Choosing Anchor Songs</a></li>
  <li><a href="#creating-a-candidate-pool" id="toc-creating-a-candidate-pool" class="nav-link" data-scroll-target="#creating-a-candidate-pool">Creating a Candidate Pool</a></li>
  <li><a href="#selecting-playlist-songs" id="toc-selecting-playlist-songs" class="nav-link" data-scroll-target="#selecting-playlist-songs">Selecting Playlist Songs</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">The Ultimate Playlist: Valence Synth Wave</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jocely Lopez Luna </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="playlist_cover.jpeg" class="img-fluid figure-img"></p>
<figcaption>Playlist cover art<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</figcaption>
</figure>
</div>
<section id="nomination" class="level1">
<h1>Nomination</h1>
<p>I hereby nominate this playlist for the Internet’s Best Playlist award. Valence Synth Wave was intentionally crafted to optimize an emotional build-up and release by ordering the songs so that their valence (a measure of musical positivity) follows a cosine wave. This approach was algorithmically driven to create an emotional arc that feels both natural and dynamic.</p>
<p>The figure below visualizes how various song characteristics evolve across the playlist. There is a clear fluctuation across the different characteristics–guaranteeing an emotionally diverse listening experience.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="tracklist" class="level2">
<h2 class="anchored" data-anchor-id="tracklist">Tracklist</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 37%">
<col style="width: 24%">
<col style="width: 28%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Position</th>
<th style="text-align: left;">Track Name</th>
<th style="text-align: left;">Artist Name</th>
<th style="text-align: left;">Album Name</th>
<th style="text-align: right;">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Forever Young</td>
<td style="text-align: left;">Alphaville</td>
<td style="text-align: left;">Forever Young</td>
<td style="text-align: right;">1984</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">The Blue Sky</td>
<td style="text-align: left;">a-ha</td>
<td style="text-align: left;">Hunting High And Low</td>
<td style="text-align: right;">1985</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Whip It</td>
<td style="text-align: left;">DEVO</td>
<td style="text-align: left;">Freedom Of Choice</td>
<td style="text-align: right;">1980</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Love Plus One</td>
<td style="text-align: left;">Haircut 100</td>
<td style="text-align: left;">Pelican West Plus</td>
<td style="text-align: right;">1982</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Lonely Ol’ Night</td>
<td style="text-align: left;">John Mellencamp</td>
<td style="text-align: left;">Scarecrow</td>
<td style="text-align: right;">1985</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">What You Need</td>
<td style="text-align: left;">INXS</td>
<td style="text-align: left;">Listen Like Thieves</td>
<td style="text-align: right;">1985</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">I Drink Alone</td>
<td style="text-align: left;">George Thorogood &amp; The Destroyers</td>
<td style="text-align: left;">Maverick</td>
<td style="text-align: right;">1985</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">I Need Someone Like Me</td>
<td style="text-align: left;">George Strait</td>
<td style="text-align: left;">Does Fort Worth Ever Cross Your Mind</td>
<td style="text-align: right;">1984</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">Music For A Found Harmonium - 2008 Digital Remaster</td>
<td style="text-align: left;">Penguin Cafe Orchestra</td>
<td style="text-align: left;">Broadcasting From Home</td>
<td style="text-align: right;">1984</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">Flash - Single Version</td>
<td style="text-align: left;">Queen</td>
<td style="text-align: left;">Flash Gordon</td>
<td style="text-align: right;">1980</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">I Love You Babe</td>
<td style="text-align: left;">Babyface</td>
<td style="text-align: left;">Lovers</td>
<td style="text-align: right;">1986</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: left;">Strut</td>
<td style="text-align: left;">Sheena Easton</td>
<td style="text-align: left;">A Private Heaven [Bonus Tracks Version]</td>
<td style="text-align: right;">1984</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="description" class="level2">
<h2 class="anchored" data-anchor-id="description">Description</h2>
<p>This playlist is a nod to the range of sentimentality that only the 80s could deliver—a time when synthesizers carried both dreams and dread. The opening song, “Forever Young” by Alphaville, sets a somber mood, with lead singer Marian Gold reflecting on the looming threat of nuclear annihilation haunting his generation, <em>“Hoping for the best, but expecting the worst / Are you gonna drop the bomb or not?”</em> This existential dread gives way to something more personal in a-ha’s “The Blue Sky,” where we find ourselves at a coffee shop mourning a lost love. A sensitive and forlorn Morten Harket laments, <em>“It doesn’t seem like this / Blue sky’s here for me.”</em></p>
<p>We pivot into something more energetic with “Whip It” by DEVO, a nonsensical but peppy call to arms for personal empowerment. “Love Plus One” by Haircut 100 delves deeper into playful absurdity, hinting at the sun-soaked tropics with bongos and xylophones. This is followed by John Mellencamp’s “Lonely Ol’ Night,” a Springsteen-esque rock ballad about seeking fleeting comfort in the face of isolation. <em>“It’s a lonely ol’ night / Can I put my arms around you?”</em> Mellencamp pleads. Meanwhile, INXS’s “What You Need” snaps us out of the melancholy with swagger and urgency with a thumping bass-line and slashes of saxophone.</p>
<p>The mood darkens with George Thorogood &amp; The Destroyers’ “I Drink Alone”—an edgy, bluesy anthem of solitude that doubles as a cry for help. Thorogood delivers each line with such boozy conviction, that you can practically smell the whiskey on his breath. Then George Strait’s “I Need Someone Like Me” shifts that loneliness to a country register.</p>
<p>Then “Music For A Found Harmonium” by Penguin Cafe Orchestra plunges us into a simmering tension that gently unravels into a disarmingly playful, jig-like melody. With a flash-bang, Queen’s “Flash” brings bold, bombastic, and camp energy. “I Love You Babe” by Babyface follows with warmth and sincerity, an earnest slow jam that finally says what it means. We close on a high note with Sheena Easton’s “Strut,” a fiercely confident song that dares anyone to look away.</p>
<p>Click play to start an emotionally engineered ride through the 1980s!</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/videoseries?si=Cp3x_n4KvIDKwNQv&amp;list=PLhqZr66B_GQ5XB6rDFYx6AyFXQHtce5kC" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>
</section>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<p>This data analysis was performed using R, using packages including dplyr, ggplot2, readr, stringr, forcats, DT, and knitr <span class="citation" data-cites="R-core dplyr ggplot2 readr stringr forcats2023 DT knitr">(<a href="#ref-R-core" role="doc-biblioref">Team, 2024</a>; <a href="#ref-ggplot2" role="doc-biblioref">Wickham, 2016</a>, <a href="#ref-forcats2023" role="doc-biblioref">2023</a>, <a href="#ref-stringr" role="doc-biblioref">2024</a>; <a href="#ref-dplyr" role="doc-biblioref">Wickham et al., 2024</a>; <a href="#ref-readr" role="doc-biblioref">Wickham &amp; Hester, 2024</a>; <a href="#ref-DT" role="doc-biblioref">Xie et al., 2024</a>; <a href="#ref-knitr" role="doc-biblioref">Xie, 2024</a>)</span>.</p>
<section id="data-import" class="level2">
<h2 class="anchored" data-anchor-id="data-import">Data Import</h2>
<section id="song-characteristics-dataset" class="level3">
<h3 class="anchored" data-anchor-id="song-characteristics-dataset">Song Characteristics Dataset</h3>
<p>The song characteristics data set was downloaded from <a href="https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv">this URL</a>, using the code below:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># constants</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>MINTY <span class="ot">&lt;-</span> <span class="st">"#78c2ad"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' Load Spotify song data</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function checks for the existence of a local CSV file containing Spotify song data.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' If the file does not exist, it downloads it from a remote URL. The function then reads and returns the data as a tibble.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A tibble containing Spotify song analytics data.</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>load_songs <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  directory <span class="ot">&lt;-</span> <span class="st">"data/mp03/"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(directory, <span class="st">"spotify_song_analytics.csv"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the data directory if it doesn't exist</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(directory)) {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(directory, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the data file if it's not already present</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_name)) {</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">url =</span> <span class="st">"https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv"</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">destfile =</span> file_name,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"auto"</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the CSV into a tibble</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  songs <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(file_name)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(songs)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Load songs into a dataframe</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>songs <span class="ot">&lt;-</span> <span class="fu">load_songs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A small amount of clean up was required for this data set. The code used to process the raw data set is presented below.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instructor provided code for cleaning artist string</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>clean_artist_string <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">['"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"'</span><span class="sc">\\</span><span class="st">]"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"[ ]?'"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"[ ]*,[ ]*"</span>, <span class="st">","</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Split songs with multiple artists into separate rows and clean artist names</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>songs <span class="ot">&lt;-</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  songs <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_longer_delim</span>(artists, <span class="st">","</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">artist =</span> <span class="fu">clean_artist_string</span>(artists)) <span class="sc">|&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>artists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="playlists-dataset" class="level3">
<h3 class="anchored" data-anchor-id="playlists-dataset">Playlists Dataset</h3>
<p>The playlists data set was downloaded from <a href="https://raw.githubusercontent.com/DevinOgrady/spotify_million_playlist_dataset/main/data1/">this URL</a>, using the code outlined below:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Load Spotify playlist data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function downloads and/or reads the Million Playlist Dataset slices from </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' a GitHub repository. If `read_only = TRUE`, it skips downloading and only reads </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' existing local files.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param read_only Logical. If TRUE, skips download and only loads local data. Default is FALSE.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A list of parsed JSON objects representing playlist data.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>load_playlists <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">read_only =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  source_root_url <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/DevinOgrady/spotify_million_playlist_dataset/main/data1/"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  directory <span class="ot">&lt;-</span> <span class="st">"data/mp03/mpd/"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create directory if it doesn't exist</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(directory)) {</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(directory, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>read_only) {</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over all playlist slice file names</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">999000</span>, <span class="at">by =</span> <span class="dv">1000</span>)) {</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      fname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"mpd.slice."</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">format</span>(i, <span class="at">scientific =</span> <span class="cn">FALSE</span>), <span class="st">"-"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">format</span>(i <span class="sc">+</span> <span class="dv">999</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">".json"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>      fpath <span class="ot">&lt;-</span> <span class="fu">file.path</span>(directory, fname)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Download file if it's not already present</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fpath)) {</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Sys.sleep</span>(<span class="fl">0.01</span>)  <span class="co"># Avoid hitting rate limits</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tryCatch</span>({</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">invisible</span>(<span class="fu">download.file</span>(</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">url =</span> <span class="fu">paste0</span>(source_root_url, fname),</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">destfile =</span> fpath,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"auto"</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>          ))</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">message</span>(<span class="st">"Download failed: "</span>, fname)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read all the JSON files in the directory</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  json_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(directory, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.json$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  all_data <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(json_files))</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(json_files)) {</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>({</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      all_data[[i]] <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(json_files[i]))</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Failed to read: "</span>, json_files[i])</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(all_data)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>SPOTIFY_MILLIONS <span class="ot">&lt;-</span> <span class="fu">load_playlists</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Since the playlist data set was hierarchical, it required “rectangling,” to be adapted for use in this analysis. This process was accomplished with the following code.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Process a Spotify playlist slice</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function processes a single playlist slice from the Million Playlist Dataset,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' extracting track information and saving it as a CSV file for faster future loading.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' It strips Spotify URI prefixes and appends playlist metadata.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param playlist A list object representing one slice of the Spotify playlist data (parsed JSON).</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame (tibble) of processed track data with playlist-level metadata.</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>process <span class="ot">&lt;-</span> <span class="cf">function</span>(playlist) {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Instructor provided helper function to strip Spotify URI prefix</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  strip_spotify_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(x, <span class="st">".*:.*:"</span>, <span class="st">""</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the output directory if it doesn't exist</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  output_dir <span class="ot">&lt;-</span> <span class="st">"data/mp03/processed"</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(output_dir)){</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(output_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate filename for processed slice</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  slice_range <span class="ot">&lt;-</span> playlist<span class="sc">$</span>info<span class="sc">$</span>slice</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  csv_outfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(output_dir, <span class="st">"/mpd.slice."</span>, slice_range, <span class="st">".csv"</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If CSV already exists, load it instead of reprocessing</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(csv_outfile)){</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    all_tracks <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(csv_outfile)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    all_tracks <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()  <span class="co"># Placeholder for all processed tracks</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(playlist<span class="sc">$</span>playlists<span class="sc">$</span>tracks)) {</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      tracks_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(playlist<span class="sc">$</span>playlists<span class="sc">$</span>tracks[[i]])</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Skip empty playlists</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(tracks_df) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add metadata and clean up Spotify URIs</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      tracks_df <span class="ot">&lt;-</span> tracks_df <span class="sc">|&gt;</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">playlist_name =</span> playlist<span class="sc">$</span>playlists<span class="sc">$</span>name[i],</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">playlist_id =</span> playlist<span class="sc">$</span>playlists<span class="sc">$</span>pid[i],</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">playlist_followers =</span> playlist<span class="sc">$</span>playlists<span class="sc">$</span>num_followers[i],</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">track_uri =</span> <span class="fu">strip_spotify_prefix</span>(track_uri),</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">artist_uri =</span> <span class="fu">strip_spotify_prefix</span>(artist_uri),</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">album_uri =</span> <span class="fu">strip_spotify_prefix</span>(album_uri)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Combine with all previously processed tracks</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>      all_tracks <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_tracks, tracks_df)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the processed data for this slice</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.csv</span>(all_tracks, csv_outfile, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Saved: "</span>, csv_outfile)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(all_tracks)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="co">#' Merge all processed playlist slices into a single dataset</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function checks if a master CSV file (`spotify_millions.csv`) already exists.</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co">#' If not, it processes all playlist JSON slices provided and merges them into one</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="co">#' unified dataframe, then saves it as a CSV for future use. If the file already exists,</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="co">#' it loads the data directly.</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data A list of playlist slices (parsed JSON). Defaults to `master_json`.</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A dataframe containing the merged Spotify playlist data.</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>merge_processed_playlists <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> master_json) {</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Path to the master output CSV</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  spotify_millions_fpath <span class="ot">&lt;-</span> <span class="st">"data/mp03/spotify_millions.csv"</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(spotify_millions_fpath)) {</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If no master file exists, process each playlist slice</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    playlists <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()  <span class="co"># Initialize an empty dataframe</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(master_json)) {</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>      playlist <span class="ot">&lt;-</span> master_json[[i]]</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>      processed_df <span class="ot">&lt;-</span> <span class="fu">process</span>(playlist)  <span class="co"># Process individual slice</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>      playlists <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(playlists, processed_df)  <span class="co"># Append to master dataframe</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean up and standardize column names</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    playlists <span class="ot">&lt;-</span> playlists <span class="sc">|&gt;</span> </span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">playlist_position =</span> <span class="st">`</span><span class="at">pos</span><span class="st">`</span>,</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">track_id =</span> <span class="st">`</span><span class="at">track_uri</span><span class="st">`</span>,</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">artist_id =</span> <span class="st">`</span><span class="at">artist_uri</span><span class="st">`</span>,</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">album_id =</span> <span class="st">`</span><span class="at">album_uri</span><span class="st">`</span>,</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">duration =</span> <span class="st">`</span><span class="at">duration_ms</span><span class="st">`</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">!</span><span class="st">`</span><span class="at">...1</span><span class="st">`</span>)  <span class="co"># Drop the unnamed index column</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save merged data to CSV</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.csv</span>(playlists, spotify_millions_fpath, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If file exists, just read it</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    playlists <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(spotify_millions_fpath)</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(playlists)</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Load or process the Spotify Millions json dataset</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>SPOTIFY_MILLIONS <span class="ot">&lt;-</span> <span class="fu">merge_processed_playlists</span>(SPOTIFY_MILLIONS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="initial-exploration" class="level2">
<h2 class="anchored" data-anchor-id="initial-exploration">Initial Exploration</h2>
<p>Once the data were squared away, I completed an instructor-led preliminary data analysis, the results of which are tabulated below. First, I compute the total number of distinct tracks and artists contained in this data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many distinct tracks and artists are represented in the playlist data?</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">"data/mp03/num_distinct.csv"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  num_distinct <span class="ot">&lt;-</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    SPOTIFY_MILLIONS <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(track_id) <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Distinct Tracks</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cross_join</span>(SPOTIFY_MILLIONS <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(artist_id) <span class="sc">|&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Distinct Artists</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>()))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(num_distinct, fname, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  num_distinct <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fname)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>num_distinct <span class="sc">|&gt;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), comma)) <span class="sc">|&gt;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Table 1: Count of Distinct Tracks and Artists in the Playlist Dataset"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 1: Count of Distinct Tracks and Artists in the Playlist Dataset</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Distinct Tracks</th>
<th style="text-align: left;">Distinct Artists</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1,200,590</td>
<td style="text-align: left;">173,604</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Next, I identify the 5 most popular tracks in the playlist data.</p>
<p>Subsequently, I determine the most popular track in the playlist data that does not have a corresponding entry in the song characteristics data set.</p>
<p>I now look at the most danceable track in the playlist data, and count the number of times it appears in a playlist.</p>
<p>Then, I locate the playlist with the longest average track length.</p>
<p>Finally, I identify the most popular playlist in the playlist data set.</p>
<section id="identifying-the-characteristics-of-popular-songs" class="level3">
<h3 class="anchored" data-anchor-id="identifying-the-characteristics-of-popular-songs">Identifying the Characteristics of Popular Songs</h3>
<section id="joining-the-data-sets" class="level4">
<h4 class="anchored" data-anchor-id="joining-the-data-sets">Joining the Data Sets</h4>
<p>I joined the playlist and song characteristic data sets as in the code below. The Spotify playlist data and the song characteristics data was subsequently deleted to free up RAM.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>merged_fpath <span class="ot">&lt;-</span> <span class="st">"data/mp03/spotify_millions_songs_join.csv"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(merged_fpath)){</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  spotify_millions_songs <span class="ot">&lt;-</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    SPOTIFY_MILLIONS <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(songs, <span class="fu">join_by</span>(track_id <span class="sc">==</span> id, track_name <span class="sc">==</span> name, artist_name <span class="sc">==</span> artist, duration <span class="sc">==</span> duration_ms)) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">decade =</span> <span class="fu">paste0</span>((year <span class="sc">%/%</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>, <span class="st">"s"</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(spotify_millions_songs, merged_fpath, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  spotify_millions_songs <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(merged_fpath)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(SPOTIFY_MILLIONS) <span class="sc">&amp;</span> <span class="fu">exists</span>(songs)){</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(SPOTIFY_MILLIONS, songs)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analysis" class="level4">
<h4 class="anchored" data-anchor-id="analysis">Analysis</h4>
<p>A brief, instructor-led analysis of the playlist data set is included below. To explore whether more popular songs tend to appear in more playlists, a linear regression was performed using popularity as the predictor and the log-transformed count of playlist appearances as the outcome. The figure below illustrates this relationship. The model shows a fairly strong positive association, with a regression equation of <span class="math inline">\(y = -1.25 + 0.10x\)</span>, a correlation of <span class="math inline">\(r = 0.77\)</span>, and a coefficient of determination <span class="math inline">\(R^2 = 0.59\)</span>. This suggests that popularity is a reasonably good predictor of how often a song shows up in playlists.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is the popularity column correlated with the number of playlist appearances? If so, to what degree?</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Prep the data</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(track_id, <span class="at">name =</span> <span class="st">"playlist_appearances"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_appearances =</span> <span class="fu">log1p</span>(playlist_appearances))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_appearances <span class="sc">~</span> popularity, <span class="at">data =</span> data)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Get model metrics</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>model_eq <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(model)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">glance</span>(model)<span class="sc">$</span>r.squared</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(data<span class="sc">$</span>popularity, data<span class="sc">$</span>log_appearances, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the equation text</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>eq_text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"y = "</span>, <span class="fu">round</span>(model_eq<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">" + "</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(model_eq<span class="sc">$</span>estimate[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">"x</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r = "</span>, <span class="fu">round</span>(correlation, <span class="dv">2</span>), </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | R² = "</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> popularity, <span class="at">y =</span> log_appearances)) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">color =</span> MINTY) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">color =</span> MINTY) <span class="sc">+</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">12.75</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> eq_text, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>) <span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Figure 1: Relationship Between Popularity and Playlist Appearances"</span>,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Popularity"</span>,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Log(Playlist Appearances)"</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Median track popularity by year is presented in the figure below. The general trend is that track popularity is higher with release year. Notably, 2017 stands out as the year with the highest median song popularity.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In what year were the most popular songs released?</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_popularity =</span> <span class="fu">median</span>(popularity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> median_popularity)) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> MINTY, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> MINTY, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(<span class="fu">pull</span>(spotify_millions_songs, year), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">max</span>(<span class="fu">pull</span>(spotify_millions_songs, year), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Median Track Popularity"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Median Track Popularity by Year"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>While median song popularity continues to keep up with the times, median track dance-ability peaked in 1929. The figure below presents the evolution of track dance ability over the past 90 years.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In what year did danceability peak?</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_danceability =</span> <span class="fu">median</span>(danceability, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> median_danceability)) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> MINTY, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> MINTY, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(<span class="fu">pull</span>(spotify_millions_songs, year), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">max</span>(<span class="fu">pull</span>(spotify_millions_songs, year), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Median Track Danceability"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Median Track Danceability by Year"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The most represented decade on user playlists is the 2010s. The bar chart below presents the distribution of tracks belonging to a particular decade.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Which decade is most represented on user playlists? (The integer division (%/%) operator may be useful for computing decades from years.)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decade =</span> <span class="fu">paste0</span>((year <span class="sc">%/%</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>, <span class="st">"s"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(decade) <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">decade_count =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> decade_count, <span class="at">y =</span> <span class="fu">factor</span>(decade))) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> MINTY) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Tracks (in tens of thousands)"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Decade"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Decade Representation in Playlists"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The most popular musical key is G, as can be seen in the figure of key distribution frequency below.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the key names</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>key_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"C"</span>, <span class="st">"C♯/Db"</span>, <span class="st">"D"</span>, <span class="st">"D♯/Eb"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F♯/Gb"</span>, <span class="st">"G"</span>, <span class="st">"G♯/Ab"</span>, <span class="st">"A"</span>, <span class="st">"A♯/Bb"</span>, <span class="st">"B"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count frequency per key and label with musical key names</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(key, <span class="at">name =</span> <span class="st">"key_frequency"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">key_label =</span> <span class="fu">factor</span>(key_names[key <span class="sc">+</span> <span class="dv">1</span>], <span class="at">levels =</span> key_names))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create label positions at fixed theta, variable radius</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>y_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1000</span>, <span class="fu">max</span>(data<span class="sc">$</span>key_frequency), <span class="at">by =</span> <span class="dv">1000</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>radial_labels <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="st">"D♯/Eb"</span>, <span class="fu">length</span>(y_values)),  <span class="co"># Repeat "C" the same number of times as y values</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_values,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.character</span>(y_values)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with polar coordinates and annotations</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> key_label, <span class="at">y =</span> key_frequency, <span class="at">fill =</span> key_label)) <span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> radial_labels, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"gray20"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Musical Keys"</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As shown in the figure below, there does not appear to be a strong preference for any particular track length, with short, medium, and long songs appearing at roughly equal frequencies. Length categories are defined by terciles: short songs are under 199.08 seconds (<span class="math inline">\(33^{rd}\)</span> percentile), medium songs fall between 199.08 and 253.4 seconds (<span class="math inline">\(33^{rd}\)</span>–<span class="math inline">\(66^{th}\)</span> percentile), and long songs exceed 253.4 seconds.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What are the most popular track lengths? (Are short tracks, long tracks, or something in between most commonly included in user playlists?)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>duration_percentiles <span class="ot">&lt;-</span> spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(duration)) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duration_sec =</span> duration <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">p33 =</span> <span class="fu">quantile</span>(duration_sec, <span class="fl">0.33</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">p66 =</span> <span class="fu">quantile</span>(duration_sec, <span class="fl">0.66</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out threshold values</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>p33 <span class="ot">&lt;-</span> duration_percentiles<span class="sc">$</span>p33</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>p66 <span class="ot">&lt;-</span> duration_percentiles<span class="sc">$</span>p66</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize and plot</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(duration)) <span class="sc">|&gt;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration_sec =</span> duration <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>      duration_sec <span class="sc">&lt;=</span> p33 <span class="sc">~</span> <span class="st">"Short"</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      duration_sec <span class="sc">&lt;=</span> p66 <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Long"</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(duration_category) <span class="sc">|&gt;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> duration_category, <span class="at">y =</span> n, <span class="at">fill =</span> duration_category)) <span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span>,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Song Duration Categories"</span>,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Duration Category"</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Unique Tracks"</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Duration Category"</span>,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Short"</span> <span class="ot">=</span> MINTY, <span class="st">"Medium"</span> <span class="ot">=</span> <span class="st">"#fdd835"</span>, <span class="st">"Long"</span> <span class="ot">=</span> <span class="st">"#ef5350"</span>)) <span class="sc">+</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A linear regression analysis reveals a very weak positive relationship between danceability and popularity, with a coefficient of determination (<span class="math inline">\(R^2\)</span>) of just 0.03. This suggests that only 3% of the variability in popularity can be explained by danceability. The scatter plot below illustrates this weak association.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Does danceability correlate with popularity?</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(danceability <span class="sc">~</span> popularity, <span class="at">data =</span> data)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get model metrics</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>model_eq <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(model)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">glance</span>(model)<span class="sc">$</span>r.squared</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(data<span class="sc">$</span>popularity, data<span class="sc">$</span>danceability, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># set up annotation</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>eq_text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"y = "</span>, <span class="fu">round</span>(model_eq<span class="sc">$</span>estimate[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">" + "</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(model_eq<span class="sc">$</span>estimate[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">"x</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r = "</span>, <span class="fu">round</span>(correlation, <span class="dv">2</span>), </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">" | R² = "</span>, <span class="fu">round</span>(r_squared, <span class="dv">2</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> popularity, <span class="at">y =</span> danceability)) <span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">color =</span> MINTY) <span class="sc">+</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> eq_text, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Popularity and Danceability"</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Popularity"</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Log(Playlist Appearances)"</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To understand which songs are most frequently chosen to open a playlist, I examined tracks appearing in the first position across playlists. The bar chart below displays the top 5 most common opening songs, revealing listener and curator preferences for kick-starting a playlist. Not surprisingly, many of these opening tracks are high-energy or popular.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What are the top 5 most common opening playlist songs?</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(playlist_position <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(track_id, <span class="at">name =</span> <span class="st">"song_frequency"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(song_frequency)) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> song_frequency, <span class="at">y =</span> <span class="fu">fct_reorder</span>(<span class="fu">paste0</span>(track_name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, artist_name), song_frequency))) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> MINTY) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 5 Most Popular Opening Playlist Songs"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Playlists (Opening Position)"</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Track Name"</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="playlist-construction" class="level2">
<h2 class="anchored" data-anchor-id="playlist-construction">Playlist Construction</h2>
<section id="choosing-anchor-songs" class="level3">
<h3 class="anchored" data-anchor-id="choosing-anchor-songs">Choosing Anchor Songs</h3>
<p>Since I’ve been on an 80s kick recently, I picked the anchor songs shown in table 7.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base songs</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>song1 <span class="ot">&lt;-</span> spotify_millions_songs <span class="sc">|&gt;</span> <span class="fu">filter</span>(track_id <span class="sc">==</span> <span class="st">"4S1VYqwfkLit9mKVY3MXoo"</span>) <span class="co"># Forever Young by Alphaville</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>song2 <span class="ot">&lt;-</span> spotify_millions_songs <span class="sc">|&gt;</span> <span class="fu">filter</span>(track_id <span class="sc">==</span> <span class="st">"22Ca1a5rQ5g2UFEZ3pp4tL"</span>) <span class="co"># The Blue Sky by a-ha</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>anchor_songs <span class="ot">&lt;-</span> <span class="fu">list</span>(song1, song2)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(song1,song2) <span class="sc">|&gt;</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(track_name, artist_name, album_name, year) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Track Name"</span> <span class="ot">=</span> track_name,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Artist Name"</span> <span class="ot">=</span> artist_name,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Album Name"</span> <span class="ot">=</span> album_name,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Year"</span> <span class="ot">=</span> year</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Table 7: Anchor Songs Chosen for the Ultimate Playlist"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Table 7: Anchor Songs Chosen for the Ultimate Playlist</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Track Name</th>
<th style="text-align: left;">Artist Name</th>
<th style="text-align: left;">Album Name</th>
<th style="text-align: right;">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Forever Young</td>
<td style="text-align: left;">Alphaville</td>
<td style="text-align: left;">Forever Young</td>
<td style="text-align: right;">1984</td>
</tr>
<tr class="even">
<td style="text-align: left;">The Blue Sky</td>
<td style="text-align: left;">a-ha</td>
<td style="text-align: left;">Hunting High And Low</td>
<td style="text-align: right;">1985</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="creating-a-candidate-pool" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-candidate-pool">Creating a Candidate Pool</h3>
<p>To determine compatibility with the anchor songs, I applied the following heuristics:</p>
<ol type="1">
<li><p>Co-occurrence: Songs that frequently appear on playlists alongside the anchor songs.</p></li>
<li><p>Musical similarity: Songs in the same key and with a tempo within <span class="math inline">\(\pm5\)</span> BPM of the anchor.</p></li>
<li><p>Artist match: Songs by the same artist(s) as the anchor tracks.</p></li>
<li><p>Audio profile similarity: Songs released in the same year and exhibiting similar values for acousticness, dance-ability, energy, instrumentalness, liveness, loudness, speechiness, and valence. Similarity is measured using Euclidean distance: <span class="math display">\[d = \sqrt{\sum_{i=1}^{n} (x_i - y_i)^2}\]</span> where <span class="math inline">\(x_i\)</span> and <span class="math inline">\(y_i\)</span> are the characteristic values for the anchor and candidate songs, respectively.</p></li>
<li><p>Decade match and structural similarity: Songs from the same decade and duration within <span class="math inline">\(\pm\)</span> 15 seconds of the anchor song.</p></li>
</ol>
<p>The application of these heuristics is implemented in the code below.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">"data/mp03/peer_songs.csv"</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># What other songs commonly appear on playlists along side these songs?</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>peer_songs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (song <span class="cf">in</span> anchor_songs) {</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  playlist_ids <span class="ot">&lt;-</span> song <span class="sc">|&gt;</span> <span class="fu">pull</span>(playlist_id) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">as.vector</span>()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (pid <span class="cf">in</span> playlist_ids) {</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    peer_songs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      peer_songs,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(playlist_id <span class="sc">==</span> pid) <span class="sc">|&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(peer_songs <span class="sc">|&gt;</span> <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>), fname, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  peer_songs <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fname)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># What songs have a similar key and tempo to these songs</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">"data/mp03/key_and_tempo.csv"</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  key_and_tempo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (song <span class="cf">in</span> anchor_songs){</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    song_key <span class="ot">&lt;-</span> <span class="fu">unique</span>(song <span class="sc">|&gt;</span> <span class="fu">pull</span>(key))</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    song_tempo <span class="ot">&lt;-</span> <span class="fu">unique</span>(song <span class="sc">|&gt;</span> <span class="fu">pull</span>(tempo))</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    key_and_tempo <span class="ot">&lt;-</span> </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        key_and_tempo,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">similar_tempo =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>              <span class="fu">abs</span>(tempo <span class="sc">-</span> <span class="fu">unique</span>(song <span class="sc">|&gt;</span> <span class="fu">pull</span>(tempo))) <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">FALSE</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>            )) <span class="sc">|&gt;</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>            key <span class="sc">==</span> song_key,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>            similar_tempo <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(key_and_tempo, fname, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    key_and_tempo <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fname)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co"># What songs have the same artist?</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">"data/mp03/same_artist.csv"</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  same_artist <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (song <span class="cf">in</span> anchor_songs){</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    song_artist_id <span class="ot">&lt;-</span> <span class="fu">unique</span>(song <span class="sc">|&gt;</span> <span class="fu">pull</span>(artist_id))</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    same_artist <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>      same_artist,</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>      spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(artist_id <span class="sc">==</span> song_artist_id) <span class="sc">|&gt;</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(same_artist, fname, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    same_artist <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fname)</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="co"># What other songs were released in the same year and have similar levels of acousticness, danceability, etc.</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">"data/mp03/all_similar_songs.csv"</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>  all_similar_songs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Calculate Similar Songs Based on Selected Metrics</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' This function identifies songs similar to a given song by calculating the Euclidean distance between </span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' the selected metrics (e.g., acousticness, danceability, energy, etc.) of the input song and all other songs</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' from the same year. Only songs with a distance smaller than a specified threshold (2.5) are considered similar.</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param song A data frame representing a single song, containing columns for song characteristics (e.g., `track_id`, `year`, and metrics like `acousticness`, `danceability`, etc.).</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param std_songs A data frame representing the standardized set of songs to compare against, which must include the same metrics as in the `song` argument.</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param metrics A character vector containing the names of the metrics to be used in calculating the similarity (e.g., `c("acousticness", "danceability", "energy", "valence")`).</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @return A data frame with songs that are similar to the input song, based on the Euclidean distance between their metric values. The songs are filtered by a distance threshold of 2.5, </span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'         and they are ordered by their proximity to the input song.</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @details The function scales the metrics for all songs in the same year as the input song and calculates the Euclidean distance between the input song's metrics and each song's metrics.</span></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'          The distance is computed as the square root of the sum of squared differences between the selected metrics of the input song and each candidate song.</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'          Only songs with a distance smaller than 2.5 are considered similar.</span></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @examples</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' # Assuming `song` and `std_songs` are data frames with appropriate structure</span></span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' similar_songs &lt;- calculate_similar_songs(song = song_data, std_songs = song_dataset, metrics = c("acousticness", "danceability", "energy"))</span></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @export</span></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>  calculate_similar_songs <span class="ot">&lt;-</span> <span class="cf">function</span>(song, std_songs, metrics) {</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for songs from the same year and apply scaling to the metrics</span></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    std_songs_scaled <span class="ot">&lt;-</span> std_songs <span class="sc">|&gt;</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">unique</span>(song <span class="sc">|&gt;</span> <span class="fu">pull</span>(year))) <span class="sc">|&gt;</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(metrics), scale))</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the song vector (metrics for the current song)</span></span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>    song_vec <span class="ot">&lt;-</span> std_songs_scaled <span class="sc">|&gt;</span></span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(track_id <span class="sc">==</span> <span class="fu">unique</span>(song <span class="sc">|&gt;</span> <span class="fu">pull</span>(track_id))) <span class="sc">|&gt;</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">all_of</span>(metrics)) <span class="sc">|&gt;</span></span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>()</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign proper names to the song vector based on metrics</span></span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(song_vec) <span class="ot">&lt;-</span> metrics</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the distance for each song</span></span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>    similar_songs <span class="ot">&lt;-</span> std_songs_scaled <span class="sc">|&gt;</span></span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">distance =</span> <span class="fu">sqrt</span>(</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>        (acousticness <span class="sc">-</span> song_vec[<span class="st">"acousticness"</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>          (danceability <span class="sc">-</span> song_vec[<span class="st">"danceability"</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>          (energy <span class="sc">-</span> song_vec[<span class="st">"energy"</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>          (instrumentalness <span class="sc">-</span> song_vec[<span class="st">"instrumentalness"</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>          (liveness <span class="sc">-</span> song_vec[<span class="st">"liveness"</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>          (loudness <span class="sc">-</span> song_vec[<span class="st">"loudness"</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>          (speechiness <span class="sc">-</span> song_vec[<span class="st">"speechiness"</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>          (valence <span class="sc">-</span> song_vec[<span class="st">"valence"</span>])<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">|&gt;</span></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(distance) <span class="sc">|&gt;</span></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(distance <span class="sc">&lt;</span> <span class="dv">2</span>)</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the result</span></span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(similar_songs)</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>  anchor_songs <span class="ot">&lt;-</span> <span class="fu">list</span>(song1, song2)</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For loop to calculate similar songs for each song and bind the rows</span></span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (song <span class="cf">in</span> anchor_songs) {</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>    similar_songs <span class="ot">&lt;-</span> <span class="fu">calculate_similar_songs</span>(song, spotify_millions_songs, metrics)</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>    all_similar_songs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_similar_songs, similar_songs)</span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(all_similar_songs, fname, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>    all_similar_songs <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fname)</span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a><span class="co"># What songs are in the same decade and have a similar duration?</span></span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a><span class="co"># add decade to song data.frames</span></span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>song1 <span class="ot">&lt;-</span> song1 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">decade =</span> <span class="fu">as.character</span>((year <span class="sc">%/%</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>))</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>song2 <span class="ot">&lt;-</span> song2 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">decade =</span> <span class="fu">as.character</span>((year <span class="sc">%/%</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>))</span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>anchor_songs <span class="ot">&lt;-</span> <span class="fu">list</span>(song1, song2)</span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">"data/mp03/decade_and_song_length.csv"</span></span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fname)) {</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>  decade_and_song_length <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (song <span class="cf">in</span> anchor_songs) {</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>    song_decade <span class="ot">&lt;-</span> <span class="fu">unique</span>(song<span class="sc">$</span>decade)</span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>    song_length <span class="ot">&lt;-</span> <span class="fu">unique</span>(song<span class="sc">$</span>duration)</span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>    matched_songs <span class="ot">&lt;-</span> spotify_millions_songs <span class="sc">|&gt;</span></span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>        <span class="at">similar_duration =</span> <span class="fu">abs</span>(duration <span class="sc">-</span> song_length) <span class="sc">&lt;=</span> <span class="dv">15</span> <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>        decade <span class="sc">==</span> song_decade,</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>        similar_duration</span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>    decade_and_song_length <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(decade_and_song_length, matched_songs)</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(decade_and_song_length, fname, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>  decade_and_song_length <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fname)</span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The full list of candidate songs is shown below:</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ae873a590bb29327f11e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ae873a590bb29327f11e">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left;\">\n  Table: \n  <em>Songs Matching At Least 4 Compatibility Heuristics<\/em>\n<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373"],["Forever Young","Hard Candy Christmas","Desert Moon","Querida","Mis Amores","I Can't Hold Back","Elle a les yeux revolver","Drive","Can't Fight This Feeling","The Search Is Over","Open Your Heart","Main Title/Riders Of Taramis - Conan The Destroyer/Soundtrack Version","Coming Back to You","That Was Yesterday","Just Divorced","The Beautiful Ones","Sunset Grill","Sweet Country Music","Un autre monde - Remasterisé en 2015","Hallelujah","I Need Someone Like Me","Night Comes Down","Necesita De Ti","S.M.F.","The Price","Alone Again","Not Enough Love In The World","Honky Tonk Saturday Night","Ivo","Missing You","Blackmagic","When Heaven Comes Down","Don't Close Your Eyes","Don't Answer Me","The Blue Sky","Big Lizard","I Drink Alone","Dogs On The Run","Pervert Nurse","Don't Come Around Here No More","Goodbye","Bittersweet","Lovin' Every Minute of It","Rough Boy","Best One Yet","Closer","Radioactive","Rebels","Lay It Down","On and On","Taking My Chances","Miracle","All About That Bass","Avalanche","Motivation","A Walk","Do What I Want","Someone Else","Blown Away","Someone Like You","Hustlin'","Love Song","Fake Love","Tootsee Roll (Dance Version)","Same Old Song and Dance","Gimme Three Steps","Mississippi Queen","(Don't Fear) The Reaper","Put On","Let It Whip","How Would You Feel (Paean)","I Will Possess Your Heart","January Wedding","Do I","The Letter","I Say a Little Prayer","Wednesday Night Interlude","Cosmic Love","Te Odio Y Te Amo","That Thing You Do!","Cudi Zone","Sick Like Me","Que Lloro","Burnin' for You","Under the Milky Way","In A Dream - Original Mix","May It Be","You Were Mine","I Will Always Love You","Watching The Detectives - Single Version","Vertigo","See You Again - Rock Mafia Remix","Night Life","Guardians Of Asgaard","The Breakup Song","Il est cinq heures, Paris s'éveille","Royal Oil","You're Still On My Mind","Coal Miner's Daughter - Single Version","Heart Full of Soul","When I'm With You","Long Cool Woman (In a Black Dress)","Shoot 'Em Down","The Way We Were","Police In Helicopter","Heartaches","Walkie Talkie Man","Rio","Mystifies Me","It's Easy","If You Can't Give Me Love - 2017 Remaster","You Keep Runnin' Away","Babe, We're Gonna Love Tonight - Radio Edit","Cien gaviotas","The Love Parade","Perfect","Rock Me To The Top","The Last Rebel","Middletown Dreams","Here Is the News","Sex Action","In Your Eyes","What I Don't Know","Not Me (Remastered)","Toda Forma de Amor","Crystal Days","Going Up","Slowdive","Morningtown Ride","A Girl Called Johnny - 2002 Remaster","Three Sisters","Fair Play","Full On Kevin's Mom","Gimme Some Money","The Lovin' Cup","Foreplay / Long Time","Postcards from Italy","Let Go","Kiss Tomorrow Goodbye","Bette Davis Eyes","Just the Way You Are","Half of My Heart","Habits (Stay High)","Savior","Rose-Colored Boy","Fire and the Flood","Got to Be Real - Single Version","Goodbye","Funky Cold Medina","Jump in the Line","I'm a Slave 4 U","Sparks Fly","Feelin' The Same Way","The Great Gig in the Sky","The One That You Love","Janie's Got A Gun","I Touch Myself","I Can't Go For That (No Can Do) - Edited Version","Words As Weapons","Let Me Love You (Until You Learn To Love Yourself) (Glee Cast Version)","25 Bucks (feat. Purity Ring)","Automatic","Would You Mind","I Love You Babe","The Only One I Know","Promises, Promises - Single Edit","Dream Walkin'","It Must Be Love - Single Version","Kim &amp; Jessie","Higher Power","The Ghetto","It's a Love Thing","Open Your Heart","There Goes The Fear","Falling For You","Automatic - 12\" Special Remix","We Belong Together","No Promises","State Farm","I'm In Love - 7\" Version","Panalangin","L.O.V.E. Love","Anything","Fallen Angel","The Jet Set","To Germany With Love","Dance With Me","Love Is Reason","The Living Daylights","I Dream Myself Alive","I've Been Losing You","Scoundrel Days","Working for the Weekend","Sweet Dreams (Are Made of This) - Remastered","Time After Time","Run Rudolph Run - Single Version","The Promise","We Belong","Love Plus One","Centerfold","Love Stinks","Whip It","Flash - Single Version","867-5309 / Jenny","Hurts So Good","P.Y.T. (Pretty Young Thing)","Kiss","Always Something There to Remind Me","Wake Me up Before You Go-Go","Sexual Healing","I Keep Forgettin' (Every Time You're Near)","Every Little Step","Why Can't This Be Love","Walking On Sunshine","I'm So Excited","The Warrior","Dance Hall Days","You Got Lucky","Pressure Down","I Wanna Live","Crash","Cheri Cheri Lady","Let' s Talk About Love","Shake It Up","With a Little Love","In 100 Years","Atlantis Is Calling (S.O.S. for Love)","Secret","One in a Million","Where Is My Mind?","The Ties That Bind","If I'd Been The One","Going Up The Country","I'll Tumble 4 Ya","Could've Been","Woman in Love","Shake Your Love","Holiday","Strange Little Girl","Tempted","Cruel Summer","Danger On the Track","Raspberry Beret","New Sensation","Too Shy","Fandango","Saved By Zero","When I Think Of You","And We Danced","What You Need","Time (Clock Of The Heart)","He's so Shy","Let My Love Open The Door","Alone","Ask the Lonely","Allentown","Is This Love","Effigy (I'm Not An)","Birthday","Walking In L.A.","Robert De Niro's Waiting","Magic","Vamos a la Playa - 1983","Rasputin - 7\" Version","Balinese","Since You're Gone","Mama Weer All Crazee Now","Master and Servant","Down In It","Orange Crush - Remastered","If I Needed You","Killin' Time","Seven Spanish Angels (With Ray Charles)","Fool Hearted Memory","All The Love","Masquerade","Another Heart Breaks","The Lights Go Down","Burning Up","Dancing with Myself","The Cutter","Eighties - 2007 Digital Remaster","Destination Unknown","If You Want My Love","Breaking the Law","Let There Be Love","The Next Time I Fall (with Amy Grant)","Tell Her About It","Only You","Space Age Love Song","Thundering Hearts","I Wanna Go Back","Authority Song","Atlantic City","Johnny 99","Gimme All Your Lovin'","Oh Sheila","Jose Cuervo","Lonely Ol' Night","Talk To Me","Viento","Rise Above","Wild in the Streets","Kiss You All Over","Be Good to Yourself","Cuando Pase El Temblor - Remasterizado 2007","De Música Ligera","Get To Know Ya","(Forever) Live And Die","Dear Prudence","Stigmata Martyr","Punk Rock Girl","Goodbye Seventies","Look Mama","Trouble","Peter Gunn Theme","Close Enough","Some People","Revenge","Pulling Mussels (From The Shell)","Reap the Wild Wind - 2009 Remaster","Cccan't You See","Imagination","It Could Have Been You","A Million Miles Away","Nemesis","Falling In Love (Uh-Oh)","Girls Just Want to Have Lunch","Like a Surgeon","Music For A Found Harmonium - 2008 Digital Remaster","Girl Can't Help It","I'm in a Hurry (And Don't Know Why)","Blood And Roses","Police Truck","Crumblin' Down","Jump (For My Love) - Single Remix","Strut","Back To Paradise","Still They Ride","Hold Me","Non, je ne regrette rien","Summertime - Single Edit","Bang Your Head (Metal Health)","You Surround Me","Weirdo","As It Is When It Was","Angel Dust","Your House","World-A-Reggae","Mary Had a Little Lamb","Workin For A Livin","April Skies","Here I Am (Just When I Thought I Was Over You)","Baggy Trousers","The Motion Of Love","Institutionalized","Cities In Dust","Tonite","Jeopardy","Where Are You Now","Heaven Knows","I Can't Hardly Stand It","Corona","Por Tu Maldito Amor","Mommy's Little Monster","Beats to the Rhyme","I Bleed","Everlasting Love","Can't Get Enough of You Baby","We Want Some P--sy","China","Lay All Your Love On Me","Come Dancing"],["Alphaville","Dolly Parton","Dennis DeYoung","Juan Gabriel","Roberto Carlos","Survivor","Marc Lavoine","The Cars","REO Speedwagon","Survivor","Europe","Basil Poledouris","Leonard Cohen","Foreigner","David Allan Coe","Prince","Don Henley","Atlanta","Téléphone","Leonard Cohen","George Strait","Judas Priest","Los Bukis","Twisted Sister","Twisted Sister","Dokken","Don Henley","George Strait","Cocteau Twins","John Waite","T.S.O.L.","Dokken","Dokken","The Alan Parsons Project","a-ha","The Dead Milkmen","George Thorogood &amp; The Destroyers","Tom Petty and the Heartbreakers","D.I.","Tom Petty and the Heartbreakers","Night Ranger","Hoodoo Gurus","Loverboy","ZZ Top","Black Flag","The Firm","The Firm","Tom Petty and the Heartbreakers","Ratt","Raven","The Outfield","Blackmill","Meghan Trainor","WALK THE MOON","Kelly Rowland","Tycho","Lil Uzi Vert","Miley Cyrus","Carrie Underwood","Adele","Rick Ross","311","Drake","69 Boyz","Aerosmith","Lynyrd Skynyrd","Mountain","Blue Öyster Cult","Jeezy","Dazz Band","Ed Sheeran","Death Cab for Cutie","The Avett Brothers","Luke Bryan","The Box Tops","Aretha Franklin","Drake","Florence + The Machine","Duelo","The Wonders","Kid Cudi","In This Moment","Sin Bandera","Blue Öyster Cult","The Church","Rockell","Enya","Dixie Chicks","Dolly Parton","Elvis Costello","U2","Miley Cyrus","Foreigner","Amon Amarth","The Greg Kihn Band","Jacques Dutronc","The Mighty Mighty Bosstones","The Byrds","Loretta Lynn","The Yardbirds","Sheriff","The Hollies","Twisted Sister","Barbra Streisand","John Holt","The Marcels","Steriogram","Duran Duran","Ronnie Wood","Boston","Suzi Quatro","38 Special","Lime","Duncan Dhu","The Dream Academy","Fairground Attraction","Tesla","Lynyrd Skynyrd","Rush","Electric Light Orchestra","L.A. Guns","George Benson","Dwight Yoakam","This Mortal Coil","Lulu Santos","Echo &amp; the Bunnymen","Echo &amp; the Bunnymen","Siouxsie and the Banshees","Raffi","The Waterboys","INXS","Van Morrison","Soundgarden","Spinal Tap","Steve Miller Band","Boston","Beirut","RAC","Luke Bryan","Kim Carnes","Bruno Mars","John Mayer","Tove Lo","Rise Against","Paramore","Vance Joy","Cheryl Lynn","Who Is Fancy","Tone-Loc","Harry Belafonte","Britney Spears","Taylor Swift","Norah Jones","Pink Floyd","Air Supply","Aerosmith","Divinyls","Daryl Hall &amp; John Oates","Seether","Glee Cast","Danny Brown","The Pointer Sisters","PRETTYMUCH","Babyface","The Charlatans","Naked Eyes","Toby Keith","Don Williams","M83","Boston","Donny Hathaway","The Whispers","Madonna","Doves","Weezer","The Pointer Sisters","Los Lobos","Icehouse","Yaz","Evelyn \"Champagne\" King","APO Hiking Society","Orange Juice","Randy Travis","Alphaville","Alphaville","Alphaville","Alphaville","a-ha","a-ha","a-ha","a-ha","a-ha","Loverboy","Eurythmics","Cyndi Lauper","Chuck Berry","When In Rome","Pat Benatar","Haircut 100","The J. Geils Band","The J. Geils Band","DEVO","Queen","Tommy Tutone","John Mellencamp","Michael Jackson","Prince","Naked Eyes","Wham!","Marvin Gaye","Michael McDonald","Bobby Brown","Van Halen","Katrina &amp; The Waves","The Pointer Sisters","Patty Smyth","Wang Chung","Tom Petty and the Heartbreakers","John Farnham","Ramones","The Primitives","Modern Talking","Modern Talking","The Cars","Modern Talking","Modern Talking","Modern Talking","Orchestral Manoeuvres In The Dark","Modern Talking","Pixies","Bruce Springsteen","38 Special","Canned Heat","Culture Club","Tiffany","Barbra Streisand","Debbie Gibson","Madonna","The Stranglers","Squeeze","Bananarama","Europe","Prince","INXS","Kajagoogoo","Herb Alpert","The Fixx","Janet Jackson","The Hooters","INXS","Culture Club","The Pointer Sisters","Pete Townshend","Heart","Journey","Billy Joel","Survivor","Ministry","The Sugarcubes","Missing Persons","Bananarama","The Cars","Righeira","Boney M.","ZZ Top","The Cars","Quiet Riot","Depeche Mode","Nine Inch Nails","R.E.M.","Emmylou Harris","Clint Black","Willie Nelson","George Strait","The Outfield","Clan of Xymox","Electric Light Orchestra","Electric Light Orchestra","Madonna","Generation X","Echo &amp; the Bunnymen","Killing Joke","Missing Persons","Cheap Trick","Judas Priest","Nat King Cole","Peter Cetera","Billy Joel","Savage","A Flock Of Seagulls","John Mellencamp","Eddie Money","John Mellencamp","Bruce Springsteen","Bruce Springsteen","ZZ Top","Ready For The World","Shelly West","John Mellencamp","The Outfield","Caifanes","Black Flag","Circle Jerks","Exile","Journey","Soda Stereo","Soda Stereo","Jesse Johnson","Orchestral Manoeuvres In The Dark","Siouxsie and the Banshees","Bauhaus","The Dead Milkmen","Yaz","Howard Jones","Lindsey Buckingham","The Blues Brothers","John Mellencamp","Belouis Some","Ministry","Squeeze","Ultravox","Vicious Pink","Belouis Some","Journey","The Plimsouls","Shriekback","Miami Sound Machine","\"Weird Al\" Yankovic","\"Weird Al\" Yankovic","Penguin Cafe Orchestra","Journey","Alabama","The Smithereens","Dead Kennedys","John Mellencamp","The Pointer Sisters","Sheena Easton","38 Special","Journey","Fleetwood Mac","Édith Piaf","DJ Jazzy Jeff &amp; The Fresh Prince","Quiet Riot","Erasure","New Order","New Order","New Order","Steel Pulse","Ini Kamoze","Stevie Ray Vaughan","Huey Lewis &amp; The News","The Jesus and Mary Chain","Air Supply","Madness","Gene Loves Jezebel","Suicidal Tendencies","Siouxsie and the Banshees","Air Supply","The Greg Kihn Band","Nazareth","When In Rome","The Cramps","Minutemen","Vicente Fernández","Social Distortion","Run–D.M.C.","Pixies","Sandra","The Colourfield","2 LIVE CREW","Red Rockers","Information Society","The Kinks"],["Forever Young","Once Upon A Christmas","Desert Moon","Recuerdos II","Línea Azul - Vol. VIII - Volver","Vital Signs","Best Of 85-95","Heartbeat City","Wheels Are Turnin'","Vital Signs","Wings Of Tomorrow","Conan The Destroyer","Various Positions","Agent Provocateur","Just Divorced","Purple Rain","Building The Perfect Beast","Pictures","Un autre monde","Various Positions","Does Fort Worth Ever Cross Your Mind","Defenders Of The Faith","Mi Fantasia","Stay Hungry","Stay Hungry","Tooth And Nail","Building The Perfect Beast","Does Fort Worth Ever Cross Your Mind","Treasure","No Brakes","Change Today?","Tooth And Nail","Tooth And Nail","Ammonia Avenue","Hunting High And Low","Big Lizard In My Back Yard","Maverick","Southern Accents","Horse Bites Dog Cries","Southern Accents","7 Wishes","Mars Needs Guitars!","Lovin' Every Minute Of It","Afterburner","Loose Nut","The Firm","The Firm","Southern Accents","Invasion Of Your Privacy","Stay Hard","Play Deep","Miracle","Title","TALKING IS HARD","Here I Am","Dive","The Perfect LUV Tape","Bangerz (Deluxe Version)","Blown Away","21","Port Of Miami","Greatest Hits '93 - '03","More Life","199 Quad (w/ Bonus Dvd)","Get Your Wings","Pronounced' Leh-'Nerd 'Skin-'Nerd","Climbing!","Agents Of Fortune","The Recession","20th Century Masters: The Millennium Collection: Best Of The Dazz Band","÷","Narrow Stairs","I And Love And You","Doin' My Thing","The Letter/Neon Rainbow","Aretha Now","If You're Reading This It's Too Late","Lungs","Solamente Tú","That Thing You Do! Original Motion Picture Soundtrack","Man On The Moon: The End Of Day","Black Widow","De Viaje","Fire of Unknown Origin","Starfish","What Are You Lookin' At?","The Lord Of The Rings: The Fellowship Of The Ring (Original Motion Picture Soundtrack)","Wide Open Spaces","Jolene","My Aim Is True","How To Dismantle An Atomic Bomb","Breakout","4 [Expanded]","Twilight Of The Thunder God","Rockihnroll","Il est cinq heures","Let's Face It","Sweetheart Of The Rodeo","Coal Miner's Daughter","The Yardbirds Story - Pt. 3 - 1965/66 - Big Hits &amp; America Calling","Sheriff","The Hollies' Greatest Hits","Under The Blade","The Way We Were","Police In Helicopter","The Best Of The Marcels","Schmack!","Decade","I've Got My Own Album To Do","Don't Look Back","If You Knew Suzi… (2017 Remaster)","Special Forces","Lime II","Canciones","The Dream Academy","The First Of A Million Kisses","Mechanical Resonance","The Last Rebel","Power Windows","Time","L.A. Guns","In Your Eyes","Buenas Noches From A Lonely Room","It'll End In Tears (Remastered)","Toda Forma De Amor","Ocean Rain","Crocodiles","A Kiss In The Dreamhouse","Baby Beluga","The Waterboys","Listen Like Thieves","Veedon Fleece","Louder Than Love","This Is Spinal Tap","The Joker","Boston","Gulag Orkestar","Strangers","Tailgates &amp; Tanlines","Mistaken Identity","Doo-Wops &amp; Hooligans","Battle Studies","Queen Of The Clouds","Appeal To Reason","After Laughter","Dream Your Life Away","Cheryl Lynn (Expanded Edition)","Goodbye","Loc-ed After Dark","Jump Up Calypso","Britney (Digital Deluxe Version)","Speak Now","Come Away With Me","The Dark Side of the Moon","The One That You Love","Big Ones","Divinyls","Rock 'N Soul, Part 1","Isolate And Medicate","Glee: The Music, The Complete Season Four","Old","Break Out","Would You Mind","Lovers","Some Friendly","Best Of","Dream Walkin'","Don Williams 20 Greatest Hits","Saturdays = Youth","Greatest Hits","Everything Is Everything","The Whispers: Greatest Hits","Celebration","The Last Broadcast","Pinkerton","Break Out (1983 Version - Expanded Edition)","La Bamba (Original Motion Picture Soundtrack)","Modern Girls - Original Motion Picture Soundtrack","You And Me Both","I'm In Love","Ten Years Together","You Can't Hide Your Love Forever","Always &amp; Forever","Forever Young","Forever Young","Forever Young","Afternoons In Utopia","Hunting High And Low","Stay On These Roads","Hunting High And Low","Scoundrel Days","Scoundrel Days","Get Lucky","Sweet Dreams (Are Made Of This)","She's So Unusual","Rock 'N' Roll Rarities","When In Rome","Tropico","Pelican West Plus","Freeze Frame","Love Stinks","Freedom Of Choice","Flash Gordon","Tommy Tutone - 2","American Fool","Thriller 25 Super Deluxe Edition","Parade - Music From The Motion Picture Under The Cherry Moon","Burning Bridges","Make It Big","Midnight Love","If That's What It Takes","Don't Be Cruel","5150","Katrina &amp; The Waves","So Excited! (Expanded Edition)","Patty Smyth's Greatest Hits Featuring Scandal","Points On The Curve","Long After Dark","Whispering Jack","Halfway To Sanity","Lovely","Let's Talk About Love","Let's Talk About Love","Shake It Up","Let's Talk About Love","In The Garden Of Venus","Ready For Romance","Crush","The First &amp; Second Album (30th Anniversary Edition)","Surfer Rosa (Remastered)","The River","Tour De Force","The Best Of Canned Heat","Kissing To Be Clever","Tiffany","Guilty","Out Of The Blue","Madonna","La Folie","East Side Story","Bananarama","The Final Countdown","Around The World In A Day","Kick","White Feathers","Fandango","Reach The Beach","Control","Super Hits","Listen Like Thieves","This Time","Special Things (Bonus Track Version)","Empty Glass","Bad Animals","Frontiers","The Nylon Curtain","When Seconds Count","With Sympathy","Life's Too Good","Spring Session M.","Bananarama","Heartbeat City","Best of Righeira","Fantastic Boney M.","The ZZ Top Six Pack","Shake It Up","Condition Critical","Catching Up With Depeche Mode","Pretty Hate Machine","Green","Cimarron","Killin' Time","Half Nelson","Strait From The Heart","Play Deep","Medusa","Time","Time","Madonna","Kiss Me Deadly","Porcupine","Night Time","Spring Session M.","One On One","British Steel","Nat King Cole Sings George Shearing Plays","Solitude / Solitaire","An Innocent Man","Tonight","We Are The '80s","American Fool","Can'T Hold Back","Uh-HUH!","Nebraska","Nebraska","Eliminator","Ready For The World","West By West","Scarecrow","Play Deep","Caifanes","Damaged","Wild in the Streets","Greatest Hits","Raised On Radio","Nada Personal","Originales - 20 Exitos","Pretty In Pink","The Pacific Age","Hyaena","In The Flat Field","Beelzebubba","Upstairs At Eric's","Dream Into Action","Law And Order","The Blues Brothers: Original Soundtrack Recording","American Fool","Some People","With Sympathy","Argybargy","Quartet (2009 Remaster)","Vicious Pink","Some People","Raised On Radio","Everywhere At Once","Oil &amp; Gold","Primitive Love","Dare To Be Stupid","Dare To Be Stupid","Broadcasting From Home","Raised On Radio","Livin' Lovin' Rockin' Rollin': The 25th Anniversary Collection","Especially For You","Give Me Convenience or Give Me Death","Uh-HUH!","Break Out (1984 Version - Expanded Edition)","A Private Heaven [Bonus Tracks Version]","Flashback","Escape","Greatest Hits","Eternelle","The Very Best Of D.J. Jazzy Jeff &amp; The Fresh Prince","Footloose (15th Anniversary Collectors' Edition)","Wild!","Brotherhood [Collector's Edition]","Brotherhood [Collector's Edition]","Brotherhood [Collector's Edition]","True Democracy","Ini Kamoze","Texas Flood (Legacy Edition)","Picture This","Darklands","The One That You Love","Absolutely","The House Of Dolls","Suicidal Tendencies","Tinderbox","The One That You Love","Kihnspiracy","Sound Elixir","When In Rome","Off The Bone","Double Nickels On The Dime","Por Tu Maldito Amor","Mommy's Little Monster","Tougher Than Leather","Doolittle","Ten On One","Virgins and Philistines","Is What We Are","Good As Gold","Information Society","State of Confusion"],[1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,2011,2015,2014,2011,2011,2016,2013,2012,2011,2006,2004,2017,1994,1974,1973,1970,1976,2008,2001,2017,2008,2009,2009,1967,1968,2015,2009,2010,1996,2009,2014,2003,1981,1988,1998,2001,1998,1974,1977,2004,2008,1981,2008,1981,1968,1997,1968,1971,2002,1982,1973,1982,1974,1983,1986,2004,1989,1974,1978,1978,1982,1982,1986,1985,1988,1986,1993,1985,1981,1988,1983,1988,1984,1988,1984,1980,1982,1980,1983,1985,1974,1989,1984,1973,1976,2006,2014,2011,1981,2010,2009,2014,2008,2017,2014,1978,2015,1989,1961,2001,2010,2002,1973,1981,1994,1991,1983,2014,2014,2013,1983,2017,1986,1990,1991,1997,1987,2008,1997,1970,1987,2009,2002,1996,1983,1987,1986,1983,1981,1980,1982,1987,1984,1984,1984,1986,1985,1988,1985,1986,1986,1981,1983,1983,1986,1988,1984,1982,1981,1980,1980,1980,1981,1982,1982,1986,1983,1984,1982,1982,1988,1986,1985,1982,1982,1983,1982,1986,1987,1988,1985,1985,1981,1985,1987,1986,1985,1985,1988,1980,1984,1987,1982,1987,1980,1987,1983,1981,1981,1984,1986,1985,1987,1983,1982,1983,1986,1985,1985,1987,1980,1980,1987,1983,1982,1986,1983,1988,1982,1984,1984,1983,1984,1987,1981,1984,1985,1989,1988,1981,1989,1982,1982,1985,1986,1981,1981,1983,1981,1983,1985,1982,1982,1980,1987,1986,1983,1984,1981,1982,1986,1983,1982,1982,1983,1985,1983,1985,1985,1988,1981,1982,1983,1986,1985,1983,1986,1986,1984,1980,1988,1982,1985,1981,1980,1982,1988,1983,1980,1982,1986,1988,1986,1983,1985,1985,1985,1985,1984,1986,1980,1986,1987,1983,1984,1984,1987,1981,1988,1987,1987,1984,1989,1986,1986,1986,1982,1984,1983,1982,1987,1981,1980,1987,1983,1986,1981,1983,1983,1988,1983,1984,1989,1982,1988,1989,1987,1985,1987,1983,1988,1983]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Track Name<\/th>\n      <th>Artist Name<\/th>\n      <th>Album Name<\/th>\n      <th>Year<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":25,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Track Name","targets":1},{"name":"Artist Name","targets":2},{"name":"Album Name","targets":3},{"name":"Year","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="selecting-playlist-songs" class="level3">
<h3 class="anchored" data-anchor-id="selecting-playlist-songs">Selecting Playlist Songs</h3>
<p>Since I wanted the playlist to have a deliberate “rise and fall,” in mood, I decided to methodically control the valence of the playlist. Specifically, I shaped the playlist so that the valence of the selected songs would follow the shape of a sine wave, and create an emotional roller-coaster for listeners to ride.</p>
<p>To implement this:</p>
<ol type="1">
<li><p>I generated a cosine wave scaled between 0 and 1 to define the target valence levels for each of the 12 songs in the playlist.</p></li>
<li><p>I added the anchor songs to the playlist first, placing each one in the position where its valence most closely matched the wave.</p></li>
<li><p>Remaining slots were filled with songs from a filtered pool of candidates that met 2 or more compatibility heuristics (see definitions above). I also restricted the decade of the song to 1980.</p></li>
<li><p>For each remaining position, I selected a song with a valence close to the target value. I allowed for a small tolerance to ensure flexibility in the song choice and still maintain the shape of the wave.</p></li>
</ol>
<p>The code for implementing this is shown below.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>playlist_length <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate cosine wave to model valence progression</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>valence_wave <span class="ot">&lt;-</span> (<span class="fu">cos</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> pi, <span class="at">length.out =</span> playlist_length)) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define valence similarity tolerance</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>tolerance <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty playlist</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>playlist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine anchor songs and ensure uniqueness</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>base_songs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(anchor_songs) <span class="sc">|&gt;</span> <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Select high-confidence candidate songs</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>candidates <span class="ot">&lt;-</span> combined_heuristics <span class="sc">|&gt;</span> </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(heuristic_count <span class="sc">&gt;=</span> <span class="dv">2</span>, decade <span class="sc">==</span> <span class="st">'1980s'</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(track_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of available positions</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>available_slots <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>playlist_length</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Place anchor songs into playlist by matching valence to wave</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(base_songs))) {</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  song <span class="ot">&lt;-</span> base_songs[i, ]</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_slots) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">break</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  diffs <span class="ot">&lt;-</span> <span class="fu">abs</span>(valence_wave[available_slots] <span class="sc">-</span> song<span class="sc">$</span>valence)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  best_slot <span class="ot">&lt;-</span> available_slots[<span class="fu">which.min</span>(diffs)]</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  playlist <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(playlist, song)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  available_slots <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(available_slots, best_slot)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  candidates <span class="ot">&lt;-</span> candidates <span class="sc">|&gt;</span> <span class="fu">filter</span>(track_id <span class="sc">!=</span> song<span class="sc">$</span>track_id)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill remaining slots with best valence matches from candidates</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (slot <span class="cf">in</span> available_slots) {</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  target_valence <span class="ot">&lt;-</span> valence_wave[slot]</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  pool <span class="ot">&lt;-</span> candidates <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">abs</span>(valence <span class="sc">-</span> target_valence) <span class="sc">&lt;=</span> tolerance)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Expand tolerance if needed</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(pool) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Widening tolerance at slot {slot}"</span>))</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>    pool <span class="ot">&lt;-</span> candidates <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">abs</span>(valence <span class="sc">-</span> target_valence) <span class="sc">&lt;=</span> (tolerance <span class="sc">*</span> <span class="dv">2</span>))</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select one matching song if available</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(pool) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(pool, <span class="dv">1</span>)</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    playlist <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(playlist, selected)</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    candidates <span class="ot">&lt;-</span> candidates <span class="sc">|&gt;</span> <span class="fu">filter</span>(track_id <span class="sc">!=</span> selected<span class="sc">$</span>track_id)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"No song could be placed at slot {slot}"</span>))</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add song position index</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>playlist <span class="ot">&lt;-</span> playlist <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">position =</span> <span class="fu">row_number</span>())</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for plotting</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>playlist_long <span class="ot">&lt;-</span> playlist <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(metrics), <span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The final result is an 80s playlist designed to, at some points, make you feel like you’re about to hit 88 mph in Doc’s Delorean, and at others, like you’re slow-dancing alone at prom under a disco ball.</p>


<!-- -->


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-google-gemini" class="csl-entry" role="listitem">
Google Gemini. (2025). <em><span class="nocase">Playlist cover art with references to the cold war era and love.</span></em> <span>Generated using Google Gemini AI.</span>
</div>
<div id="ref-R-core" class="csl-entry" role="listitem">
Team, R. C. (2024). <em>R: A language and environment for statistical computing</em>. <a href="https://www.R-project.org">https://www.R-project.org</a>
</div>
<div id="ref-ggplot2" class="csl-entry" role="listitem">
Wickham, H. (2016). <em>ggplot2: Elegant graphics for data analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org/">https://ggplot2.tidyverse.org/</a>
</div>
<div id="ref-forcats2023" class="csl-entry" role="listitem">
Wickham, H. (2023). <em>Forcats: Tools for working with categorical variables (factors)</em>. <a href="https://CRAN.R-project.org/package=forcats">https://CRAN.R-project.org/package=forcats</a>
</div>
<div id="ref-stringr" class="csl-entry" role="listitem">
Wickham, H. (2024). <em>Stringr: Simple, consistent wrappers for common string operations</em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>
</div>
<div id="ref-dplyr" class="csl-entry" role="listitem">
Wickham, H., Francois, R., Henry, L., &amp; Müller, K. (2024). <em>Dplyr: A grammar of data manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>
</div>
<div id="ref-readr" class="csl-entry" role="listitem">
Wickham, H., &amp; Hester, J. (2024). <em>Readr: Read rectangular text data</em>. <a href="https://CRAN.R-project.org/package=readr">https://CRAN.R-project.org/package=readr</a>
</div>
<div id="ref-knitr" class="csl-entry" role="listitem">
Xie, Y. (2024). <em>Knitr: A general-purpose package for dynamic report generation in r</em>. <a href="https://CRAN.R-project.org/package=knitr">https://CRAN.R-project.org/package=knitr</a>
</div>
<div id="ref-DT" class="csl-entry" role="listitem">
Xie, Y., Allaire, J. J., &amp; S., C. D. L. (2024). <em>DT: An r interface to ’DataTables’ JavaScript library</em>. <a href="https://CRAN.R-project.org/package=DT">https://CRAN.R-project.org/package=DT</a>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This image was generated with Google Gemini <span class="citation" data-cites="google-gemini">(<a href="#ref-google-gemini" role="doc-biblioref">Google Gemini, 2025</a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jlopez-6\.github\.io\/STA9750-2025-SPRING\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb18" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "The Ultimate Playlist: Valence Synth Wave"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Jocely Lopez Luna</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> mp03_ref.bib</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> apa.csl</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Playlist cover art[^1].</span><span class="co">](playlist_cover.jpeg)</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>This image was generated with Google Gemini <span class="co">[</span><span class="ot">@google-gemini</span><span class="co">]</span>.</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r the_bare_necessities, echo=FALSE, eval=TRUE}</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="in">library(DT)</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="in">MINTY &lt;- "#78c2ad"</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="in"># defining metrics that will determine "closeness"</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="in">metrics &lt;- c("acousticness", "danceability", "energy", "instrumentalness", "liveness", "loudness", "speechiness", "valence")</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="in">merged_fpath &lt;- "data/mp03/spotify_millions_songs_join.csv"</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(merged_fpath)){</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="in">  spotify_millions_songs &lt;- </span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_join(songs, join_by(track_id == id, track_name == name, artist_name == artist, duration == duration_ms)) |&gt;</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(decade = paste0((year %/% 10) * 10, "s"))</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(spotify_millions_songs, merged_fpath, row.names = FALSE)</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="in">  spotify_millions_songs &lt;- readr::read_csv(merged_fpath)</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="in"># base songs</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="in">song1 &lt;- spotify_millions_songs |&gt; filter(track_id == "4S1VYqwfkLit9mKVY3MXoo") # Forever Young by Alphaville</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="in">song2 &lt;- spotify_millions_songs |&gt; filter(track_id == "22Ca1a5rQ5g2UFEZ3pp4tL") # The Blue Sky by a-ha</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="in">anchor_songs &lt;- list(song1, song2)</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/peer_songs.csv"</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="in"># What other songs commonly appear on playlists along side these songs?</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="in">peer_songs &lt;- data.frame()</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a><span class="in">for (song in anchor_songs) {</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="in">  playlist_ids &lt;- song |&gt; pull(playlist_id) |&gt; unique() |&gt; as.vector()</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="in">  for (pid in playlist_ids) {</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="in">    peer_songs &lt;- bind_rows(</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="in">      peer_songs,</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a><span class="in">      spotify_millions_songs |&gt;</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="in">        filter(playlist_id == pid) |&gt;</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="in">        distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(peer_songs |&gt; distinct(track_id, .keep_all = TRUE), fname, row.names = FALSE)</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="in">  peer_songs &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a><span class="in"># What songs have a similar key and tempo to these songs</span></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/key_and_tempo.csv"</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="in">  key_and_tempo &lt;- data.frame()</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs){</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="in">    song_key &lt;- unique(song |&gt; pull(key))</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="in">    song_tempo &lt;- unique(song |&gt; pull(tempo))</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a><span class="in">    key_and_tempo &lt;- </span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a><span class="in">      bind_rows(</span></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a><span class="in">        key_and_tempo,</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="in">        spotify_millions_songs |&gt;</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="in">          mutate(</span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a><span class="in">            similar_tempo = case_when(</span></span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a><span class="in">              abs(tempo - unique(song |&gt; pull(tempo))) &lt;= 5 ~ TRUE,</span></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a><span class="in">              TRUE ~ FALSE</span></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a><span class="in">            )) |&gt;</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a><span class="in">          filter(</span></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a><span class="in">            key == song_key,</span></span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a><span class="in">            similar_tempo == TRUE) |&gt;</span></span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a><span class="in">          distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(key_and_tempo, fname, row.names = FALSE)</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a><span class="in">    key_and_tempo &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a><span class="in"># What songs have the same artist?</span></span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/same_artist.csv"</span></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a><span class="in">  same_artist = data.frame()</span></span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs){</span></span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a><span class="in">    song_artist_id &lt;- unique(song |&gt; pull(artist_id))</span></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a><span class="in">    same_artist &lt;- bind_rows(</span></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a><span class="in">      same_artist,</span></span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a><span class="in">      spotify_millions_songs |&gt;</span></span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a><span class="in">        filter(artist_id == song_artist_id) |&gt;</span></span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a><span class="in">        distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(same_artist, fname, row.names = FALSE)</span></span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a><span class="in">    same_artist &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a><span class="in"># What other songs were released in the same year and have similar levels of acousticness, danceability, etc.</span></span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/all_similar_songs.csv"</span></span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a><span class="in">  all_similar_songs &lt;- data.frame()</span></span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a><span class="in">  #' Calculate Similar Songs Based on Selected Metrics</span></span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a><span class="in">  #' This function identifies songs similar to a given song by calculating the Euclidean distance between </span></span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a><span class="in">  #' the selected metrics (e.g., acousticness, danceability, energy, etc.) of the input song and all other songs</span></span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a><span class="in">  #' from the same year. Only songs with a distance smaller than a specified threshold (2.5) are considered similar.</span></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @param song A data frame representing a single song, containing columns for song characteristics (e.g., `track_id`, `year`, and metrics like `acousticness`, `danceability`, etc.).</span></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @param std_songs A data frame representing the standardized set of songs to compare against, which must include the same metrics as in the `song` argument.</span></span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @param metrics A character vector containing the names of the metrics to be used in calculating the similarity (e.g., `c("acousticness", "danceability", "energy", "valence")`).</span></span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @return A data frame with songs that are similar to the input song, based on the Euclidean distance between their metric values. The songs are filtered by a distance threshold of 2.5, </span></span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a><span class="in">  #'         and they are ordered by their proximity to the input song.</span></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @details The function scales the metrics for all songs in the same year as the input song and calculates the Euclidean distance between the input song's metrics and each song's metrics.</span></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a><span class="in">  #'          The distance is computed as the square root of the sum of squared differences between the selected metrics of the input song and each candidate song.</span></span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a><span class="in">  #'          Only songs with a distance smaller than 2.5 are considered similar.</span></span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @examples</span></span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a><span class="in">  #' # Assuming `song` and `std_songs` are data frames with appropriate structure</span></span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a><span class="in">  #' similar_songs &lt;- calculate_similar_songs(song = song_data, std_songs = song_dataset, metrics = c("acousticness", "danceability", "energy"))</span></span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @export</span></span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a><span class="in">  calculate_similar_songs &lt;- function(song, std_songs, metrics) {</span></span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a><span class="in">    # Filter for songs from the same year and apply scaling to the metrics</span></span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a><span class="in">    std_songs_scaled &lt;- std_songs |&gt;</span></span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(year == unique(song |&gt; pull(year))) |&gt;</span></span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(across(all_of(metrics), scale))</span></span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a><span class="in">    # Get the song vector (metrics for the current song)</span></span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a><span class="in">    song_vec &lt;- std_songs_scaled |&gt;</span></span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(track_id == unique(song |&gt; pull(track_id))) |&gt;</span></span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a><span class="in">      select(all_of(metrics)) |&gt;</span></span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a><span class="in">      as.numeric()</span></span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a><span class="in">    # Assign proper names to the song vector based on metrics</span></span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a><span class="in">    names(song_vec) &lt;- metrics</span></span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a><span class="in">    # Calculate the distance for each song</span></span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a><span class="in">    similar_songs &lt;- std_songs_scaled |&gt;</span></span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(distance = sqrt(</span></span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a><span class="in">        (acousticness - song_vec["acousticness"])^2 +</span></span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a><span class="in">          (danceability - song_vec["danceability"])^2 +</span></span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a><span class="in">          (energy - song_vec["energy"])^2 +</span></span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a><span class="in">          (instrumentalness - song_vec["instrumentalness"])^2 +</span></span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a><span class="in">          (liveness - song_vec["liveness"])^2 +</span></span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a><span class="in">          (loudness - song_vec["loudness"])^2 +</span></span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a><span class="in">          (speechiness - song_vec["speechiness"])^2 +</span></span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a><span class="in">          (valence - song_vec["valence"])^2</span></span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a><span class="in">      )) |&gt;</span></span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a><span class="in">      arrange(distance) |&gt;</span></span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(distance &lt; 2)</span></span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a><span class="in">    # Return the result</span></span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a><span class="in">    return(similar_songs)</span></span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a><span class="in">  anchor_songs &lt;- list(song1, song2)</span></span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a><span class="in">  # For loop to calculate similar songs for each song and bind the rows</span></span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs) {</span></span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a><span class="in">    similar_songs &lt;- calculate_similar_songs(song, spotify_millions_songs, metrics)</span></span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a><span class="in">    all_similar_songs &lt;- bind_rows(all_similar_songs, similar_songs)</span></span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(all_similar_songs, fname, row.names = FALSE)</span></span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a><span class="in">    all_similar_songs &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a><span class="in"># What songs are in the same decade and have a similar duration?</span></span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a><span class="in"># add decade to song data.frames</span></span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a><span class="in">song1 &lt;- song1 |&gt; mutate(decade = as.character((year %/% 10) * 10))</span></span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a><span class="in">song2 &lt;- song2 |&gt; mutate(decade = as.character((year %/% 10) * 10))</span></span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a><span class="in">anchor_songs &lt;- list(song1, song2)</span></span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/decade_and_song_length.csv"</span></span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)) {</span></span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a><span class="in">  decade_and_song_length &lt;- data.frame()</span></span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs) {</span></span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a><span class="in">    song_decade &lt;- unique(song$decade)</span></span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a><span class="in">    song_length &lt;- unique(song$duration)</span></span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a><span class="in">    matched_songs &lt;- spotify_millions_songs |&gt;</span></span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(</span></span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a><span class="in">        similar_duration = abs(duration - song_length) &lt;= 15 * 1000</span></span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a><span class="in">      ) |&gt; </span></span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(</span></span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a><span class="in">        decade == song_decade,</span></span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a><span class="in">        similar_duration</span></span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a><span class="in">      ) |&gt;</span></span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a><span class="in">    decade_and_song_length &lt;- bind_rows(decade_and_song_length, matched_songs)</span></span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(decade_and_song_length, fname, row.names = FALSE)</span></span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a><span class="in">  decade_and_song_length &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a><span class="in"># combining heuristics to generate candidates for ultimate playlist selection.</span></span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a><span class="in">standardize_inputs &lt;- function(df, source_name) {</span></span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a><span class="in">  df |&gt;</span></span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(</span></span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a><span class="in">      source = source_name,</span></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a><span class="in">      duration = as.numeric(duration),</span></span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a><span class="in">      playlist_position = as.integer(`playlist_position`),</span></span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a><span class="in">      playlist_id = as.integer(playlist_id),</span></span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a><span class="in">      playlist_followers = as.integer(playlist_followers),</span></span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a><span class="in">      year = as.integer(year),</span></span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a><span class="in">      acousticness = as.numeric(acousticness),</span></span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a><span class="in">      danceability = as.numeric(danceability),</span></span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a><span class="in">      energy = as.numeric(energy),</span></span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a><span class="in">      instrumentalness = as.numeric(instrumentalness),</span></span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a><span class="in">      liveness = as.numeric(liveness),</span></span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a><span class="in">      loudness = as.numeric(loudness),</span></span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a><span class="in">      speechiness = as.numeric(speechiness),</span></span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a><span class="in">      tempo = as.numeric(tempo),</span></span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a><span class="in">      valence = as.numeric(valence),</span></span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a><span class="in">      mode = as.integer(mode),</span></span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a><span class="in">      key = as.integer(key),</span></span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a><span class="in">      popularity = as.numeric(popularity),</span></span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a><span class="in">      explicit = as.integer(explicit),</span></span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a><span class="in">      decade = as.character(decade),</span></span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a><span class="in">combined_heuristics &lt;-</span></span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a><span class="in">  bind_rows(</span></span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a><span class="in">  standardize_inputs(all_similar_songs, "all_similar_songs"),</span></span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a><span class="in">  standardize_inputs(key_and_tempo, "key_and_tempo"),</span></span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a><span class="in">  standardize_inputs(same_artist, "same_artist"),</span></span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a><span class="in">  standardize_inputs(peer_songs, "peer_songs"),</span></span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a><span class="in">  standardize_inputs(decade_and_song_length, "decade_and_song_length")</span></span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a><span class="in">) |&gt;</span></span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a><span class="in">  add_count(track_id, name = "heuristic_count") |&gt;</span></span>
<span id="cb18-262"><a href="#cb18-262" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-263"><a href="#cb18-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-264"><a href="#cb18-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-265"><a href="#cb18-265" aria-hidden="true" tabindex="-1"></a><span class="in">#  Set seed for reproducibility</span></span>
<span id="cb18-266"><a href="#cb18-266" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb18-267"><a href="#cb18-267" aria-hidden="true" tabindex="-1"></a><span class="in">playlist_length &lt;- 12</span></span>
<span id="cb18-268"><a href="#cb18-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-269"><a href="#cb18-269" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate cosine wave to model valence progression</span></span>
<span id="cb18-270"><a href="#cb18-270" aria-hidden="true" tabindex="-1"></a><span class="in">valence_wave &lt;- (cos(seq(0, 2 * pi, length.out = playlist_length)) + 1) / 2</span></span>
<span id="cb18-271"><a href="#cb18-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-272"><a href="#cb18-272" aria-hidden="true" tabindex="-1"></a><span class="in"># Define valence similarity tolerance</span></span>
<span id="cb18-273"><a href="#cb18-273" aria-hidden="true" tabindex="-1"></a><span class="in">tolerance &lt;- 0.05</span></span>
<span id="cb18-274"><a href="#cb18-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-275"><a href="#cb18-275" aria-hidden="true" tabindex="-1"></a><span class="in"># Initialize empty playlist</span></span>
<span id="cb18-276"><a href="#cb18-276" aria-hidden="true" tabindex="-1"></a><span class="in">playlist &lt;- data.frame()</span></span>
<span id="cb18-277"><a href="#cb18-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-278"><a href="#cb18-278" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine anchor songs and ensure uniqueness</span></span>
<span id="cb18-279"><a href="#cb18-279" aria-hidden="true" tabindex="-1"></a><span class="in">base_songs &lt;- bind_rows(anchor_songs) |&gt; distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-280"><a href="#cb18-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-281"><a href="#cb18-281" aria-hidden="true" tabindex="-1"></a><span class="in"># Select high-confidence candidate songs</span></span>
<span id="cb18-282"><a href="#cb18-282" aria-hidden="true" tabindex="-1"></a><span class="in">candidates &lt;- combined_heuristics |&gt; </span></span>
<span id="cb18-283"><a href="#cb18-283" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(heuristic_count &gt;= 2, decade == "1980") |&gt;</span></span>
<span id="cb18-284"><a href="#cb18-284" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-285"><a href="#cb18-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-286"><a href="#cb18-286" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a vector of available positions</span></span>
<span id="cb18-287"><a href="#cb18-287" aria-hidden="true" tabindex="-1"></a><span class="in">available_slots &lt;- 1:playlist_length</span></span>
<span id="cb18-288"><a href="#cb18-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-289"><a href="#cb18-289" aria-hidden="true" tabindex="-1"></a><span class="in"># Place anchor songs into playlist by matching valence to wave</span></span>
<span id="cb18-290"><a href="#cb18-290" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in seq_len(nrow(base_songs))) {</span></span>
<span id="cb18-291"><a href="#cb18-291" aria-hidden="true" tabindex="-1"></a><span class="in">  song &lt;- base_songs[i, ]</span></span>
<span id="cb18-292"><a href="#cb18-292" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(available_slots) == 0) break</span></span>
<span id="cb18-293"><a href="#cb18-293" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-294"><a href="#cb18-294" aria-hidden="true" tabindex="-1"></a><span class="in">  diffs &lt;- abs(valence_wave[available_slots] - song$valence)</span></span>
<span id="cb18-295"><a href="#cb18-295" aria-hidden="true" tabindex="-1"></a><span class="in">  best_slot &lt;- available_slots[which.min(diffs)]</span></span>
<span id="cb18-296"><a href="#cb18-296" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-297"><a href="#cb18-297" aria-hidden="true" tabindex="-1"></a><span class="in">  playlist &lt;- bind_rows(playlist, song)</span></span>
<span id="cb18-298"><a href="#cb18-298" aria-hidden="true" tabindex="-1"></a><span class="in">  available_slots &lt;- setdiff(available_slots, best_slot)</span></span>
<span id="cb18-299"><a href="#cb18-299" aria-hidden="true" tabindex="-1"></a><span class="in">  candidates &lt;- candidates |&gt; filter(track_id != song$track_id)</span></span>
<span id="cb18-300"><a href="#cb18-300" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-301"><a href="#cb18-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-302"><a href="#cb18-302" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill remaining slots with best valence matches from candidates</span></span>
<span id="cb18-303"><a href="#cb18-303" aria-hidden="true" tabindex="-1"></a><span class="in">for (slot in available_slots) {</span></span>
<span id="cb18-304"><a href="#cb18-304" aria-hidden="true" tabindex="-1"></a><span class="in">  target_valence &lt;- valence_wave[slot]</span></span>
<span id="cb18-305"><a href="#cb18-305" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-306"><a href="#cb18-306" aria-hidden="true" tabindex="-1"></a><span class="in">  pool &lt;- candidates |&gt; filter(abs(valence - target_valence) &lt;= tolerance)</span></span>
<span id="cb18-307"><a href="#cb18-307" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-308"><a href="#cb18-308" aria-hidden="true" tabindex="-1"></a><span class="in">  # Expand tolerance if needed</span></span>
<span id="cb18-309"><a href="#cb18-309" aria-hidden="true" tabindex="-1"></a><span class="in">  if (nrow(pool) == 0) {</span></span>
<span id="cb18-310"><a href="#cb18-310" aria-hidden="true" tabindex="-1"></a><span class="in">    message(glue::glue("Widening tolerance at slot {slot}"))</span></span>
<span id="cb18-311"><a href="#cb18-311" aria-hidden="true" tabindex="-1"></a><span class="in">    pool &lt;- candidates |&gt; filter(abs(valence - target_valence) &lt;= (tolerance * 2))</span></span>
<span id="cb18-312"><a href="#cb18-312" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-313"><a href="#cb18-313" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-314"><a href="#cb18-314" aria-hidden="true" tabindex="-1"></a><span class="in">  # Select one matching song if available</span></span>
<span id="cb18-315"><a href="#cb18-315" aria-hidden="true" tabindex="-1"></a><span class="in">  if (nrow(pool) &gt; 0) {</span></span>
<span id="cb18-316"><a href="#cb18-316" aria-hidden="true" tabindex="-1"></a><span class="in">    selected &lt;- sample_n(pool, 1)</span></span>
<span id="cb18-317"><a href="#cb18-317" aria-hidden="true" tabindex="-1"></a><span class="in">    playlist &lt;- bind_rows(playlist, selected)</span></span>
<span id="cb18-318"><a href="#cb18-318" aria-hidden="true" tabindex="-1"></a><span class="in">    candidates &lt;- candidates |&gt; filter(track_id != selected$track_id)</span></span>
<span id="cb18-319"><a href="#cb18-319" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb18-320"><a href="#cb18-320" aria-hidden="true" tabindex="-1"></a><span class="in">    message(glue::glue("No song could be placed at slot {slot}"))</span></span>
<span id="cb18-321"><a href="#cb18-321" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-322"><a href="#cb18-322" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-323"><a href="#cb18-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-324"><a href="#cb18-324" aria-hidden="true" tabindex="-1"></a><span class="in"># Add song position index</span></span>
<span id="cb18-325"><a href="#cb18-325" aria-hidden="true" tabindex="-1"></a><span class="in">playlist &lt;- playlist |&gt; mutate(position = row_number())</span></span>
<span id="cb18-326"><a href="#cb18-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-327"><a href="#cb18-327" aria-hidden="true" tabindex="-1"></a><span class="in"># Reshape for plotting</span></span>
<span id="cb18-328"><a href="#cb18-328" aria-hidden="true" tabindex="-1"></a><span class="in">playlist_long &lt;- playlist |&gt;</span></span>
<span id="cb18-329"><a href="#cb18-329" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(cols = all_of(metrics), names_to = "Metric", values_to = "value") |&gt;</span></span>
<span id="cb18-330"><a href="#cb18-330" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Metric = str_to_title(Metric))</span></span>
<span id="cb18-331"><a href="#cb18-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-332"><a href="#cb18-332" aria-hidden="true" tabindex="-1"></a><span class="fu"># Nomination</span></span>
<span id="cb18-333"><a href="#cb18-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-334"><a href="#cb18-334" aria-hidden="true" tabindex="-1"></a>I hereby nominate this playlist for the Internet’s Best Playlist award. Valence Synth Wave was intentionally crafted to optimize an emotional build-up and release by ordering the songs so that their valence (a measure of musical positivity) follows a cosine wave. This approach was algorithmically driven to create an emotional arc that feels both natural and dynamic.</span>
<span id="cb18-335"><a href="#cb18-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-336"><a href="#cb18-336" aria-hidden="true" tabindex="-1"></a>The figure below visualizes how various song characteristics evolve across the playlist. There is a clear fluctuation across the different characteristics--guaranteeing an emotionally diverse listening experience.</span>
<span id="cb18-337"><a href="#cb18-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=TRUE}</span></span>
<span id="cb18-338"><a href="#cb18-338" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot how each metric changes across the playlist</span></span>
<span id="cb18-339"><a href="#cb18-339" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(playlist_long, aes(x = position, y = value, group = Metric, color = Metric)) +</span></span>
<span id="cb18-340"><a href="#cb18-340" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1) +</span></span>
<span id="cb18-341"><a href="#cb18-341" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb18-342"><a href="#cb18-342" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~Metric, scales = "free_y") +</span></span>
<span id="cb18-343"><a href="#cb18-343" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(breaks = seq(0, 12, by = 1)) +  # &lt;--- this line controls the x-axis ticks</span></span>
<span id="cb18-344"><a href="#cb18-344" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-345"><a href="#cb18-345" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Evolution of Song Metrics Across Playlist",</span></span>
<span id="cb18-346"><a href="#cb18-346" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Playlist Order", y = "Metric Value"</span></span>
<span id="cb18-347"><a href="#cb18-347" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-348"><a href="#cb18-348" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb18-349"><a href="#cb18-349" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb18-350"><a href="#cb18-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-351"><a href="#cb18-351" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tracklist</span></span>
<span id="cb18-352"><a href="#cb18-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-353"><a href="#cb18-353" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r playlist-table, eval=TRUE}</span></span>
<span id="cb18-354"><a href="#cb18-354" aria-hidden="true" tabindex="-1"></a><span class="in"># Display final playlist table</span></span>
<span id="cb18-355"><a href="#cb18-355" aria-hidden="true" tabindex="-1"></a><span class="in">playlist |&gt;</span></span>
<span id="cb18-356"><a href="#cb18-356" aria-hidden="true" tabindex="-1"></a><span class="in">  select(c(position), track_name, artist_name, album_name, year) |&gt;</span></span>
<span id="cb18-357"><a href="#cb18-357" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb18-358"><a href="#cb18-358" aria-hidden="true" tabindex="-1"></a><span class="in">    "Position" = position,</span></span>
<span id="cb18-359"><a href="#cb18-359" aria-hidden="true" tabindex="-1"></a><span class="in">    "Track Name" = track_name,</span></span>
<span id="cb18-360"><a href="#cb18-360" aria-hidden="true" tabindex="-1"></a><span class="in">    "Artist Name" = artist_name,</span></span>
<span id="cb18-361"><a href="#cb18-361" aria-hidden="true" tabindex="-1"></a><span class="in">    "Album Name" = album_name,</span></span>
<span id="cb18-362"><a href="#cb18-362" aria-hidden="true" tabindex="-1"></a><span class="in">    "Year" = year</span></span>
<span id="cb18-363"><a href="#cb18-363" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb18-364"><a href="#cb18-364" aria-hidden="true" tabindex="-1"></a><span class="in">  kable()</span></span>
<span id="cb18-365"><a href="#cb18-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-366"><a href="#cb18-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-367"><a href="#cb18-367" aria-hidden="true" tabindex="-1"></a><span class="fu">## Description</span></span>
<span id="cb18-368"><a href="#cb18-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-369"><a href="#cb18-369" aria-hidden="true" tabindex="-1"></a>This playlist is a nod to the range of sentimentality that only the 80s could deliver—a time when synthesizers carried both dreams and dread. The opening song, "Forever Young" by Alphaville, sets a somber mood, with lead singer Marian Gold reflecting on the looming threat of nuclear annihilation haunting his generation, *“Hoping for the best, but expecting the worst / Are you gonna drop the bomb or not?”* This existential dread gives way to something more personal in a-ha's "The Blue Sky," where we find ourselves at a coffee shop mourning a lost love. A sensitive and forlorn Morten Harket laments, *"It doesn't seem like this / Blue sky's here for me."*</span>
<span id="cb18-370"><a href="#cb18-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-371"><a href="#cb18-371" aria-hidden="true" tabindex="-1"></a>We pivot into something more energetic with "Whip It" by DEVO, a nonsensical but peppy call to arms for personal empowerment. "Love Plus One" by Haircut 100 delves deeper into playful absurdity, hinting at the sun-soaked tropics with bongos and xylophones. This is followed by John Mellencamp’s "Lonely Ol’ Night," a Springsteen-esque rock ballad about seeking fleeting comfort in the face of isolation. *"It's a lonely ol' night / Can I put my arms around you?"* Mellencamp pleads. Meanwhile, INXS’s "What You Need" snaps us out of the melancholy with swagger and urgency with a thumping bass-line and slashes of saxophone.</span>
<span id="cb18-372"><a href="#cb18-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-373"><a href="#cb18-373" aria-hidden="true" tabindex="-1"></a>The mood darkens with George Thorogood &amp; The Destroyers' "I Drink Alone"—an edgy, bluesy anthem of solitude that doubles as a cry for help. Thorogood delivers each line with such boozy conviction, that you can practically smell the whiskey on his breath. Then George Strait’s "I Need Someone Like Me" shifts that loneliness to a country register.</span>
<span id="cb18-374"><a href="#cb18-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-375"><a href="#cb18-375" aria-hidden="true" tabindex="-1"></a>Then "Music For A Found Harmonium" by Penguin Cafe Orchestra plunges us into a simmering tension that gently unravels into a disarmingly playful, jig-like melody. With a flash-bang, Queen’s "Flash" brings bold, bombastic, and camp energy. "I Love You Babe" by Babyface follows with warmth and sincerity, an earnest slow jam that finally says what it means. We close on a high note with Sheena Easton’s "Strut," a fiercely confident song that dares anyone to look away.</span>
<span id="cb18-376"><a href="#cb18-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-377"><a href="#cb18-377" aria-hidden="true" tabindex="-1"></a>Click play to start an emotionally engineered ride through the 1980s!</span>
<span id="cb18-378"><a href="#cb18-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-379"><a href="#cb18-379" aria-hidden="true" tabindex="-1"></a>&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/videoseries?si=Cp3x_n4KvIDKwNQv<span class="dv">&amp;amp;</span>list=PLhqZr66B_GQ5XB6rDFYx6AyFXQHtce5kC" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen&gt;&lt;/iframe&gt;</span>
<span id="cb18-380"><a href="#cb18-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-381"><a href="#cb18-381" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix</span></span>
<span id="cb18-382"><a href="#cb18-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-383"><a href="#cb18-383" aria-hidden="true" tabindex="-1"></a>This data analysis was performed using R, using packages including dplyr, ggplot2, readr, stringr, forcats, DT, and knitr <span class="co">[</span><span class="ot">@R-core; @dplyr; @ggplot2; @readr; @stringr; @forcats2023; @DT; @knitr</span><span class="co">]</span>.</span>
<span id="cb18-384"><a href="#cb18-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-385"><a href="#cb18-385" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Import</span></span>
<span id="cb18-386"><a href="#cb18-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-387"><a href="#cb18-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### Song Characteristics Dataset</span></span>
<span id="cb18-388"><a href="#cb18-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-389"><a href="#cb18-389" aria-hidden="true" tabindex="-1"></a>The song characteristics data set was downloaded from <span class="co">[</span><span class="ot">this URL</span><span class="co">](https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv)</span>, using the code below:</span>
<span id="cb18-390"><a href="#cb18-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-391"><a href="#cb18-391" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE}</span></span>
<span id="cb18-392"><a href="#cb18-392" aria-hidden="true" tabindex="-1"></a><span class="in"># Imports</span></span>
<span id="cb18-393"><a href="#cb18-393" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb18-394"><a href="#cb18-394" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb18-395"><a href="#cb18-395" aria-hidden="true" tabindex="-1"></a><span class="in">library(DT)</span></span>
<span id="cb18-396"><a href="#cb18-396" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb18-397"><a href="#cb18-397" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb18-398"><a href="#cb18-398" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb18-399"><a href="#cb18-399" aria-hidden="true" tabindex="-1"></a><span class="in"># constants</span></span>
<span id="cb18-400"><a href="#cb18-400" aria-hidden="true" tabindex="-1"></a><span class="in">MINTY &lt;- "#78c2ad"</span></span>
<span id="cb18-401"><a href="#cb18-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-402"><a href="#cb18-402" aria-hidden="true" tabindex="-1"></a><span class="in">#' Load Spotify song data</span></span>
<span id="cb18-403"><a href="#cb18-403" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-404"><a href="#cb18-404" aria-hidden="true" tabindex="-1"></a><span class="in">#' This function checks for the existence of a local CSV file containing Spotify song data.</span></span>
<span id="cb18-405"><a href="#cb18-405" aria-hidden="true" tabindex="-1"></a><span class="in">#' If the file does not exist, it downloads it from a remote URL. The function then reads and returns the data as a tibble.</span></span>
<span id="cb18-406"><a href="#cb18-406" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-407"><a href="#cb18-407" aria-hidden="true" tabindex="-1"></a><span class="in">#' @return A tibble containing Spotify song analytics data.</span></span>
<span id="cb18-408"><a href="#cb18-408" aria-hidden="true" tabindex="-1"></a><span class="in">load_songs &lt;- function() {</span></span>
<span id="cb18-409"><a href="#cb18-409" aria-hidden="true" tabindex="-1"></a><span class="in">  directory &lt;- "data/mp03/"</span></span>
<span id="cb18-410"><a href="#cb18-410" aria-hidden="true" tabindex="-1"></a><span class="in">  file_name &lt;- paste0(directory, "spotify_song_analytics.csv")</span></span>
<span id="cb18-411"><a href="#cb18-411" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-412"><a href="#cb18-412" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create the data directory if it doesn't exist</span></span>
<span id="cb18-413"><a href="#cb18-413" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!dir.exists(directory)) {</span></span>
<span id="cb18-414"><a href="#cb18-414" aria-hidden="true" tabindex="-1"></a><span class="in">    dir.create(directory, recursive = TRUE)</span></span>
<span id="cb18-415"><a href="#cb18-415" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-416"><a href="#cb18-416" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-417"><a href="#cb18-417" aria-hidden="true" tabindex="-1"></a><span class="in">  # Download the data file if it's not already present</span></span>
<span id="cb18-418"><a href="#cb18-418" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!file.exists(file_name)) {</span></span>
<span id="cb18-419"><a href="#cb18-419" aria-hidden="true" tabindex="-1"></a><span class="in">    download.file(</span></span>
<span id="cb18-420"><a href="#cb18-420" aria-hidden="true" tabindex="-1"></a><span class="in">      url = "https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv",</span></span>
<span id="cb18-421"><a href="#cb18-421" aria-hidden="true" tabindex="-1"></a><span class="in">      destfile = file_name,</span></span>
<span id="cb18-422"><a href="#cb18-422" aria-hidden="true" tabindex="-1"></a><span class="in">      method = "auto"</span></span>
<span id="cb18-423"><a href="#cb18-423" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-424"><a href="#cb18-424" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-425"><a href="#cb18-425" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-426"><a href="#cb18-426" aria-hidden="true" tabindex="-1"></a><span class="in">  # Read the CSV into a tibble</span></span>
<span id="cb18-427"><a href="#cb18-427" aria-hidden="true" tabindex="-1"></a><span class="in">  songs &lt;- readr::read_csv(file_name)</span></span>
<span id="cb18-428"><a href="#cb18-428" aria-hidden="true" tabindex="-1"></a><span class="in">  return(songs)</span></span>
<span id="cb18-429"><a href="#cb18-429" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-430"><a href="#cb18-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-431"><a href="#cb18-431" aria-hidden="true" tabindex="-1"></a><span class="in"># Load songs into a dataframe</span></span>
<span id="cb18-432"><a href="#cb18-432" aria-hidden="true" tabindex="-1"></a><span class="in">songs &lt;- load_songs()</span></span>
<span id="cb18-433"><a href="#cb18-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-434"><a href="#cb18-434" aria-hidden="true" tabindex="-1"></a>A small amount of clean up was required for this data set. The code used to process the raw data set is presented below.</span>
<span id="cb18-435"><a href="#cb18-435" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE}</span></span>
<span id="cb18-436"><a href="#cb18-436" aria-hidden="true" tabindex="-1"></a><span class="in"># Instructor provided code for cleaning artist string</span></span>
<span id="cb18-437"><a href="#cb18-437" aria-hidden="true" tabindex="-1"></a><span class="in">clean_artist_string &lt;- function(x){</span></span>
<span id="cb18-438"><a href="#cb18-438" aria-hidden="true" tabindex="-1"></a><span class="in">  x |&gt;</span></span>
<span id="cb18-439"><a href="#cb18-439" aria-hidden="true" tabindex="-1"></a><span class="in">    str_replace_all("\\['", "") |&gt;</span></span>
<span id="cb18-440"><a href="#cb18-440" aria-hidden="true" tabindex="-1"></a><span class="in">    str_replace_all("'\\]", "") |&gt;</span></span>
<span id="cb18-441"><a href="#cb18-441" aria-hidden="true" tabindex="-1"></a><span class="in">    str_replace_all("[ ]?'", "") |&gt;</span></span>
<span id="cb18-442"><a href="#cb18-442" aria-hidden="true" tabindex="-1"></a><span class="in">    str_replace_all("[ ]*,[ ]*", ",")</span></span>
<span id="cb18-443"><a href="#cb18-443" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-444"><a href="#cb18-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-445"><a href="#cb18-445" aria-hidden="true" tabindex="-1"></a><span class="in"># Split songs with multiple artists into separate rows and clean artist names</span></span>
<span id="cb18-446"><a href="#cb18-446" aria-hidden="true" tabindex="-1"></a><span class="in">songs &lt;-</span></span>
<span id="cb18-447"><a href="#cb18-447" aria-hidden="true" tabindex="-1"></a><span class="in">  songs |&gt; </span></span>
<span id="cb18-448"><a href="#cb18-448" aria-hidden="true" tabindex="-1"></a><span class="in">  separate_longer_delim(artists, ",") |&gt;</span></span>
<span id="cb18-449"><a href="#cb18-449" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(artist = clean_artist_string(artists)) |&gt;</span></span>
<span id="cb18-450"><a href="#cb18-450" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-artists)</span></span>
<span id="cb18-451"><a href="#cb18-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-452"><a href="#cb18-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-453"><a href="#cb18-453" aria-hidden="true" tabindex="-1"></a><span class="fu">### Playlists Dataset</span></span>
<span id="cb18-454"><a href="#cb18-454" aria-hidden="true" tabindex="-1"></a>The playlists data set was downloaded from <span class="co">[</span><span class="ot">this URL</span><span class="co">](https://raw.githubusercontent.com/DevinOgrady/spotify_million_playlist_dataset/main/data1/)</span>, using the code outlined below:</span>
<span id="cb18-455"><a href="#cb18-455" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE}</span></span>
<span id="cb18-456"><a href="#cb18-456" aria-hidden="true" tabindex="-1"></a><span class="in">#' Load Spotify playlist data</span></span>
<span id="cb18-457"><a href="#cb18-457" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-458"><a href="#cb18-458" aria-hidden="true" tabindex="-1"></a><span class="in">#' This function downloads and/or reads the Million Playlist Dataset slices from </span></span>
<span id="cb18-459"><a href="#cb18-459" aria-hidden="true" tabindex="-1"></a><span class="in">#' a GitHub repository. If `read_only = TRUE`, it skips downloading and only reads </span></span>
<span id="cb18-460"><a href="#cb18-460" aria-hidden="true" tabindex="-1"></a><span class="in">#' existing local files.</span></span>
<span id="cb18-461"><a href="#cb18-461" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-462"><a href="#cb18-462" aria-hidden="true" tabindex="-1"></a><span class="in">#' @param read_only Logical. If TRUE, skips download and only loads local data. Default is FALSE.</span></span>
<span id="cb18-463"><a href="#cb18-463" aria-hidden="true" tabindex="-1"></a><span class="in">#' @return A list of parsed JSON objects representing playlist data.</span></span>
<span id="cb18-464"><a href="#cb18-464" aria-hidden="true" tabindex="-1"></a><span class="in">load_playlists &lt;- function(read_only = FALSE) {</span></span>
<span id="cb18-465"><a href="#cb18-465" aria-hidden="true" tabindex="-1"></a><span class="in">  source_root_url &lt;- "https://raw.githubusercontent.com/DevinOgrady/spotify_million_playlist_dataset/main/data1/"</span></span>
<span id="cb18-466"><a href="#cb18-466" aria-hidden="true" tabindex="-1"></a><span class="in">  directory &lt;- "data/mp03/mpd/"</span></span>
<span id="cb18-467"><a href="#cb18-467" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-468"><a href="#cb18-468" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create directory if it doesn't exist</span></span>
<span id="cb18-469"><a href="#cb18-469" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!dir.exists(directory)) {</span></span>
<span id="cb18-470"><a href="#cb18-470" aria-hidden="true" tabindex="-1"></a><span class="in">    dir.create(directory, recursive = TRUE)</span></span>
<span id="cb18-471"><a href="#cb18-471" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-472"><a href="#cb18-472" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-473"><a href="#cb18-473" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!read_only) {</span></span>
<span id="cb18-474"><a href="#cb18-474" aria-hidden="true" tabindex="-1"></a><span class="in">    # Loop over all playlist slice file names</span></span>
<span id="cb18-475"><a href="#cb18-475" aria-hidden="true" tabindex="-1"></a><span class="in">    for (i in seq(0, 999000, by = 1000)) {</span></span>
<span id="cb18-476"><a href="#cb18-476" aria-hidden="true" tabindex="-1"></a><span class="in">      fname &lt;- paste0(</span></span>
<span id="cb18-477"><a href="#cb18-477" aria-hidden="true" tabindex="-1"></a><span class="in">        "mpd.slice.",</span></span>
<span id="cb18-478"><a href="#cb18-478" aria-hidden="true" tabindex="-1"></a><span class="in">        format(i, scientific = FALSE), "-",</span></span>
<span id="cb18-479"><a href="#cb18-479" aria-hidden="true" tabindex="-1"></a><span class="in">        format(i + 999, scientific = FALSE),</span></span>
<span id="cb18-480"><a href="#cb18-480" aria-hidden="true" tabindex="-1"></a><span class="in">        ".json"</span></span>
<span id="cb18-481"><a href="#cb18-481" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb18-482"><a href="#cb18-482" aria-hidden="true" tabindex="-1"></a><span class="in">      fpath &lt;- file.path(directory, fname)</span></span>
<span id="cb18-483"><a href="#cb18-483" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb18-484"><a href="#cb18-484" aria-hidden="true" tabindex="-1"></a><span class="in">      # Download file if it's not already present</span></span>
<span id="cb18-485"><a href="#cb18-485" aria-hidden="true" tabindex="-1"></a><span class="in">      if (!file.exists(fpath)) {</span></span>
<span id="cb18-486"><a href="#cb18-486" aria-hidden="true" tabindex="-1"></a><span class="in">        Sys.sleep(0.01)  # Avoid hitting rate limits</span></span>
<span id="cb18-487"><a href="#cb18-487" aria-hidden="true" tabindex="-1"></a><span class="in">        tryCatch({</span></span>
<span id="cb18-488"><a href="#cb18-488" aria-hidden="true" tabindex="-1"></a><span class="in">          invisible(download.file(</span></span>
<span id="cb18-489"><a href="#cb18-489" aria-hidden="true" tabindex="-1"></a><span class="in">            url = paste0(source_root_url, fname),</span></span>
<span id="cb18-490"><a href="#cb18-490" aria-hidden="true" tabindex="-1"></a><span class="in">            destfile = fpath,</span></span>
<span id="cb18-491"><a href="#cb18-491" aria-hidden="true" tabindex="-1"></a><span class="in">            method = "auto",</span></span>
<span id="cb18-492"><a href="#cb18-492" aria-hidden="true" tabindex="-1"></a><span class="in">            quiet = TRUE</span></span>
<span id="cb18-493"><a href="#cb18-493" aria-hidden="true" tabindex="-1"></a><span class="in">          ))</span></span>
<span id="cb18-494"><a href="#cb18-494" aria-hidden="true" tabindex="-1"></a><span class="in">        }, error = function(e) {</span></span>
<span id="cb18-495"><a href="#cb18-495" aria-hidden="true" tabindex="-1"></a><span class="in">          message("Download failed: ", fname)</span></span>
<span id="cb18-496"><a href="#cb18-496" aria-hidden="true" tabindex="-1"></a><span class="in">        })</span></span>
<span id="cb18-497"><a href="#cb18-497" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb18-498"><a href="#cb18-498" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb18-499"><a href="#cb18-499" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-500"><a href="#cb18-500" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-501"><a href="#cb18-501" aria-hidden="true" tabindex="-1"></a><span class="in">  # Read all the JSON files in the directory</span></span>
<span id="cb18-502"><a href="#cb18-502" aria-hidden="true" tabindex="-1"></a><span class="in">  json_files &lt;- list.files(directory, pattern = "\\.json$", full.names = TRUE)</span></span>
<span id="cb18-503"><a href="#cb18-503" aria-hidden="true" tabindex="-1"></a><span class="in">  all_data &lt;- vector("list", length(json_files))</span></span>
<span id="cb18-504"><a href="#cb18-504" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-505"><a href="#cb18-505" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in seq_along(json_files)) {</span></span>
<span id="cb18-506"><a href="#cb18-506" aria-hidden="true" tabindex="-1"></a><span class="in">    tryCatch({</span></span>
<span id="cb18-507"><a href="#cb18-507" aria-hidden="true" tabindex="-1"></a><span class="in">      all_data[[i]] &lt;- suppressWarnings(jsonlite::fromJSON(json_files[i]))</span></span>
<span id="cb18-508"><a href="#cb18-508" aria-hidden="true" tabindex="-1"></a><span class="in">    }, error = function(e) {</span></span>
<span id="cb18-509"><a href="#cb18-509" aria-hidden="true" tabindex="-1"></a><span class="in">      message("Failed to read: ", json_files[i])</span></span>
<span id="cb18-510"><a href="#cb18-510" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb18-511"><a href="#cb18-511" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-512"><a href="#cb18-512" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-513"><a href="#cb18-513" aria-hidden="true" tabindex="-1"></a><span class="in">  return(all_data)</span></span>
<span id="cb18-514"><a href="#cb18-514" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-515"><a href="#cb18-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-516"><a href="#cb18-516" aria-hidden="true" tabindex="-1"></a><span class="in">SPOTIFY_MILLIONS &lt;- load_playlists()</span></span>
<span id="cb18-517"><a href="#cb18-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-518"><a href="#cb18-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-519"><a href="#cb18-519" aria-hidden="true" tabindex="-1"></a>Since the playlist data set was hierarchical, it required "rectangling," to be adapted for use in this analysis. This process was accomplished with the following code.</span>
<span id="cb18-520"><a href="#cb18-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = TRUE}</span></span>
<span id="cb18-521"><a href="#cb18-521" aria-hidden="true" tabindex="-1"></a><span class="in">#' Process a Spotify playlist slice</span></span>
<span id="cb18-522"><a href="#cb18-522" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-523"><a href="#cb18-523" aria-hidden="true" tabindex="-1"></a><span class="in">#' This function processes a single playlist slice from the Million Playlist Dataset,</span></span>
<span id="cb18-524"><a href="#cb18-524" aria-hidden="true" tabindex="-1"></a><span class="in">#' extracting track information and saving it as a CSV file for faster future loading.</span></span>
<span id="cb18-525"><a href="#cb18-525" aria-hidden="true" tabindex="-1"></a><span class="in">#' It strips Spotify URI prefixes and appends playlist metadata.</span></span>
<span id="cb18-526"><a href="#cb18-526" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-527"><a href="#cb18-527" aria-hidden="true" tabindex="-1"></a><span class="in">#' @param playlist A list object representing one slice of the Spotify playlist data (parsed JSON).</span></span>
<span id="cb18-528"><a href="#cb18-528" aria-hidden="true" tabindex="-1"></a><span class="in">#' @return A data frame (tibble) of processed track data with playlist-level metadata.</span></span>
<span id="cb18-529"><a href="#cb18-529" aria-hidden="true" tabindex="-1"></a><span class="in">process &lt;- function(playlist) {</span></span>
<span id="cb18-530"><a href="#cb18-530" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-531"><a href="#cb18-531" aria-hidden="true" tabindex="-1"></a><span class="in">  # Instructor provided helper function to strip Spotify URI prefix</span></span>
<span id="cb18-532"><a href="#cb18-532" aria-hidden="true" tabindex="-1"></a><span class="in">  strip_spotify_prefix &lt;- function(x) {</span></span>
<span id="cb18-533"><a href="#cb18-533" aria-hidden="true" tabindex="-1"></a><span class="in">    str_replace(x, ".*:.*:", "")</span></span>
<span id="cb18-534"><a href="#cb18-534" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-535"><a href="#cb18-535" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-536"><a href="#cb18-536" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create the output directory if it doesn't exist</span></span>
<span id="cb18-537"><a href="#cb18-537" aria-hidden="true" tabindex="-1"></a><span class="in">  output_dir &lt;- "data/mp03/processed"</span></span>
<span id="cb18-538"><a href="#cb18-538" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!dir.exists(output_dir)){</span></span>
<span id="cb18-539"><a href="#cb18-539" aria-hidden="true" tabindex="-1"></a><span class="in">    dir.create(output_dir, showWarnings = FALSE)</span></span>
<span id="cb18-540"><a href="#cb18-540" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-541"><a href="#cb18-541" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-542"><a href="#cb18-542" aria-hidden="true" tabindex="-1"></a><span class="in">  # Generate filename for processed slice</span></span>
<span id="cb18-543"><a href="#cb18-543" aria-hidden="true" tabindex="-1"></a><span class="in">  slice_range &lt;- playlist$info$slice</span></span>
<span id="cb18-544"><a href="#cb18-544" aria-hidden="true" tabindex="-1"></a><span class="in">  csv_outfile &lt;- paste0(output_dir, "/mpd.slice.", slice_range, ".csv")</span></span>
<span id="cb18-545"><a href="#cb18-545" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-546"><a href="#cb18-546" aria-hidden="true" tabindex="-1"></a><span class="in">  # If CSV already exists, load it instead of reprocessing</span></span>
<span id="cb18-547"><a href="#cb18-547" aria-hidden="true" tabindex="-1"></a><span class="in">  if (file.exists(csv_outfile)){</span></span>
<span id="cb18-548"><a href="#cb18-548" aria-hidden="true" tabindex="-1"></a><span class="in">    all_tracks &lt;- readr::read_csv(csv_outfile)</span></span>
<span id="cb18-549"><a href="#cb18-549" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb18-550"><a href="#cb18-550" aria-hidden="true" tabindex="-1"></a><span class="in">    all_tracks &lt;- data.frame()  # Placeholder for all processed tracks</span></span>
<span id="cb18-551"><a href="#cb18-551" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-552"><a href="#cb18-552" aria-hidden="true" tabindex="-1"></a><span class="in">    for (i in seq_along(playlist$playlists$tracks)) {</span></span>
<span id="cb18-553"><a href="#cb18-553" aria-hidden="true" tabindex="-1"></a><span class="in">      tracks_df &lt;- as.data.frame(playlist$playlists$tracks[[i]])</span></span>
<span id="cb18-554"><a href="#cb18-554" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb18-555"><a href="#cb18-555" aria-hidden="true" tabindex="-1"></a><span class="in">      # Skip empty playlists</span></span>
<span id="cb18-556"><a href="#cb18-556" aria-hidden="true" tabindex="-1"></a><span class="in">      if (nrow(tracks_df) == 0) next</span></span>
<span id="cb18-557"><a href="#cb18-557" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb18-558"><a href="#cb18-558" aria-hidden="true" tabindex="-1"></a><span class="in">      # Add metadata and clean up Spotify URIs</span></span>
<span id="cb18-559"><a href="#cb18-559" aria-hidden="true" tabindex="-1"></a><span class="in">      tracks_df &lt;- tracks_df |&gt;</span></span>
<span id="cb18-560"><a href="#cb18-560" aria-hidden="true" tabindex="-1"></a><span class="in">        mutate(</span></span>
<span id="cb18-561"><a href="#cb18-561" aria-hidden="true" tabindex="-1"></a><span class="in">          playlist_name = playlist$playlists$name[i],</span></span>
<span id="cb18-562"><a href="#cb18-562" aria-hidden="true" tabindex="-1"></a><span class="in">          playlist_id = playlist$playlists$pid[i],</span></span>
<span id="cb18-563"><a href="#cb18-563" aria-hidden="true" tabindex="-1"></a><span class="in">          playlist_followers = playlist$playlists$num_followers[i],</span></span>
<span id="cb18-564"><a href="#cb18-564" aria-hidden="true" tabindex="-1"></a><span class="in">          track_uri = strip_spotify_prefix(track_uri),</span></span>
<span id="cb18-565"><a href="#cb18-565" aria-hidden="true" tabindex="-1"></a><span class="in">          artist_uri = strip_spotify_prefix(artist_uri),</span></span>
<span id="cb18-566"><a href="#cb18-566" aria-hidden="true" tabindex="-1"></a><span class="in">          album_uri = strip_spotify_prefix(album_uri)</span></span>
<span id="cb18-567"><a href="#cb18-567" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb18-568"><a href="#cb18-568" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb18-569"><a href="#cb18-569" aria-hidden="true" tabindex="-1"></a><span class="in">      # Combine with all previously processed tracks</span></span>
<span id="cb18-570"><a href="#cb18-570" aria-hidden="true" tabindex="-1"></a><span class="in">      all_tracks &lt;- bind_rows(all_tracks, tracks_df)</span></span>
<span id="cb18-571"><a href="#cb18-571" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb18-572"><a href="#cb18-572" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-573"><a href="#cb18-573" aria-hidden="true" tabindex="-1"></a><span class="in">    # Save the processed data for this slice</span></span>
<span id="cb18-574"><a href="#cb18-574" aria-hidden="true" tabindex="-1"></a><span class="in">    write.csv(all_tracks, csv_outfile, row.names = FALSE)</span></span>
<span id="cb18-575"><a href="#cb18-575" aria-hidden="true" tabindex="-1"></a><span class="in">    message("Saved: ", csv_outfile)</span></span>
<span id="cb18-576"><a href="#cb18-576" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-577"><a href="#cb18-577" aria-hidden="true" tabindex="-1"></a><span class="in">  return(all_tracks)</span></span>
<span id="cb18-578"><a href="#cb18-578" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-579"><a href="#cb18-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-580"><a href="#cb18-580" aria-hidden="true" tabindex="-1"></a><span class="in">#' Merge all processed playlist slices into a single dataset</span></span>
<span id="cb18-581"><a href="#cb18-581" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-582"><a href="#cb18-582" aria-hidden="true" tabindex="-1"></a><span class="in">#' This function checks if a master CSV file (`spotify_millions.csv`) already exists.</span></span>
<span id="cb18-583"><a href="#cb18-583" aria-hidden="true" tabindex="-1"></a><span class="in">#' If not, it processes all playlist JSON slices provided and merges them into one</span></span>
<span id="cb18-584"><a href="#cb18-584" aria-hidden="true" tabindex="-1"></a><span class="in">#' unified dataframe, then saves it as a CSV for future use. If the file already exists,</span></span>
<span id="cb18-585"><a href="#cb18-585" aria-hidden="true" tabindex="-1"></a><span class="in">#' it loads the data directly.</span></span>
<span id="cb18-586"><a href="#cb18-586" aria-hidden="true" tabindex="-1"></a><span class="in">#'</span></span>
<span id="cb18-587"><a href="#cb18-587" aria-hidden="true" tabindex="-1"></a><span class="in">#' @param data A list of playlist slices (parsed JSON). Defaults to `master_json`.</span></span>
<span id="cb18-588"><a href="#cb18-588" aria-hidden="true" tabindex="-1"></a><span class="in">#' @return A dataframe containing the merged Spotify playlist data.</span></span>
<span id="cb18-589"><a href="#cb18-589" aria-hidden="true" tabindex="-1"></a><span class="in">merge_processed_playlists &lt;- function(data = master_json) {</span></span>
<span id="cb18-590"><a href="#cb18-590" aria-hidden="true" tabindex="-1"></a><span class="in">  # Path to the master output CSV</span></span>
<span id="cb18-591"><a href="#cb18-591" aria-hidden="true" tabindex="-1"></a><span class="in">  spotify_millions_fpath &lt;- "data/mp03/spotify_millions.csv"</span></span>
<span id="cb18-592"><a href="#cb18-592" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-593"><a href="#cb18-593" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!file.exists(spotify_millions_fpath)) {</span></span>
<span id="cb18-594"><a href="#cb18-594" aria-hidden="true" tabindex="-1"></a><span class="in">    # If no master file exists, process each playlist slice</span></span>
<span id="cb18-595"><a href="#cb18-595" aria-hidden="true" tabindex="-1"></a><span class="in">    playlists &lt;- data.frame()  # Initialize an empty dataframe</span></span>
<span id="cb18-596"><a href="#cb18-596" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-597"><a href="#cb18-597" aria-hidden="true" tabindex="-1"></a><span class="in">    for (i in seq_along(master_json)) {</span></span>
<span id="cb18-598"><a href="#cb18-598" aria-hidden="true" tabindex="-1"></a><span class="in">      playlist &lt;- master_json[[i]]</span></span>
<span id="cb18-599"><a href="#cb18-599" aria-hidden="true" tabindex="-1"></a><span class="in">      processed_df &lt;- process(playlist)  # Process individual slice</span></span>
<span id="cb18-600"><a href="#cb18-600" aria-hidden="true" tabindex="-1"></a><span class="in">      playlists &lt;- bind_rows(playlists, processed_df)  # Append to master dataframe</span></span>
<span id="cb18-601"><a href="#cb18-601" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb18-602"><a href="#cb18-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-603"><a href="#cb18-603" aria-hidden="true" tabindex="-1"></a><span class="in">    # Clean up and standardize column names</span></span>
<span id="cb18-604"><a href="#cb18-604" aria-hidden="true" tabindex="-1"></a><span class="in">    playlists &lt;- playlists |&gt; </span></span>
<span id="cb18-605"><a href="#cb18-605" aria-hidden="true" tabindex="-1"></a><span class="in">      rename(</span></span>
<span id="cb18-606"><a href="#cb18-606" aria-hidden="true" tabindex="-1"></a><span class="in">        playlist_position = `pos`,</span></span>
<span id="cb18-607"><a href="#cb18-607" aria-hidden="true" tabindex="-1"></a><span class="in">        track_id = `track_uri`,</span></span>
<span id="cb18-608"><a href="#cb18-608" aria-hidden="true" tabindex="-1"></a><span class="in">        artist_id = `artist_uri`,</span></span>
<span id="cb18-609"><a href="#cb18-609" aria-hidden="true" tabindex="-1"></a><span class="in">        album_id = `album_uri`,</span></span>
<span id="cb18-610"><a href="#cb18-610" aria-hidden="true" tabindex="-1"></a><span class="in">        duration = `duration_ms`</span></span>
<span id="cb18-611"><a href="#cb18-611" aria-hidden="true" tabindex="-1"></a><span class="in">      ) |&gt;</span></span>
<span id="cb18-612"><a href="#cb18-612" aria-hidden="true" tabindex="-1"></a><span class="in">      select(!`...1`)  # Drop the unnamed index column</span></span>
<span id="cb18-613"><a href="#cb18-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-614"><a href="#cb18-614" aria-hidden="true" tabindex="-1"></a><span class="in">    # Save merged data to CSV</span></span>
<span id="cb18-615"><a href="#cb18-615" aria-hidden="true" tabindex="-1"></a><span class="in">    write.csv(playlists, spotify_millions_fpath, row.names = FALSE)</span></span>
<span id="cb18-616"><a href="#cb18-616" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb18-617"><a href="#cb18-617" aria-hidden="true" tabindex="-1"></a><span class="in">    # If file exists, just read it</span></span>
<span id="cb18-618"><a href="#cb18-618" aria-hidden="true" tabindex="-1"></a><span class="in">    playlists &lt;- readr::read_csv(spotify_millions_fpath)</span></span>
<span id="cb18-619"><a href="#cb18-619" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-620"><a href="#cb18-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-621"><a href="#cb18-621" aria-hidden="true" tabindex="-1"></a><span class="in">  return(playlists)</span></span>
<span id="cb18-622"><a href="#cb18-622" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-623"><a href="#cb18-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-624"><a href="#cb18-624" aria-hidden="true" tabindex="-1"></a><span class="in"># Load or process the Spotify Millions json dataset</span></span>
<span id="cb18-625"><a href="#cb18-625" aria-hidden="true" tabindex="-1"></a><span class="in">SPOTIFY_MILLIONS &lt;- merge_processed_playlists(SPOTIFY_MILLIONS)</span></span>
<span id="cb18-626"><a href="#cb18-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-627"><a href="#cb18-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-628"><a href="#cb18-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-629"><a href="#cb18-629" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial Exploration</span></span>
<span id="cb18-630"><a href="#cb18-630" aria-hidden="true" tabindex="-1"></a>Once the data were squared away, I completed an instructor-led preliminary data analysis, the results of which are tabulated below. First, I compute the total number of distinct tracks and artists contained in this data set. </span>
<span id="cb18-631"><a href="#cb18-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-632"><a href="#cb18-632" aria-hidden="true" tabindex="-1"></a><span class="in"># How many distinct tracks and artists are represented in the playlist data?</span></span>
<span id="cb18-633"><a href="#cb18-633" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/num_distinct.csv"</span></span>
<span id="cb18-634"><a href="#cb18-634" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-635"><a href="#cb18-635" aria-hidden="true" tabindex="-1"></a><span class="in">  num_distinct &lt;-</span></span>
<span id="cb18-636"><a href="#cb18-636" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-637"><a href="#cb18-637" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id) |&gt;</span></span>
<span id="cb18-638"><a href="#cb18-638" aria-hidden="true" tabindex="-1"></a><span class="in">      summarize(`Distinct Tracks` = n()) |&gt;</span></span>
<span id="cb18-639"><a href="#cb18-639" aria-hidden="true" tabindex="-1"></a><span class="in">      cross_join(SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-640"><a href="#cb18-640" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(artist_id) |&gt;</span></span>
<span id="cb18-641"><a href="#cb18-641" aria-hidden="true" tabindex="-1"></a><span class="in">      summarize(`Distinct Artists` = n()))</span></span>
<span id="cb18-642"><a href="#cb18-642" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(num_distinct, fname, row.names = FALSE)</span></span>
<span id="cb18-643"><a href="#cb18-643" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-644"><a href="#cb18-644" aria-hidden="true" tabindex="-1"></a><span class="in">  num_distinct &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-645"><a href="#cb18-645" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-646"><a href="#cb18-646" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-647"><a href="#cb18-647" aria-hidden="true" tabindex="-1"></a><span class="in">num_distinct |&gt;</span></span>
<span id="cb18-648"><a href="#cb18-648" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.numeric), comma)) |&gt;</span></span>
<span id="cb18-649"><a href="#cb18-649" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(caption = "Table 1: Count of Distinct Tracks and Artists in the Playlist Dataset")</span></span>
<span id="cb18-650"><a href="#cb18-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-651"><a href="#cb18-651" aria-hidden="true" tabindex="-1"></a>Next, I identify the 5 most popular tracks in the playlist data.</span>
<span id="cb18-652"><a href="#cb18-652" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r most-popular-tracks}</span></span>
<span id="cb18-653"><a href="#cb18-653" aria-hidden="true" tabindex="-1"></a><span class="in"># What are the 5 most popular tracks in the playlist data?</span></span>
<span id="cb18-654"><a href="#cb18-654" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/most_pop_tracks.csv"</span></span>
<span id="cb18-655"><a href="#cb18-655" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-656"><a href="#cb18-656" aria-hidden="true" tabindex="-1"></a><span class="in">  most_pop_tracks &lt;-</span></span>
<span id="cb18-657"><a href="#cb18-657" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-658"><a href="#cb18-658" aria-hidden="true" tabindex="-1"></a><span class="in">      add_count(track_id, name = "track_count") |&gt;</span></span>
<span id="cb18-659"><a href="#cb18-659" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-660"><a href="#cb18-660" aria-hidden="true" tabindex="-1"></a><span class="in">      slice_max(track_count, n=5)</span></span>
<span id="cb18-661"><a href="#cb18-661" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(most_pop_tracks, fname, row.names = FALSE)</span></span>
<span id="cb18-662"><a href="#cb18-662" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-663"><a href="#cb18-663" aria-hidden="true" tabindex="-1"></a><span class="in">    most_pop_tracks &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-664"><a href="#cb18-664" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-665"><a href="#cb18-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-666"><a href="#cb18-666" aria-hidden="true" tabindex="-1"></a><span class="in">most_pop_tracks |&gt;</span></span>
<span id="cb18-667"><a href="#cb18-667" aria-hidden="true" tabindex="-1"></a><span class="in">  select(</span></span>
<span id="cb18-668"><a href="#cb18-668" aria-hidden="true" tabindex="-1"></a><span class="in">    track_name,</span></span>
<span id="cb18-669"><a href="#cb18-669" aria-hidden="true" tabindex="-1"></a><span class="in">    artist_name,</span></span>
<span id="cb18-670"><a href="#cb18-670" aria-hidden="true" tabindex="-1"></a><span class="in">    album_name,</span></span>
<span id="cb18-671"><a href="#cb18-671" aria-hidden="true" tabindex="-1"></a><span class="in">    track_count,</span></span>
<span id="cb18-672"><a href="#cb18-672" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb18-673"><a href="#cb18-673" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb18-674"><a href="#cb18-674" aria-hidden="true" tabindex="-1"></a><span class="in">    "Track Name" = track_name,</span></span>
<span id="cb18-675"><a href="#cb18-675" aria-hidden="true" tabindex="-1"></a><span class="in">    "Artist Name" = artist_name,</span></span>
<span id="cb18-676"><a href="#cb18-676" aria-hidden="true" tabindex="-1"></a><span class="in">    "Album Name" = album_name,</span></span>
<span id="cb18-677"><a href="#cb18-677" aria-hidden="true" tabindex="-1"></a><span class="in">    "Playlist Appearances" = track_count,</span></span>
<span id="cb18-678"><a href="#cb18-678" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb18-679"><a href="#cb18-679" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.numeric), comma)) |&gt;</span></span>
<span id="cb18-680"><a href="#cb18-680" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(caption = "Table 2: Top 5 Most Popular Tracks in the Playlist Data")</span></span>
<span id="cb18-681"><a href="#cb18-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-682"><a href="#cb18-682" aria-hidden="true" tabindex="-1"></a>Subsequently, I determine the most popular track in the playlist data that does not have a corresponding entry in the song characteristics data set. </span>
<span id="cb18-683"><a href="#cb18-683" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r most-popular-no-char}</span></span>
<span id="cb18-684"><a href="#cb18-684" aria-hidden="true" tabindex="-1"></a><span class="in"># What is the most popular track in the playlist data that does not have a corresponding entry in the </span></span>
<span id="cb18-685"><a href="#cb18-685" aria-hidden="true" tabindex="-1"></a><span class="in"># song characteristics data?</span></span>
<span id="cb18-686"><a href="#cb18-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-687"><a href="#cb18-687" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/most_pop_not_songs.csv"</span></span>
<span id="cb18-688"><a href="#cb18-688" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-689"><a href="#cb18-689" aria-hidden="true" tabindex="-1"></a><span class="in">  most_pop_not_songs &lt;-</span></span>
<span id="cb18-690"><a href="#cb18-690" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-691"><a href="#cb18-691" aria-hidden="true" tabindex="-1"></a><span class="in">      add_count(track_id, name = "track_count") |&gt;</span></span>
<span id="cb18-692"><a href="#cb18-692" aria-hidden="true" tabindex="-1"></a><span class="in">      anti_join(songs |&gt; select(id), join_by(track_id == id)) |&gt;</span></span>
<span id="cb18-693"><a href="#cb18-693" aria-hidden="true" tabindex="-1"></a><span class="in">      slice_max(track_count, n=1) |&gt;</span></span>
<span id="cb18-694"><a href="#cb18-694" aria-hidden="true" tabindex="-1"></a><span class="in">    distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-695"><a href="#cb18-695" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(most_pop_not_songs, fname, row.names = FALSE)</span></span>
<span id="cb18-696"><a href="#cb18-696" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-697"><a href="#cb18-697" aria-hidden="true" tabindex="-1"></a><span class="in">  most_pop_not_songs &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-698"><a href="#cb18-698" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-699"><a href="#cb18-699" aria-hidden="true" tabindex="-1"></a><span class="in">most_pop_not_songs |&gt;</span></span>
<span id="cb18-700"><a href="#cb18-700" aria-hidden="true" tabindex="-1"></a><span class="in">  select(</span></span>
<span id="cb18-701"><a href="#cb18-701" aria-hidden="true" tabindex="-1"></a><span class="in">    track_name,</span></span>
<span id="cb18-702"><a href="#cb18-702" aria-hidden="true" tabindex="-1"></a><span class="in">    artist_name,</span></span>
<span id="cb18-703"><a href="#cb18-703" aria-hidden="true" tabindex="-1"></a><span class="in">    album_name,</span></span>
<span id="cb18-704"><a href="#cb18-704" aria-hidden="true" tabindex="-1"></a><span class="in">    track_count,</span></span>
<span id="cb18-705"><a href="#cb18-705" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb18-706"><a href="#cb18-706" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb18-707"><a href="#cb18-707" aria-hidden="true" tabindex="-1"></a><span class="in">    "Track Name" = track_name,</span></span>
<span id="cb18-708"><a href="#cb18-708" aria-hidden="true" tabindex="-1"></a><span class="in">    "Artist Name" = artist_name,</span></span>
<span id="cb18-709"><a href="#cb18-709" aria-hidden="true" tabindex="-1"></a><span class="in">    "Album Name" = album_name,</span></span>
<span id="cb18-710"><a href="#cb18-710" aria-hidden="true" tabindex="-1"></a><span class="in">    "Playlist Appearances" = track_count,</span></span>
<span id="cb18-711"><a href="#cb18-711" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb18-712"><a href="#cb18-712" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(caption = "Table 3: Most Popular Track in the Playlist Data Without a Corresponding Entry in the </span></span>
<span id="cb18-713"><a href="#cb18-713" aria-hidden="true" tabindex="-1"></a><span class="in">Song Characteristics Data")</span></span>
<span id="cb18-714"><a href="#cb18-714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-715"><a href="#cb18-715" aria-hidden="true" tabindex="-1"></a>I now look at the most danceable track in the playlist data, and count the number of times it appears in a playlist.</span>
<span id="cb18-716"><a href="#cb18-716" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r most-danceable}</span></span>
<span id="cb18-717"><a href="#cb18-717" aria-hidden="true" tabindex="-1"></a><span class="in"># According to the song characteristics data, what is the most “danceable” track?</span></span>
<span id="cb18-718"><a href="#cb18-718" aria-hidden="true" tabindex="-1"></a><span class="in"># How often does it appear in a playlist?</span></span>
<span id="cb18-719"><a href="#cb18-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-720"><a href="#cb18-720" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/most_danceable.csv"</span></span>
<span id="cb18-721"><a href="#cb18-721" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-722"><a href="#cb18-722" aria-hidden="true" tabindex="-1"></a><span class="in">  # Get the most danceable track</span></span>
<span id="cb18-723"><a href="#cb18-723" aria-hidden="true" tabindex="-1"></a><span class="in">  most_danceable &lt;- </span></span>
<span id="cb18-724"><a href="#cb18-724" aria-hidden="true" tabindex="-1"></a><span class="in">    songs |&gt;</span></span>
<span id="cb18-725"><a href="#cb18-725" aria-hidden="true" tabindex="-1"></a><span class="in">    select(id, name, artist, danceability) |&gt;</span></span>
<span id="cb18-726"><a href="#cb18-726" aria-hidden="true" tabindex="-1"></a><span class="in">    slice_max(danceability, n = 1)</span></span>
<span id="cb18-727"><a href="#cb18-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-728"><a href="#cb18-728" aria-hidden="true" tabindex="-1"></a><span class="in">  # Join with playlist data and summarize appearances</span></span>
<span id="cb18-729"><a href="#cb18-729" aria-hidden="true" tabindex="-1"></a><span class="in">  most_danceable &lt;-</span></span>
<span id="cb18-730"><a href="#cb18-730" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-731"><a href="#cb18-731" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(track_id == most_danceable$id) |&gt;</span></span>
<span id="cb18-732"><a href="#cb18-732" aria-hidden="true" tabindex="-1"></a><span class="in">    select(track_id, album_name) |&gt;</span></span>
<span id="cb18-733"><a href="#cb18-733" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(appearances = n()) |&gt;</span></span>
<span id="cb18-734"><a href="#cb18-734" aria-hidden="true" tabindex="-1"></a><span class="in">    distinct(track_id, album_name, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-735"><a href="#cb18-735" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_join(most_danceable, by = c("track_id" = "id")) |&gt;</span></span>
<span id="cb18-736"><a href="#cb18-736" aria-hidden="true" tabindex="-1"></a><span class="in">    select(name, artist, album_name, danceability, appearances)</span></span>
<span id="cb18-737"><a href="#cb18-737" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(most_danceable, fname, row.names = FALSE)</span></span>
<span id="cb18-738"><a href="#cb18-738" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-739"><a href="#cb18-739" aria-hidden="true" tabindex="-1"></a><span class="in">  most_danceable &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-740"><a href="#cb18-740" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-741"><a href="#cb18-741" aria-hidden="true" tabindex="-1"></a><span class="in"># Display as kable with caption</span></span>
<span id="cb18-742"><a href="#cb18-742" aria-hidden="true" tabindex="-1"></a><span class="in">most_danceable |&gt;</span></span>
<span id="cb18-743"><a href="#cb18-743" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb18-744"><a href="#cb18-744" aria-hidden="true" tabindex="-1"></a><span class="in">    `Track Name` = name,</span></span>
<span id="cb18-745"><a href="#cb18-745" aria-hidden="true" tabindex="-1"></a><span class="in">    `Artist Name` = artist,</span></span>
<span id="cb18-746"><a href="#cb18-746" aria-hidden="true" tabindex="-1"></a><span class="in">    `Album Name` = album_name,</span></span>
<span id="cb18-747"><a href="#cb18-747" aria-hidden="true" tabindex="-1"></a><span class="in">    `Danceability` = danceability,</span></span>
<span id="cb18-748"><a href="#cb18-748" aria-hidden="true" tabindex="-1"></a><span class="in">    `Playlist Appearances` = appearances</span></span>
<span id="cb18-749"><a href="#cb18-749" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb18-750"><a href="#cb18-750" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(caption = "Table 4: Most Danceable Song and Its Playlist Appearances")</span></span>
<span id="cb18-751"><a href="#cb18-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-752"><a href="#cb18-752" aria-hidden="true" tabindex="-1"></a>Then, I locate the playlist with the longest average track length. </span>
<span id="cb18-753"><a href="#cb18-753" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r longest-avg-track-length}</span></span>
<span id="cb18-754"><a href="#cb18-754" aria-hidden="true" tabindex="-1"></a><span class="in"># Which playlist has the longest average track length?</span></span>
<span id="cb18-755"><a href="#cb18-755" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/longest_avg_track_length.csv"</span></span>
<span id="cb18-756"><a href="#cb18-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-757"><a href="#cb18-757" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)) {</span></span>
<span id="cb18-758"><a href="#cb18-758" aria-hidden="true" tabindex="-1"></a><span class="in">  longest_avg_track_length &lt;-</span></span>
<span id="cb18-759"><a href="#cb18-759" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt; </span></span>
<span id="cb18-760"><a href="#cb18-760" aria-hidden="true" tabindex="-1"></a><span class="in">    select(playlist_id, playlist_name, duration) |&gt;</span></span>
<span id="cb18-761"><a href="#cb18-761" aria-hidden="true" tabindex="-1"></a><span class="in">    group_by(playlist_id) |&gt;</span></span>
<span id="cb18-762"><a href="#cb18-762" aria-hidden="true" tabindex="-1"></a><span class="in">    summarize(</span></span>
<span id="cb18-763"><a href="#cb18-763" aria-hidden="true" tabindex="-1"></a><span class="in">      `Longest Average Track Length (s)` = mean(duration / 1000, na.rm = TRUE),</span></span>
<span id="cb18-764"><a href="#cb18-764" aria-hidden="true" tabindex="-1"></a><span class="in">      .groups = "drop"</span></span>
<span id="cb18-765"><a href="#cb18-765" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb18-766"><a href="#cb18-766" aria-hidden="true" tabindex="-1"></a><span class="in">    slice_max(`Longest Average Track Length (s)`, n = 1) |&gt;</span></span>
<span id="cb18-767"><a href="#cb18-767" aria-hidden="true" tabindex="-1"></a><span class="in">    left_join(</span></span>
<span id="cb18-768"><a href="#cb18-768" aria-hidden="true" tabindex="-1"></a><span class="in">      SPOTIFY_MILLIONS |&gt; select(playlist_id, playlist_name) |&gt; distinct(),</span></span>
<span id="cb18-769"><a href="#cb18-769" aria-hidden="true" tabindex="-1"></a><span class="in">      by = "playlist_id"</span></span>
<span id="cb18-770"><a href="#cb18-770" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb18-771"><a href="#cb18-771" aria-hidden="true" tabindex="-1"></a><span class="in">    relocate(playlist_name, .after = playlist_id)</span></span>
<span id="cb18-772"><a href="#cb18-772" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(longest_avg_track_length, fname, row.names = FALSE)</span></span>
<span id="cb18-773"><a href="#cb18-773" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb18-774"><a href="#cb18-774" aria-hidden="true" tabindex="-1"></a><span class="in">  longest_avg_track_length &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-775"><a href="#cb18-775" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-776"><a href="#cb18-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-777"><a href="#cb18-777" aria-hidden="true" tabindex="-1"></a><span class="in">longest_avg_track_length |&gt;</span></span>
<span id="cb18-778"><a href="#cb18-778" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(`Longest Average Track Length (s)` = comma(`Longest Average Track Length (s)`)) |&gt;</span></span>
<span id="cb18-779"><a href="#cb18-779" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb18-780"><a href="#cb18-780" aria-hidden="true" tabindex="-1"></a><span class="in">    `Playlist ID` = playlist_id,</span></span>
<span id="cb18-781"><a href="#cb18-781" aria-hidden="true" tabindex="-1"></a><span class="in">    `Playlist Name` = playlist_name</span></span>
<span id="cb18-782"><a href="#cb18-782" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb18-783"><a href="#cb18-783" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(caption = "Table 5: Playlist with the Longest Average Track Length")</span></span>
<span id="cb18-784"><a href="#cb18-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-785"><a href="#cb18-785" aria-hidden="true" tabindex="-1"></a>Finally, I identify the most popular playlist in the playlist data set. </span>
<span id="cb18-786"><a href="#cb18-786" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r most-popular-playlist}</span></span>
<span id="cb18-787"><a href="#cb18-787" aria-hidden="true" tabindex="-1"></a><span class="in"># What is the most popular playlist on Spotify?</span></span>
<span id="cb18-788"><a href="#cb18-788" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/most_pop_playlist.csv"</span></span>
<span id="cb18-789"><a href="#cb18-789" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-790"><a href="#cb18-790" aria-hidden="true" tabindex="-1"></a><span class="in">  most_pop_playlist &lt;-</span></span>
<span id="cb18-791"><a href="#cb18-791" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-792"><a href="#cb18-792" aria-hidden="true" tabindex="-1"></a><span class="in">    select(playlist_id, playlist_name, playlist_followers) |&gt;</span></span>
<span id="cb18-793"><a href="#cb18-793" aria-hidden="true" tabindex="-1"></a><span class="in">    slice_max(playlist_followers, n=1) |&gt;</span></span>
<span id="cb18-794"><a href="#cb18-794" aria-hidden="true" tabindex="-1"></a><span class="in">    distinct(playlist_id, .keep_all = TRUE)</span></span>
<span id="cb18-795"><a href="#cb18-795" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(most_pop_playlist, fname, row.names = FALSE)</span></span>
<span id="cb18-796"><a href="#cb18-796" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-797"><a href="#cb18-797" aria-hidden="true" tabindex="-1"></a><span class="in">    most_pop_playlist &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-798"><a href="#cb18-798" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-799"><a href="#cb18-799" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-800"><a href="#cb18-800" aria-hidden="true" tabindex="-1"></a><span class="in">most_pop_playlist |&gt;</span></span>
<span id="cb18-801"><a href="#cb18-801" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(playlist_followers = comma(playlist_followers)) |&gt;</span></span>
<span id="cb18-802"><a href="#cb18-802" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb18-803"><a href="#cb18-803" aria-hidden="true" tabindex="-1"></a><span class="in">    `Playlist ID` = playlist_id,</span></span>
<span id="cb18-804"><a href="#cb18-804" aria-hidden="true" tabindex="-1"></a><span class="in">    `Playlist Name` = playlist_name,</span></span>
<span id="cb18-805"><a href="#cb18-805" aria-hidden="true" tabindex="-1"></a><span class="in">    `Playlist Followers` = playlist_followers</span></span>
<span id="cb18-806"><a href="#cb18-806" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb18-807"><a href="#cb18-807" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(caption = "Table 6: Most Popular Playlist")</span></span>
<span id="cb18-808"><a href="#cb18-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-809"><a href="#cb18-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-810"><a href="#cb18-810" aria-hidden="true" tabindex="-1"></a><span class="fu">### Identifying the Characteristics of Popular Songs</span></span>
<span id="cb18-811"><a href="#cb18-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-812"><a href="#cb18-812" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Joining the Data Sets</span></span>
<span id="cb18-813"><a href="#cb18-813" aria-hidden="true" tabindex="-1"></a>I joined the playlist and song characteristic data sets as in the code below. The Spotify playlist data and the song characteristics data was subsequently deleted to free up RAM. </span>
<span id="cb18-814"><a href="#cb18-814" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE}</span></span>
<span id="cb18-815"><a href="#cb18-815" aria-hidden="true" tabindex="-1"></a><span class="in">merged_fpath &lt;- "data/mp03/spotify_millions_songs_join.csv"</span></span>
<span id="cb18-816"><a href="#cb18-816" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(merged_fpath)){</span></span>
<span id="cb18-817"><a href="#cb18-817" aria-hidden="true" tabindex="-1"></a><span class="in">  spotify_millions_songs &lt;- </span></span>
<span id="cb18-818"><a href="#cb18-818" aria-hidden="true" tabindex="-1"></a><span class="in">    SPOTIFY_MILLIONS |&gt;</span></span>
<span id="cb18-819"><a href="#cb18-819" aria-hidden="true" tabindex="-1"></a><span class="in">    inner_join(songs, join_by(track_id == id, track_name == name, artist_name == artist, duration == duration_ms)) |&gt;</span></span>
<span id="cb18-820"><a href="#cb18-820" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(decade = paste0((year %/% 10) * 10, "s"))</span></span>
<span id="cb18-821"><a href="#cb18-821" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(spotify_millions_songs, merged_fpath, row.names = FALSE)</span></span>
<span id="cb18-822"><a href="#cb18-822" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-823"><a href="#cb18-823" aria-hidden="true" tabindex="-1"></a><span class="in">  spotify_millions_songs &lt;- readr::read_csv(merged_fpath)</span></span>
<span id="cb18-824"><a href="#cb18-824" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-825"><a href="#cb18-825" aria-hidden="true" tabindex="-1"></a><span class="in">if (exists(SPOTIFY_MILLIONS) &amp; exists(songs)){</span></span>
<span id="cb18-826"><a href="#cb18-826" aria-hidden="true" tabindex="-1"></a><span class="in">  rm(SPOTIFY_MILLIONS, songs)</span></span>
<span id="cb18-827"><a href="#cb18-827" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-828"><a href="#cb18-828" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-829"><a href="#cb18-829" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Analysis</span></span>
<span id="cb18-830"><a href="#cb18-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-831"><a href="#cb18-831" aria-hidden="true" tabindex="-1"></a>A brief, instructor-led analysis of the playlist data set is included below. To explore whether more popular songs tend to appear in more playlists, a linear regression was performed using popularity as the predictor and the log-transformed count of playlist appearances as the outcome. The figure below illustrates this relationship. The model shows a fairly strong positive association, with a regression equation of $y = -1.25 + 0.10x$, a correlation of $r = 0.77$, and a coefficient of determination $R^2 = 0.59$. This suggests that popularity is a reasonably good predictor of how often a song shows up in playlists.</span>
<span id="cb18-832"><a href="#cb18-832" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-833"><a href="#cb18-833" aria-hidden="true" tabindex="-1"></a><span class="in"># Is the popularity column correlated with the number of playlist appearances? If so, to what degree?</span></span>
<span id="cb18-834"><a href="#cb18-834" aria-hidden="true" tabindex="-1"></a><span class="in"># Prep the data</span></span>
<span id="cb18-835"><a href="#cb18-835" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- spotify_millions_songs |&gt;</span></span>
<span id="cb18-836"><a href="#cb18-836" aria-hidden="true" tabindex="-1"></a><span class="in">  add_count(track_id, name = "playlist_appearances") |&gt;</span></span>
<span id="cb18-837"><a href="#cb18-837" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-838"><a href="#cb18-838" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(log_appearances = log1p(playlist_appearances))</span></span>
<span id="cb18-839"><a href="#cb18-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-840"><a href="#cb18-840" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the model</span></span>
<span id="cb18-841"><a href="#cb18-841" aria-hidden="true" tabindex="-1"></a><span class="in">model &lt;- lm(log_appearances ~ popularity, data = data)</span></span>
<span id="cb18-842"><a href="#cb18-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-843"><a href="#cb18-843" aria-hidden="true" tabindex="-1"></a><span class="in"># Get model metrics</span></span>
<span id="cb18-844"><a href="#cb18-844" aria-hidden="true" tabindex="-1"></a><span class="in">model_eq &lt;- broom::tidy(model)</span></span>
<span id="cb18-845"><a href="#cb18-845" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- broom::glance(model)$r.squared</span></span>
<span id="cb18-846"><a href="#cb18-846" aria-hidden="true" tabindex="-1"></a><span class="in">correlation &lt;- cor(data$popularity, data$log_appearances, use = "complete.obs")</span></span>
<span id="cb18-847"><a href="#cb18-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-848"><a href="#cb18-848" aria-hidden="true" tabindex="-1"></a><span class="in"># Build the equation text</span></span>
<span id="cb18-849"><a href="#cb18-849" aria-hidden="true" tabindex="-1"></a><span class="in">eq_text &lt;- paste0(</span></span>
<span id="cb18-850"><a href="#cb18-850" aria-hidden="true" tabindex="-1"></a><span class="in">  "y = ", round(model_eq$estimate[1], 2), " + ",</span></span>
<span id="cb18-851"><a href="#cb18-851" aria-hidden="true" tabindex="-1"></a><span class="in">  round(model_eq$estimate[2], 3), "x\n",</span></span>
<span id="cb18-852"><a href="#cb18-852" aria-hidden="true" tabindex="-1"></a><span class="in">  "r = ", round(correlation, 2), </span></span>
<span id="cb18-853"><a href="#cb18-853" aria-hidden="true" tabindex="-1"></a><span class="in">  " | R² = ", round(r_squared, 2)</span></span>
<span id="cb18-854"><a href="#cb18-854" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb18-855"><a href="#cb18-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-856"><a href="#cb18-856" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot</span></span>
<span id="cb18-857"><a href="#cb18-857" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data, aes(x = popularity, y = log_appearances)) +</span></span>
<span id="cb18-858"><a href="#cb18-858" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_jitter(alpha = 0.1, width = 0.3, height = 0.1, color = MINTY) +</span></span>
<span id="cb18-859"><a href="#cb18-859" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.1, width = 0.3, height = 0.1, color = MINTY) +</span></span>
<span id="cb18-860"><a href="#cb18-860" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = FALSE, color = "black") +</span></span>
<span id="cb18-861"><a href="#cb18-861" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 12.75, y = -1,</span></span>
<span id="cb18-862"><a href="#cb18-862" aria-hidden="true" tabindex="-1"></a><span class="in">           label = eq_text, hjust = 0, size = 4, fontface = "italic") +</span></span>
<span id="cb18-863"><a href="#cb18-863" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-864"><a href="#cb18-864" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Figure 1: Relationship Between Popularity and Playlist Appearances",</span></span>
<span id="cb18-865"><a href="#cb18-865" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set.",</span></span>
<span id="cb18-866"><a href="#cb18-866" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Popularity",</span></span>
<span id="cb18-867"><a href="#cb18-867" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Log(Playlist Appearances)"</span></span>
<span id="cb18-868"><a href="#cb18-868" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-869"><a href="#cb18-869" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb18-870"><a href="#cb18-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-871"><a href="#cb18-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-872"><a href="#cb18-872" aria-hidden="true" tabindex="-1"></a>Median track popularity by year is presented in the figure below. The general trend is that track popularity is higher with release year. Notably, 2017 stands out as the year with the highest median song popularity.</span>
<span id="cb18-873"><a href="#cb18-873" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-874"><a href="#cb18-874" aria-hidden="true" tabindex="-1"></a><span class="in"># In what year were the most popular songs released?</span></span>
<span id="cb18-875"><a href="#cb18-875" aria-hidden="true" tabindex="-1"></a><span class="in">spotify_millions_songs |&gt;</span></span>
<span id="cb18-876"><a href="#cb18-876" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-877"><a href="#cb18-877" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(year) |&gt;</span></span>
<span id="cb18-878"><a href="#cb18-878" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(median_popularity = median(popularity, na.rm = TRUE)) |&gt;</span></span>
<span id="cb18-879"><a href="#cb18-879" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = year, y = median_popularity)) +</span></span>
<span id="cb18-880"><a href="#cb18-880" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(color = MINTY, linewidth = 1.2) +</span></span>
<span id="cb18-881"><a href="#cb18-881" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(color = MINTY, size = 2) +</span></span>
<span id="cb18-882"><a href="#cb18-882" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb18-883"><a href="#cb18-883" aria-hidden="true" tabindex="-1"></a><span class="in">    breaks = seq(min(pull(spotify_millions_songs, year), na.rm = TRUE),</span></span>
<span id="cb18-884"><a href="#cb18-884" aria-hidden="true" tabindex="-1"></a><span class="in">                 max(pull(spotify_millions_songs, year), na.rm = TRUE),</span></span>
<span id="cb18-885"><a href="#cb18-885" aria-hidden="true" tabindex="-1"></a><span class="in">                 by = 10)</span></span>
<span id="cb18-886"><a href="#cb18-886" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-887"><a href="#cb18-887" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-888"><a href="#cb18-888" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Year",</span></span>
<span id="cb18-889"><a href="#cb18-889" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Median Track Popularity",</span></span>
<span id="cb18-890"><a href="#cb18-890" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Median Track Popularity by Year",</span></span>
<span id="cb18-891"><a href="#cb18-891" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb18-892"><a href="#cb18-892" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-893"><a href="#cb18-893" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb18-894"><a href="#cb18-894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-895"><a href="#cb18-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-896"><a href="#cb18-896" aria-hidden="true" tabindex="-1"></a>While median song popularity continues to keep up with the times, median track dance-ability peaked in 1929. The figure below presents the evolution of track dance ability over the past 90 years. </span>
<span id="cb18-897"><a href="#cb18-897" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-898"><a href="#cb18-898" aria-hidden="true" tabindex="-1"></a><span class="in"># In what year did danceability peak?</span></span>
<span id="cb18-899"><a href="#cb18-899" aria-hidden="true" tabindex="-1"></a><span class="in">spotify_millions_songs |&gt;</span></span>
<span id="cb18-900"><a href="#cb18-900" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-901"><a href="#cb18-901" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(year) |&gt;</span></span>
<span id="cb18-902"><a href="#cb18-902" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(median_danceability = median(danceability, na.rm = TRUE)) |&gt;</span></span>
<span id="cb18-903"><a href="#cb18-903" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = year, y = median_danceability)) +</span></span>
<span id="cb18-904"><a href="#cb18-904" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(color = MINTY, linewidth = 1.2) +</span></span>
<span id="cb18-905"><a href="#cb18-905" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(color = MINTY, size = 2) +</span></span>
<span id="cb18-906"><a href="#cb18-906" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb18-907"><a href="#cb18-907" aria-hidden="true" tabindex="-1"></a><span class="in">    breaks = seq(min(pull(spotify_millions_songs, year), na.rm = TRUE),</span></span>
<span id="cb18-908"><a href="#cb18-908" aria-hidden="true" tabindex="-1"></a><span class="in">                 max(pull(spotify_millions_songs, year), na.rm = TRUE),</span></span>
<span id="cb18-909"><a href="#cb18-909" aria-hidden="true" tabindex="-1"></a><span class="in">                 by = 10)</span></span>
<span id="cb18-910"><a href="#cb18-910" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-911"><a href="#cb18-911" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-912"><a href="#cb18-912" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Year",</span></span>
<span id="cb18-913"><a href="#cb18-913" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Median Track Danceability",</span></span>
<span id="cb18-914"><a href="#cb18-914" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Median Track Danceability by Year",</span></span>
<span id="cb18-915"><a href="#cb18-915" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb18-916"><a href="#cb18-916" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-917"><a href="#cb18-917" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb18-918"><a href="#cb18-918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-919"><a href="#cb18-919" aria-hidden="true" tabindex="-1"></a>The most represented decade on user playlists is the 2010s. The bar chart below presents the distribution of tracks belonging to a particular decade.</span>
<span id="cb18-920"><a href="#cb18-920" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-921"><a href="#cb18-921" aria-hidden="true" tabindex="-1"></a><span class="in"># Which decade is most represented on user playlists? (The integer division (%/%) operator may be useful for computing decades from years.)</span></span>
<span id="cb18-922"><a href="#cb18-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-923"><a href="#cb18-923" aria-hidden="true" tabindex="-1"></a><span class="in">spotify_millions_songs |&gt;</span></span>
<span id="cb18-924"><a href="#cb18-924" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(decade = paste0((year %/% 10) * 10, "s")) |&gt;</span></span>
<span id="cb18-925"><a href="#cb18-925" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(decade) |&gt;</span></span>
<span id="cb18-926"><a href="#cb18-926" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(decade_count = n()/10000) |&gt;</span></span>
<span id="cb18-927"><a href="#cb18-927" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = decade_count, y = factor(decade))) +</span></span>
<span id="cb18-928"><a href="#cb18-928" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", fill = MINTY) +</span></span>
<span id="cb18-929"><a href="#cb18-929" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-930"><a href="#cb18-930" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Number of Tracks (in tens of thousands)",</span></span>
<span id="cb18-931"><a href="#cb18-931" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Decade",</span></span>
<span id="cb18-932"><a href="#cb18-932" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Decade Representation in Playlists",</span></span>
<span id="cb18-933"><a href="#cb18-933" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb18-934"><a href="#cb18-934" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-935"><a href="#cb18-935" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb18-936"><a href="#cb18-936" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb18-937"><a href="#cb18-937" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.text.y = element_text(angle = 45, hjust = 1)</span></span>
<span id="cb18-938"><a href="#cb18-938" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb18-939"><a href="#cb18-939" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-940"><a href="#cb18-940" aria-hidden="true" tabindex="-1"></a>The most popular musical key is G, as can be seen in the figure of key distribution frequency below. </span>
<span id="cb18-941"><a href="#cb18-941" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-942"><a href="#cb18-942" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the key names</span></span>
<span id="cb18-943"><a href="#cb18-943" aria-hidden="true" tabindex="-1"></a><span class="in">key_names &lt;- c(</span></span>
<span id="cb18-944"><a href="#cb18-944" aria-hidden="true" tabindex="-1"></a><span class="in">  "C", "C♯/Db", "D", "D♯/Eb", "E", "F",</span></span>
<span id="cb18-945"><a href="#cb18-945" aria-hidden="true" tabindex="-1"></a><span class="in">  "F♯/Gb", "G", "G♯/Ab", "A", "A♯/Bb", "B"</span></span>
<span id="cb18-946"><a href="#cb18-946" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb18-947"><a href="#cb18-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-948"><a href="#cb18-948" aria-hidden="true" tabindex="-1"></a><span class="in"># Count frequency per key and label with musical key names</span></span>
<span id="cb18-949"><a href="#cb18-949" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- spotify_millions_songs |&gt;</span></span>
<span id="cb18-950"><a href="#cb18-950" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-951"><a href="#cb18-951" aria-hidden="true" tabindex="-1"></a><span class="in">  count(key, name = "key_frequency") |&gt;</span></span>
<span id="cb18-952"><a href="#cb18-952" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(key_label = factor(key_names[key + 1], levels = key_names))</span></span>
<span id="cb18-953"><a href="#cb18-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-954"><a href="#cb18-954" aria-hidden="true" tabindex="-1"></a><span class="in"># Create label positions at fixed theta, variable radius</span></span>
<span id="cb18-955"><a href="#cb18-955" aria-hidden="true" tabindex="-1"></a><span class="in">y_values &lt;- seq(1000, max(data$key_frequency), by = 1000)</span></span>
<span id="cb18-956"><a href="#cb18-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-957"><a href="#cb18-957" aria-hidden="true" tabindex="-1"></a><span class="in">radial_labels &lt;- tibble(</span></span>
<span id="cb18-958"><a href="#cb18-958" aria-hidden="true" tabindex="-1"></a><span class="in">  x = rep("D♯/Eb", length(y_values)),  # Repeat "C" the same number of times as y values</span></span>
<span id="cb18-959"><a href="#cb18-959" aria-hidden="true" tabindex="-1"></a><span class="in">  y = y_values,</span></span>
<span id="cb18-960"><a href="#cb18-960" aria-hidden="true" tabindex="-1"></a><span class="in">  label = as.character(y_values)</span></span>
<span id="cb18-961"><a href="#cb18-961" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb18-962"><a href="#cb18-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-963"><a href="#cb18-963" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot with polar coordinates and annotations</span></span>
<span id="cb18-964"><a href="#cb18-964" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data, aes(x = key_label, y = key_frequency, fill = key_label)) +</span></span>
<span id="cb18-965"><a href="#cb18-965" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", width = 1) +</span></span>
<span id="cb18-966"><a href="#cb18-966" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_polar(start = 0) +</span></span>
<span id="cb18-967"><a href="#cb18-967" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(data = radial_labels, aes(x = x, y = y, label = label),</span></span>
<span id="cb18-968"><a href="#cb18-968" aria-hidden="true" tabindex="-1"></a><span class="in">            inherit.aes = FALSE, size = 3, color = "gray20", hjust = -0.2) +</span></span>
<span id="cb18-969"><a href="#cb18-969" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-970"><a href="#cb18-970" aria-hidden="true" tabindex="-1"></a><span class="in">    x = NULL, y = NULL,</span></span>
<span id="cb18-971"><a href="#cb18-971" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Distribution of Musical Keys",</span></span>
<span id="cb18-972"><a href="#cb18-972" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set."</span></span>
<span id="cb18-973"><a href="#cb18-973" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-974"><a href="#cb18-974" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb18-975"><a href="#cb18-975" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb18-976"><a href="#cb18-976" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.text.y = element_blank(),</span></span>
<span id="cb18-977"><a href="#cb18-977" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.ticks = element_blank(),</span></span>
<span id="cb18-978"><a href="#cb18-978" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.position = "none"</span></span>
<span id="cb18-979"><a href="#cb18-979" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb18-980"><a href="#cb18-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-981"><a href="#cb18-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-982"><a href="#cb18-982" aria-hidden="true" tabindex="-1"></a>As shown in the figure below, there does not appear to be a strong preference for any particular track length, with short, medium, and long songs appearing at roughly equal frequencies. Length categories are defined by terciles: short songs are under 199.08 seconds ($33^{rd}$ percentile), medium songs fall between 199.08 and 253.4 seconds ($33^{rd}$–$66^{th}$ percentile), and long songs exceed 253.4 seconds.</span>
<span id="cb18-983"><a href="#cb18-983" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-984"><a href="#cb18-984" aria-hidden="true" tabindex="-1"></a><span class="in"># What are the most popular track lengths? (Are short tracks, long tracks, or something in between most commonly included in user playlists?)</span></span>
<span id="cb18-985"><a href="#cb18-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-986"><a href="#cb18-986" aria-hidden="true" tabindex="-1"></a><span class="in">duration_percentiles &lt;- spotify_millions_songs |&gt;</span></span>
<span id="cb18-987"><a href="#cb18-987" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-988"><a href="#cb18-988" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(duration)) |&gt;</span></span>
<span id="cb18-989"><a href="#cb18-989" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(duration_sec = duration / 1000) |&gt;</span></span>
<span id="cb18-990"><a href="#cb18-990" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(</span></span>
<span id="cb18-991"><a href="#cb18-991" aria-hidden="true" tabindex="-1"></a><span class="in">    p33 = quantile(duration_sec, 0.33),</span></span>
<span id="cb18-992"><a href="#cb18-992" aria-hidden="true" tabindex="-1"></a><span class="in">    p66 = quantile(duration_sec, 0.66)</span></span>
<span id="cb18-993"><a href="#cb18-993" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb18-994"><a href="#cb18-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-995"><a href="#cb18-995" aria-hidden="true" tabindex="-1"></a><span class="in"># Pull out threshold values</span></span>
<span id="cb18-996"><a href="#cb18-996" aria-hidden="true" tabindex="-1"></a><span class="in">p33 &lt;- duration_percentiles$p33</span></span>
<span id="cb18-997"><a href="#cb18-997" aria-hidden="true" tabindex="-1"></a><span class="in">p66 &lt;- duration_percentiles$p66</span></span>
<span id="cb18-998"><a href="#cb18-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-999"><a href="#cb18-999" aria-hidden="true" tabindex="-1"></a><span class="in"># Categorize and plot</span></span>
<span id="cb18-1000"><a href="#cb18-1000" aria-hidden="true" tabindex="-1"></a><span class="in">spotify_millions_songs |&gt;</span></span>
<span id="cb18-1001"><a href="#cb18-1001" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-1002"><a href="#cb18-1002" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(duration)) |&gt;</span></span>
<span id="cb18-1003"><a href="#cb18-1003" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb18-1004"><a href="#cb18-1004" aria-hidden="true" tabindex="-1"></a><span class="in">    duration_sec = duration / 1000,</span></span>
<span id="cb18-1005"><a href="#cb18-1005" aria-hidden="true" tabindex="-1"></a><span class="in">    duration_category = case_when(</span></span>
<span id="cb18-1006"><a href="#cb18-1006" aria-hidden="true" tabindex="-1"></a><span class="in">      duration_sec &lt;= p33 ~ "Short",</span></span>
<span id="cb18-1007"><a href="#cb18-1007" aria-hidden="true" tabindex="-1"></a><span class="in">      duration_sec &lt;= p66 ~ "Medium",</span></span>
<span id="cb18-1008"><a href="#cb18-1008" aria-hidden="true" tabindex="-1"></a><span class="in">      TRUE ~ "Long"</span></span>
<span id="cb18-1009"><a href="#cb18-1009" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-1010"><a href="#cb18-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb18-1011"><a href="#cb18-1011" aria-hidden="true" tabindex="-1"></a><span class="in">  count(duration_category) |&gt;</span></span>
<span id="cb18-1012"><a href="#cb18-1012" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = duration_category, y = n, fill = duration_category)) +</span></span>
<span id="cb18-1013"><a href="#cb18-1013" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col() +</span></span>
<span id="cb18-1014"><a href="#cb18-1014" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-1015"><a href="#cb18-1015" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set.",</span></span>
<span id="cb18-1016"><a href="#cb18-1016" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Song Duration Categories",</span></span>
<span id="cb18-1017"><a href="#cb18-1017" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Duration Category",</span></span>
<span id="cb18-1018"><a href="#cb18-1018" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Number of Unique Tracks"</span></span>
<span id="cb18-1019"><a href="#cb18-1019" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-1020"><a href="#cb18-1020" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = comma_format()) +</span></span>
<span id="cb18-1021"><a href="#cb18-1021" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(</span></span>
<span id="cb18-1022"><a href="#cb18-1022" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Duration Category",</span></span>
<span id="cb18-1023"><a href="#cb18-1023" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c("Short" = MINTY, "Medium" = "#fdd835", "Long" = "#ef5350")) +</span></span>
<span id="cb18-1024"><a href="#cb18-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb18-1025"><a href="#cb18-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-1026"><a href="#cb18-1026" aria-hidden="true" tabindex="-1"></a>A linear regression analysis reveals a very weak positive relationship between danceability and popularity, with a coefficient of determination ($R^2$) of just 0.03. This suggests that only 3% of the variability in popularity can be explained by danceability. The scatter plot below illustrates this weak association.</span>
<span id="cb18-1027"><a href="#cb18-1027" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-1028"><a href="#cb18-1028" aria-hidden="true" tabindex="-1"></a><span class="in"># Does danceability correlate with popularity?</span></span>
<span id="cb18-1029"><a href="#cb18-1029" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- spotify_millions_songs |&gt;</span></span>
<span id="cb18-1030"><a href="#cb18-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-1031"><a href="#cb18-1031" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the model</span></span>
<span id="cb18-1032"><a href="#cb18-1032" aria-hidden="true" tabindex="-1"></a><span class="in">model &lt;- lm(danceability ~ popularity, data = data)</span></span>
<span id="cb18-1033"><a href="#cb18-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1034"><a href="#cb18-1034" aria-hidden="true" tabindex="-1"></a><span class="in"># Get model metrics</span></span>
<span id="cb18-1035"><a href="#cb18-1035" aria-hidden="true" tabindex="-1"></a><span class="in">model_eq &lt;- broom::tidy(model)</span></span>
<span id="cb18-1036"><a href="#cb18-1036" aria-hidden="true" tabindex="-1"></a><span class="in">r_squared &lt;- broom::glance(model)$r.squared</span></span>
<span id="cb18-1037"><a href="#cb18-1037" aria-hidden="true" tabindex="-1"></a><span class="in">correlation &lt;- cor(data$popularity, data$danceability, use = "complete.obs")</span></span>
<span id="cb18-1038"><a href="#cb18-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1039"><a href="#cb18-1039" aria-hidden="true" tabindex="-1"></a><span class="in"># set up annotation</span></span>
<span id="cb18-1040"><a href="#cb18-1040" aria-hidden="true" tabindex="-1"></a><span class="in">eq_text &lt;- paste0(</span></span>
<span id="cb18-1041"><a href="#cb18-1041" aria-hidden="true" tabindex="-1"></a><span class="in">  "y = ", round(model_eq$estimate[1], 2), " + ",</span></span>
<span id="cb18-1042"><a href="#cb18-1042" aria-hidden="true" tabindex="-1"></a><span class="in">  round(model_eq$estimate[2], 3), "x\n",</span></span>
<span id="cb18-1043"><a href="#cb18-1043" aria-hidden="true" tabindex="-1"></a><span class="in">  "r = ", round(correlation, 2), </span></span>
<span id="cb18-1044"><a href="#cb18-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  " | R² = ", round(r_squared, 2)</span></span>
<span id="cb18-1045"><a href="#cb18-1045" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb18-1046"><a href="#cb18-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1047"><a href="#cb18-1047" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot</span></span>
<span id="cb18-1048"><a href="#cb18-1048" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data, aes(x = popularity, y = danceability)) +</span></span>
<span id="cb18-1049"><a href="#cb18-1049" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_jitter(alpha = 0.1, width = 0.3, height = 0.1, color = MINTY) +</span></span>
<span id="cb18-1050"><a href="#cb18-1050" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = FALSE, color = "black") +</span></span>
<span id="cb18-1051"><a href="#cb18-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 5, y = 0,</span></span>
<span id="cb18-1052"><a href="#cb18-1052" aria-hidden="true" tabindex="-1"></a><span class="in">           label = eq_text, hjust = 0, size = 4, fontface = "italic") +</span></span>
<span id="cb18-1053"><a href="#cb18-1053" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-1054"><a href="#cb18-1054" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Relationship Between Popularity and Danceability",</span></span>
<span id="cb18-1055"><a href="#cb18-1055" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set.",</span></span>
<span id="cb18-1056"><a href="#cb18-1056" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Popularity",</span></span>
<span id="cb18-1057"><a href="#cb18-1057" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Log(Playlist Appearances)"</span></span>
<span id="cb18-1058"><a href="#cb18-1058" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-1059"><a href="#cb18-1059" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb18-1060"><a href="#cb18-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-1061"><a href="#cb18-1061" aria-hidden="true" tabindex="-1"></a>To understand which songs are most frequently chosen to open a playlist, I examined tracks appearing in the first position across playlists. The bar chart below displays the top 5 most common opening songs, revealing listener and curator preferences for kick-starting a playlist. Not surprisingly, many of these opening tracks are high-energy or popular.</span>
<span id="cb18-1062"><a href="#cb18-1062" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=TRUE, eval=TRUE}</span></span>
<span id="cb18-1063"><a href="#cb18-1063" aria-hidden="true" tabindex="-1"></a><span class="in"># What are the top 5 most common opening playlist songs?</span></span>
<span id="cb18-1064"><a href="#cb18-1064" aria-hidden="true" tabindex="-1"></a><span class="in">spotify_millions_songs |&gt;</span></span>
<span id="cb18-1065"><a href="#cb18-1065" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(playlist_position == 0) |&gt; </span></span>
<span id="cb18-1066"><a href="#cb18-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  add_count(track_id, name = "song_frequency") |&gt;</span></span>
<span id="cb18-1067"><a href="#cb18-1067" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt; </span></span>
<span id="cb18-1068"><a href="#cb18-1068" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(song_frequency)) |&gt;</span></span>
<span id="cb18-1069"><a href="#cb18-1069" aria-hidden="true" tabindex="-1"></a><span class="in">  slice_head(n = 5) |&gt;  </span></span>
<span id="cb18-1070"><a href="#cb18-1070" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = song_frequency, y = fct_reorder(paste0(track_name, "\n", artist_name), song_frequency))) +</span></span>
<span id="cb18-1071"><a href="#cb18-1071" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", fill = MINTY) +</span></span>
<span id="cb18-1072"><a href="#cb18-1072" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb18-1073"><a href="#cb18-1073" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Top 5 Most Popular Opening Playlist Songs",</span></span>
<span id="cb18-1074"><a href="#cb18-1074" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Data sources: Spotify Millions Playlist data set and Spotify Song Characteristics data set.",</span></span>
<span id="cb18-1075"><a href="#cb18-1075" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Number of Playlists (Opening Position)",</span></span>
<span id="cb18-1076"><a href="#cb18-1076" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Track Name"</span></span>
<span id="cb18-1077"><a href="#cb18-1077" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb18-1078"><a href="#cb18-1078" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb18-1079"><a href="#cb18-1079" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-1080"><a href="#cb18-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1081"><a href="#cb18-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">## Playlist Construction</span></span>
<span id="cb18-1082"><a href="#cb18-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1083"><a href="#cb18-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choosing Anchor Songs</span></span>
<span id="cb18-1084"><a href="#cb18-1084" aria-hidden="true" tabindex="-1"></a>Since I've been on an 80s kick recently, I picked the anchor songs shown in table 7.</span>
<span id="cb18-1085"><a href="#cb18-1085" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE, eval = TRUE}</span></span>
<span id="cb18-1086"><a href="#cb18-1086" aria-hidden="true" tabindex="-1"></a><span class="in"># base songs</span></span>
<span id="cb18-1087"><a href="#cb18-1087" aria-hidden="true" tabindex="-1"></a><span class="in">song1 &lt;- spotify_millions_songs |&gt; filter(track_id == "4S1VYqwfkLit9mKVY3MXoo") # Forever Young by Alphaville</span></span>
<span id="cb18-1088"><a href="#cb18-1088" aria-hidden="true" tabindex="-1"></a><span class="in">song2 &lt;- spotify_millions_songs |&gt; filter(track_id == "22Ca1a5rQ5g2UFEZ3pp4tL") # The Blue Sky by a-ha</span></span>
<span id="cb18-1089"><a href="#cb18-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1090"><a href="#cb18-1090" aria-hidden="true" tabindex="-1"></a><span class="in">anchor_songs &lt;- list(song1, song2)</span></span>
<span id="cb18-1091"><a href="#cb18-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1092"><a href="#cb18-1092" aria-hidden="true" tabindex="-1"></a><span class="in">bind_rows(song1,song2) |&gt; </span></span>
<span id="cb18-1093"><a href="#cb18-1093" aria-hidden="true" tabindex="-1"></a><span class="in">  select(track_name, artist_name, album_name, year) |&gt;</span></span>
<span id="cb18-1094"><a href="#cb18-1094" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_name, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-1095"><a href="#cb18-1095" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb18-1096"><a href="#cb18-1096" aria-hidden="true" tabindex="-1"></a><span class="in">    "Track Name" = track_name,</span></span>
<span id="cb18-1097"><a href="#cb18-1097" aria-hidden="true" tabindex="-1"></a><span class="in">    "Artist Name" = artist_name,</span></span>
<span id="cb18-1098"><a href="#cb18-1098" aria-hidden="true" tabindex="-1"></a><span class="in">    "Album Name" = album_name,</span></span>
<span id="cb18-1099"><a href="#cb18-1099" aria-hidden="true" tabindex="-1"></a><span class="in">    "Year" = year</span></span>
<span id="cb18-1100"><a href="#cb18-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt; </span></span>
<span id="cb18-1101"><a href="#cb18-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(caption = "Table 7: Anchor Songs Chosen for the Ultimate Playlist")</span></span>
<span id="cb18-1102"><a href="#cb18-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-1103"><a href="#cb18-1103" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating a Candidate Pool</span></span>
<span id="cb18-1104"><a href="#cb18-1104" aria-hidden="true" tabindex="-1"></a>To determine compatibility with the anchor songs, I applied the following heuristics:</span>
<span id="cb18-1105"><a href="#cb18-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1106"><a href="#cb18-1106" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Co-occurrence: Songs that frequently appear on playlists alongside the anchor songs.</span>
<span id="cb18-1107"><a href="#cb18-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1108"><a href="#cb18-1108" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Musical similarity: Songs in the same key and with a tempo within $\pm5$ BPM of the anchor.</span>
<span id="cb18-1109"><a href="#cb18-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1110"><a href="#cb18-1110" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Artist match: Songs by the same artist(s) as the anchor tracks.</span>
<span id="cb18-1111"><a href="#cb18-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1112"><a href="#cb18-1112" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Audio profile similarity: Songs released in the same year and exhibiting similar values for acousticness, dance-ability, energy, instrumentalness, liveness, loudness, speechiness, and valence. Similarity is measured using Euclidean distance:</span>
<span id="cb18-1113"><a href="#cb18-1113" aria-hidden="true" tabindex="-1"></a>$$d = \sqrt{\sum_{i=1}^{n} (x_i - y_i)^2}$$</span>
<span id="cb18-1114"><a href="#cb18-1114" aria-hidden="true" tabindex="-1"></a>where $x_i$ and $y_i$ are the characteristic values for the anchor and candidate songs, respectively.</span>
<span id="cb18-1115"><a href="#cb18-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1116"><a href="#cb18-1116" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Decade match and structural similarity: Songs from the same decade and duration within $\pm$ 15 seconds of the anchor song.</span>
<span id="cb18-1117"><a href="#cb18-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1118"><a href="#cb18-1118" aria-hidden="true" tabindex="-1"></a>The application of these heuristics is implemented in the code below.</span>
<span id="cb18-1119"><a href="#cb18-1119" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r echo=TRUE}</span></span>
<span id="cb18-1120"><a href="#cb18-1120" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/peer_songs.csv"</span></span>
<span id="cb18-1121"><a href="#cb18-1121" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-1122"><a href="#cb18-1122" aria-hidden="true" tabindex="-1"></a><span class="in"># What other songs commonly appear on playlists along side these songs?</span></span>
<span id="cb18-1123"><a href="#cb18-1123" aria-hidden="true" tabindex="-1"></a><span class="in">peer_songs &lt;- data.frame()</span></span>
<span id="cb18-1124"><a href="#cb18-1124" aria-hidden="true" tabindex="-1"></a><span class="in">for (song in anchor_songs) {</span></span>
<span id="cb18-1125"><a href="#cb18-1125" aria-hidden="true" tabindex="-1"></a><span class="in">  playlist_ids &lt;- song |&gt; pull(playlist_id) |&gt; unique() |&gt; as.vector()</span></span>
<span id="cb18-1126"><a href="#cb18-1126" aria-hidden="true" tabindex="-1"></a><span class="in">  for (pid in playlist_ids) {</span></span>
<span id="cb18-1127"><a href="#cb18-1127" aria-hidden="true" tabindex="-1"></a><span class="in">    peer_songs &lt;- bind_rows(</span></span>
<span id="cb18-1128"><a href="#cb18-1128" aria-hidden="true" tabindex="-1"></a><span class="in">      peer_songs,</span></span>
<span id="cb18-1129"><a href="#cb18-1129" aria-hidden="true" tabindex="-1"></a><span class="in">      spotify_millions_songs |&gt;</span></span>
<span id="cb18-1130"><a href="#cb18-1130" aria-hidden="true" tabindex="-1"></a><span class="in">        filter(playlist_id == pid) |&gt;</span></span>
<span id="cb18-1131"><a href="#cb18-1131" aria-hidden="true" tabindex="-1"></a><span class="in">        distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-1132"><a href="#cb18-1132" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-1133"><a href="#cb18-1133" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1134"><a href="#cb18-1134" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1135"><a href="#cb18-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(peer_songs |&gt; distinct(track_id, .keep_all = TRUE), fname, row.names = FALSE)</span></span>
<span id="cb18-1136"><a href="#cb18-1136" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-1137"><a href="#cb18-1137" aria-hidden="true" tabindex="-1"></a><span class="in">  peer_songs &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-1138"><a href="#cb18-1138" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1139"><a href="#cb18-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1140"><a href="#cb18-1140" aria-hidden="true" tabindex="-1"></a><span class="in"># What songs have a similar key and tempo to these songs</span></span>
<span id="cb18-1141"><a href="#cb18-1141" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/key_and_tempo.csv"</span></span>
<span id="cb18-1142"><a href="#cb18-1142" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-1143"><a href="#cb18-1143" aria-hidden="true" tabindex="-1"></a><span class="in">  key_and_tempo &lt;- data.frame()</span></span>
<span id="cb18-1144"><a href="#cb18-1144" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs){</span></span>
<span id="cb18-1145"><a href="#cb18-1145" aria-hidden="true" tabindex="-1"></a><span class="in">    song_key &lt;- unique(song |&gt; pull(key))</span></span>
<span id="cb18-1146"><a href="#cb18-1146" aria-hidden="true" tabindex="-1"></a><span class="in">    song_tempo &lt;- unique(song |&gt; pull(tempo))</span></span>
<span id="cb18-1147"><a href="#cb18-1147" aria-hidden="true" tabindex="-1"></a><span class="in">    key_and_tempo &lt;- </span></span>
<span id="cb18-1148"><a href="#cb18-1148" aria-hidden="true" tabindex="-1"></a><span class="in">      bind_rows(</span></span>
<span id="cb18-1149"><a href="#cb18-1149" aria-hidden="true" tabindex="-1"></a><span class="in">        key_and_tempo,</span></span>
<span id="cb18-1150"><a href="#cb18-1150" aria-hidden="true" tabindex="-1"></a><span class="in">        spotify_millions_songs |&gt;</span></span>
<span id="cb18-1151"><a href="#cb18-1151" aria-hidden="true" tabindex="-1"></a><span class="in">          mutate(</span></span>
<span id="cb18-1152"><a href="#cb18-1152" aria-hidden="true" tabindex="-1"></a><span class="in">            similar_tempo = case_when(</span></span>
<span id="cb18-1153"><a href="#cb18-1153" aria-hidden="true" tabindex="-1"></a><span class="in">              abs(tempo - unique(song |&gt; pull(tempo))) &lt;= 5 ~ TRUE,</span></span>
<span id="cb18-1154"><a href="#cb18-1154" aria-hidden="true" tabindex="-1"></a><span class="in">              TRUE ~ FALSE</span></span>
<span id="cb18-1155"><a href="#cb18-1155" aria-hidden="true" tabindex="-1"></a><span class="in">            )) |&gt;</span></span>
<span id="cb18-1156"><a href="#cb18-1156" aria-hidden="true" tabindex="-1"></a><span class="in">          filter(</span></span>
<span id="cb18-1157"><a href="#cb18-1157" aria-hidden="true" tabindex="-1"></a><span class="in">            key == song_key,</span></span>
<span id="cb18-1158"><a href="#cb18-1158" aria-hidden="true" tabindex="-1"></a><span class="in">            similar_tempo == TRUE) |&gt;</span></span>
<span id="cb18-1159"><a href="#cb18-1159" aria-hidden="true" tabindex="-1"></a><span class="in">          distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-1160"><a href="#cb18-1160" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb18-1161"><a href="#cb18-1161" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1162"><a href="#cb18-1162" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(key_and_tempo, fname, row.names = FALSE)</span></span>
<span id="cb18-1163"><a href="#cb18-1163" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-1164"><a href="#cb18-1164" aria-hidden="true" tabindex="-1"></a><span class="in">    key_and_tempo &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-1165"><a href="#cb18-1165" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1166"><a href="#cb18-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1167"><a href="#cb18-1167" aria-hidden="true" tabindex="-1"></a><span class="in"># What songs have the same artist?</span></span>
<span id="cb18-1168"><a href="#cb18-1168" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/same_artist.csv"</span></span>
<span id="cb18-1169"><a href="#cb18-1169" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-1170"><a href="#cb18-1170" aria-hidden="true" tabindex="-1"></a><span class="in">  same_artist = data.frame()</span></span>
<span id="cb18-1171"><a href="#cb18-1171" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs){</span></span>
<span id="cb18-1172"><a href="#cb18-1172" aria-hidden="true" tabindex="-1"></a><span class="in">    song_artist_id &lt;- unique(song |&gt; pull(artist_id))</span></span>
<span id="cb18-1173"><a href="#cb18-1173" aria-hidden="true" tabindex="-1"></a><span class="in">    same_artist &lt;- bind_rows(</span></span>
<span id="cb18-1174"><a href="#cb18-1174" aria-hidden="true" tabindex="-1"></a><span class="in">      same_artist,</span></span>
<span id="cb18-1175"><a href="#cb18-1175" aria-hidden="true" tabindex="-1"></a><span class="in">      spotify_millions_songs |&gt;</span></span>
<span id="cb18-1176"><a href="#cb18-1176" aria-hidden="true" tabindex="-1"></a><span class="in">        filter(artist_id == song_artist_id) |&gt;</span></span>
<span id="cb18-1177"><a href="#cb18-1177" aria-hidden="true" tabindex="-1"></a><span class="in">        distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-1178"><a href="#cb18-1178" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-1179"><a href="#cb18-1179" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1180"><a href="#cb18-1180" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(same_artist, fname, row.names = FALSE)</span></span>
<span id="cb18-1181"><a href="#cb18-1181" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-1182"><a href="#cb18-1182" aria-hidden="true" tabindex="-1"></a><span class="in">    same_artist &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-1183"><a href="#cb18-1183" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1184"><a href="#cb18-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1185"><a href="#cb18-1185" aria-hidden="true" tabindex="-1"></a><span class="in"># What other songs were released in the same year and have similar levels of acousticness, danceability, etc.</span></span>
<span id="cb18-1186"><a href="#cb18-1186" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/all_similar_songs.csv"</span></span>
<span id="cb18-1187"><a href="#cb18-1187" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)){</span></span>
<span id="cb18-1188"><a href="#cb18-1188" aria-hidden="true" tabindex="-1"></a><span class="in">  all_similar_songs &lt;- data.frame()</span></span>
<span id="cb18-1189"><a href="#cb18-1189" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-1190"><a href="#cb18-1190" aria-hidden="true" tabindex="-1"></a><span class="in">  #' Calculate Similar Songs Based on Selected Metrics</span></span>
<span id="cb18-1191"><a href="#cb18-1191" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-1192"><a href="#cb18-1192" aria-hidden="true" tabindex="-1"></a><span class="in">  #' This function identifies songs similar to a given song by calculating the Euclidean distance between </span></span>
<span id="cb18-1193"><a href="#cb18-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  #' the selected metrics (e.g., acousticness, danceability, energy, etc.) of the input song and all other songs</span></span>
<span id="cb18-1194"><a href="#cb18-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  #' from the same year. Only songs with a distance smaller than a specified threshold (2.5) are considered similar.</span></span>
<span id="cb18-1195"><a href="#cb18-1195" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-1196"><a href="#cb18-1196" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @param song A data frame representing a single song, containing columns for song characteristics (e.g., `track_id`, `year`, and metrics like `acousticness`, `danceability`, etc.).</span></span>
<span id="cb18-1197"><a href="#cb18-1197" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @param std_songs A data frame representing the standardized set of songs to compare against, which must include the same metrics as in the `song` argument.</span></span>
<span id="cb18-1198"><a href="#cb18-1198" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @param metrics A character vector containing the names of the metrics to be used in calculating the similarity (e.g., `c("acousticness", "danceability", "energy", "valence")`).</span></span>
<span id="cb18-1199"><a href="#cb18-1199" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-1200"><a href="#cb18-1200" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @return A data frame with songs that are similar to the input song, based on the Euclidean distance between their metric values. The songs are filtered by a distance threshold of 2.5, </span></span>
<span id="cb18-1201"><a href="#cb18-1201" aria-hidden="true" tabindex="-1"></a><span class="in">  #'         and they are ordered by their proximity to the input song.</span></span>
<span id="cb18-1202"><a href="#cb18-1202" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-1203"><a href="#cb18-1203" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @details The function scales the metrics for all songs in the same year as the input song and calculates the Euclidean distance between the input song's metrics and each song's metrics.</span></span>
<span id="cb18-1204"><a href="#cb18-1204" aria-hidden="true" tabindex="-1"></a><span class="in">  #'          The distance is computed as the square root of the sum of squared differences between the selected metrics of the input song and each candidate song.</span></span>
<span id="cb18-1205"><a href="#cb18-1205" aria-hidden="true" tabindex="-1"></a><span class="in">  #'          Only songs with a distance smaller than 2.5 are considered similar.</span></span>
<span id="cb18-1206"><a href="#cb18-1206" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-1207"><a href="#cb18-1207" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @examples</span></span>
<span id="cb18-1208"><a href="#cb18-1208" aria-hidden="true" tabindex="-1"></a><span class="in">  #' # Assuming `song` and `std_songs` are data frames with appropriate structure</span></span>
<span id="cb18-1209"><a href="#cb18-1209" aria-hidden="true" tabindex="-1"></a><span class="in">  #' similar_songs &lt;- calculate_similar_songs(song = song_data, std_songs = song_dataset, metrics = c("acousticness", "danceability", "energy"))</span></span>
<span id="cb18-1210"><a href="#cb18-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  #'</span></span>
<span id="cb18-1211"><a href="#cb18-1211" aria-hidden="true" tabindex="-1"></a><span class="in">  #' @export</span></span>
<span id="cb18-1212"><a href="#cb18-1212" aria-hidden="true" tabindex="-1"></a><span class="in">  calculate_similar_songs &lt;- function(song, std_songs, metrics) {</span></span>
<span id="cb18-1213"><a href="#cb18-1213" aria-hidden="true" tabindex="-1"></a><span class="in">    # Filter for songs from the same year and apply scaling to the metrics</span></span>
<span id="cb18-1214"><a href="#cb18-1214" aria-hidden="true" tabindex="-1"></a><span class="in">    std_songs_scaled &lt;- std_songs |&gt;</span></span>
<span id="cb18-1215"><a href="#cb18-1215" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-1216"><a href="#cb18-1216" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(year == unique(song |&gt; pull(year))) |&gt;</span></span>
<span id="cb18-1217"><a href="#cb18-1217" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(across(all_of(metrics), scale))</span></span>
<span id="cb18-1218"><a href="#cb18-1218" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-1219"><a href="#cb18-1219" aria-hidden="true" tabindex="-1"></a><span class="in">    # Get the song vector (metrics for the current song)</span></span>
<span id="cb18-1220"><a href="#cb18-1220" aria-hidden="true" tabindex="-1"></a><span class="in">    song_vec &lt;- std_songs_scaled |&gt;</span></span>
<span id="cb18-1221"><a href="#cb18-1221" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(track_id == unique(song |&gt; pull(track_id))) |&gt;</span></span>
<span id="cb18-1222"><a href="#cb18-1222" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-1223"><a href="#cb18-1223" aria-hidden="true" tabindex="-1"></a><span class="in">      select(all_of(metrics)) |&gt;</span></span>
<span id="cb18-1224"><a href="#cb18-1224" aria-hidden="true" tabindex="-1"></a><span class="in">      as.numeric()</span></span>
<span id="cb18-1225"><a href="#cb18-1225" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-1226"><a href="#cb18-1226" aria-hidden="true" tabindex="-1"></a><span class="in">    # Assign proper names to the song vector based on metrics</span></span>
<span id="cb18-1227"><a href="#cb18-1227" aria-hidden="true" tabindex="-1"></a><span class="in">    names(song_vec) &lt;- metrics</span></span>
<span id="cb18-1228"><a href="#cb18-1228" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb18-1229"><a href="#cb18-1229" aria-hidden="true" tabindex="-1"></a><span class="in">    # Calculate the distance for each song</span></span>
<span id="cb18-1230"><a href="#cb18-1230" aria-hidden="true" tabindex="-1"></a><span class="in">    similar_songs &lt;- std_songs_scaled |&gt;</span></span>
<span id="cb18-1231"><a href="#cb18-1231" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(distance = sqrt(</span></span>
<span id="cb18-1232"><a href="#cb18-1232" aria-hidden="true" tabindex="-1"></a><span class="in">        (acousticness - song_vec["acousticness"])^2 +</span></span>
<span id="cb18-1233"><a href="#cb18-1233" aria-hidden="true" tabindex="-1"></a><span class="in">          (danceability - song_vec["danceability"])^2 +</span></span>
<span id="cb18-1234"><a href="#cb18-1234" aria-hidden="true" tabindex="-1"></a><span class="in">          (energy - song_vec["energy"])^2 +</span></span>
<span id="cb18-1235"><a href="#cb18-1235" aria-hidden="true" tabindex="-1"></a><span class="in">          (instrumentalness - song_vec["instrumentalness"])^2 +</span></span>
<span id="cb18-1236"><a href="#cb18-1236" aria-hidden="true" tabindex="-1"></a><span class="in">          (liveness - song_vec["liveness"])^2 +</span></span>
<span id="cb18-1237"><a href="#cb18-1237" aria-hidden="true" tabindex="-1"></a><span class="in">          (loudness - song_vec["loudness"])^2 +</span></span>
<span id="cb18-1238"><a href="#cb18-1238" aria-hidden="true" tabindex="-1"></a><span class="in">          (speechiness - song_vec["speechiness"])^2 +</span></span>
<span id="cb18-1239"><a href="#cb18-1239" aria-hidden="true" tabindex="-1"></a><span class="in">          (valence - song_vec["valence"])^2</span></span>
<span id="cb18-1240"><a href="#cb18-1240" aria-hidden="true" tabindex="-1"></a><span class="in">      )) |&gt;</span></span>
<span id="cb18-1241"><a href="#cb18-1241" aria-hidden="true" tabindex="-1"></a><span class="in">      arrange(distance) |&gt;</span></span>
<span id="cb18-1242"><a href="#cb18-1242" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(distance &lt; 2)</span></span>
<span id="cb18-1243"><a href="#cb18-1243" aria-hidden="true" tabindex="-1"></a><span class="in">    # Return the result</span></span>
<span id="cb18-1244"><a href="#cb18-1244" aria-hidden="true" tabindex="-1"></a><span class="in">    return(similar_songs)</span></span>
<span id="cb18-1245"><a href="#cb18-1245" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1246"><a href="#cb18-1246" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-1247"><a href="#cb18-1247" aria-hidden="true" tabindex="-1"></a><span class="in">  anchor_songs &lt;- list(song1, song2)</span></span>
<span id="cb18-1248"><a href="#cb18-1248" aria-hidden="true" tabindex="-1"></a><span class="in">  # For loop to calculate similar songs for each song and bind the rows</span></span>
<span id="cb18-1249"><a href="#cb18-1249" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs) {</span></span>
<span id="cb18-1250"><a href="#cb18-1250" aria-hidden="true" tabindex="-1"></a><span class="in">    similar_songs &lt;- calculate_similar_songs(song, spotify_millions_songs, metrics)</span></span>
<span id="cb18-1251"><a href="#cb18-1251" aria-hidden="true" tabindex="-1"></a><span class="in">    all_similar_songs &lt;- bind_rows(all_similar_songs, similar_songs)</span></span>
<span id="cb18-1252"><a href="#cb18-1252" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1253"><a href="#cb18-1253" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(all_similar_songs, fname, row.names = FALSE)</span></span>
<span id="cb18-1254"><a href="#cb18-1254" aria-hidden="true" tabindex="-1"></a><span class="in">} else{</span></span>
<span id="cb18-1255"><a href="#cb18-1255" aria-hidden="true" tabindex="-1"></a><span class="in">    all_similar_songs &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-1256"><a href="#cb18-1256" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1257"><a href="#cb18-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1258"><a href="#cb18-1258" aria-hidden="true" tabindex="-1"></a><span class="in"># What songs are in the same decade and have a similar duration?</span></span>
<span id="cb18-1259"><a href="#cb18-1259" aria-hidden="true" tabindex="-1"></a><span class="in"># add decade to song data.frames</span></span>
<span id="cb18-1260"><a href="#cb18-1260" aria-hidden="true" tabindex="-1"></a><span class="in">song1 &lt;- song1 |&gt; mutate(decade = as.character((year %/% 10) * 10))</span></span>
<span id="cb18-1261"><a href="#cb18-1261" aria-hidden="true" tabindex="-1"></a><span class="in">song2 &lt;- song2 |&gt; mutate(decade = as.character((year %/% 10) * 10))</span></span>
<span id="cb18-1262"><a href="#cb18-1262" aria-hidden="true" tabindex="-1"></a><span class="in">anchor_songs &lt;- list(song1, song2)</span></span>
<span id="cb18-1263"><a href="#cb18-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1264"><a href="#cb18-1264" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- "data/mp03/decade_and_song_length.csv"</span></span>
<span id="cb18-1265"><a href="#cb18-1265" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists(fname)) {</span></span>
<span id="cb18-1266"><a href="#cb18-1266" aria-hidden="true" tabindex="-1"></a><span class="in">  decade_and_song_length &lt;- data.frame()</span></span>
<span id="cb18-1267"><a href="#cb18-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1268"><a href="#cb18-1268" aria-hidden="true" tabindex="-1"></a><span class="in">  for (song in anchor_songs) {</span></span>
<span id="cb18-1269"><a href="#cb18-1269" aria-hidden="true" tabindex="-1"></a><span class="in">    song_decade &lt;- unique(song$decade)</span></span>
<span id="cb18-1270"><a href="#cb18-1270" aria-hidden="true" tabindex="-1"></a><span class="in">    song_length &lt;- unique(song$duration)</span></span>
<span id="cb18-1271"><a href="#cb18-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1272"><a href="#cb18-1272" aria-hidden="true" tabindex="-1"></a><span class="in">    matched_songs &lt;- spotify_millions_songs |&gt;</span></span>
<span id="cb18-1273"><a href="#cb18-1273" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(</span></span>
<span id="cb18-1274"><a href="#cb18-1274" aria-hidden="true" tabindex="-1"></a><span class="in">        similar_duration = abs(duration - song_length) &lt;= 15 * 1000</span></span>
<span id="cb18-1275"><a href="#cb18-1275" aria-hidden="true" tabindex="-1"></a><span class="in">      ) |&gt; </span></span>
<span id="cb18-1276"><a href="#cb18-1276" aria-hidden="true" tabindex="-1"></a><span class="in">      filter(</span></span>
<span id="cb18-1277"><a href="#cb18-1277" aria-hidden="true" tabindex="-1"></a><span class="in">        decade == song_decade,</span></span>
<span id="cb18-1278"><a href="#cb18-1278" aria-hidden="true" tabindex="-1"></a><span class="in">        similar_duration</span></span>
<span id="cb18-1279"><a href="#cb18-1279" aria-hidden="true" tabindex="-1"></a><span class="in">      ) |&gt;</span></span>
<span id="cb18-1280"><a href="#cb18-1280" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-1281"><a href="#cb18-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1282"><a href="#cb18-1282" aria-hidden="true" tabindex="-1"></a><span class="in">    decade_and_song_length &lt;- bind_rows(decade_and_song_length, matched_songs)</span></span>
<span id="cb18-1283"><a href="#cb18-1283" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1284"><a href="#cb18-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1285"><a href="#cb18-1285" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(decade_and_song_length, fname, row.names = FALSE)</span></span>
<span id="cb18-1286"><a href="#cb18-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1287"><a href="#cb18-1287" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb18-1288"><a href="#cb18-1288" aria-hidden="true" tabindex="-1"></a><span class="in">  decade_and_song_length &lt;- readr::read_csv(fname)</span></span>
<span id="cb18-1289"><a href="#cb18-1289" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1290"><a href="#cb18-1290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-1291"><a href="#cb18-1291" aria-hidden="true" tabindex="-1"></a>The full list of candidate songs is shown below:</span>
<span id="cb18-1292"><a href="#cb18-1292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=TRUE}</span></span>
<span id="cb18-1293"><a href="#cb18-1293" aria-hidden="true" tabindex="-1"></a><span class="in">combined_heuristics |&gt;</span></span>
<span id="cb18-1294"><a href="#cb18-1294" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(heuristic_count &gt;= 2) |&gt;</span></span>
<span id="cb18-1295"><a href="#cb18-1295" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE) |&gt;</span></span>
<span id="cb18-1296"><a href="#cb18-1296" aria-hidden="true" tabindex="-1"></a><span class="in">  select(</span></span>
<span id="cb18-1297"><a href="#cb18-1297" aria-hidden="true" tabindex="-1"></a><span class="in">    "Track Name" = track_name,</span></span>
<span id="cb18-1298"><a href="#cb18-1298" aria-hidden="true" tabindex="-1"></a><span class="in">    "Artist Name" = artist_name,</span></span>
<span id="cb18-1299"><a href="#cb18-1299" aria-hidden="true" tabindex="-1"></a><span class="in">    "Album Name" = album_name,</span></span>
<span id="cb18-1300"><a href="#cb18-1300" aria-hidden="true" tabindex="-1"></a><span class="in">    "Year" = year</span></span>
<span id="cb18-1301"><a href="#cb18-1301" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb18-1302"><a href="#cb18-1302" aria-hidden="true" tabindex="-1"></a><span class="in">  datatable(</span></span>
<span id="cb18-1303"><a href="#cb18-1303" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = htmltools::tags$caption(</span></span>
<span id="cb18-1304"><a href="#cb18-1304" aria-hidden="true" tabindex="-1"></a><span class="in">      style = 'caption-side: top; text-align: left;',</span></span>
<span id="cb18-1305"><a href="#cb18-1305" aria-hidden="true" tabindex="-1"></a><span class="in">      'Table: ', htmltools::em('Songs Matching At Least 4 Compatibility Heuristics')</span></span>
<span id="cb18-1306"><a href="#cb18-1306" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb18-1307"><a href="#cb18-1307" aria-hidden="true" tabindex="-1"></a><span class="in">    options = list(</span></span>
<span id="cb18-1308"><a href="#cb18-1308" aria-hidden="true" tabindex="-1"></a><span class="in">      pageLength = 25,</span></span>
<span id="cb18-1309"><a href="#cb18-1309" aria-hidden="true" tabindex="-1"></a><span class="in">      scrollX = TRUE</span></span>
<span id="cb18-1310"><a href="#cb18-1310" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb18-1311"><a href="#cb18-1311" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb18-1312"><a href="#cb18-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-1313"><a href="#cb18-1313" aria-hidden="true" tabindex="-1"></a><span class="fu">### Selecting Playlist Songs</span></span>
<span id="cb18-1314"><a href="#cb18-1314" aria-hidden="true" tabindex="-1"></a>Since I wanted the playlist to have a deliberate "rise and fall," in mood, I decided to methodically control the valence of the playlist. Specifically, I shaped the playlist so that the valence of the selected songs would follow the shape of a sine wave, and create an emotional roller-coaster for listeners to ride.</span>
<span id="cb18-1315"><a href="#cb18-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1316"><a href="#cb18-1316" aria-hidden="true" tabindex="-1"></a>To implement this:</span>
<span id="cb18-1317"><a href="#cb18-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1318"><a href="#cb18-1318" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>I generated a cosine wave scaled between 0 and 1 to define the target valence levels for each of the 12 songs in the playlist.</span>
<span id="cb18-1319"><a href="#cb18-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1320"><a href="#cb18-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>I added the anchor songs to the playlist first, placing each one in the position where its valence most closely matched the wave.</span>
<span id="cb18-1321"><a href="#cb18-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1322"><a href="#cb18-1322" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Remaining slots were filled with songs from a filtered pool of candidates that met 2 or more compatibility heuristics (see definitions above). I also restricted the decade of the song to 1980.</span>
<span id="cb18-1323"><a href="#cb18-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1324"><a href="#cb18-1324" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>For each remaining position, I selected a song with a valence close to the target value. I allowed for a small tolerance to ensure flexibility in the song choice and still maintain the shape of the wave.</span>
<span id="cb18-1325"><a href="#cb18-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1326"><a href="#cb18-1326" aria-hidden="true" tabindex="-1"></a>The code for implementing this is shown below. </span>
<span id="cb18-1327"><a href="#cb18-1327" aria-hidden="true" tabindex="-1"></a><span class="in">``` {r, echo=TRUE}</span></span>
<span id="cb18-1328"><a href="#cb18-1328" aria-hidden="true" tabindex="-1"></a><span class="in"># Set seed for reproducibility</span></span>
<span id="cb18-1329"><a href="#cb18-1329" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb18-1330"><a href="#cb18-1330" aria-hidden="true" tabindex="-1"></a><span class="in">playlist_length &lt;- 12</span></span>
<span id="cb18-1331"><a href="#cb18-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1332"><a href="#cb18-1332" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate cosine wave to model valence progression</span></span>
<span id="cb18-1333"><a href="#cb18-1333" aria-hidden="true" tabindex="-1"></a><span class="in">valence_wave &lt;- (cos(seq(0, 2 * pi, length.out = playlist_length)) + 1) / 2</span></span>
<span id="cb18-1334"><a href="#cb18-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1335"><a href="#cb18-1335" aria-hidden="true" tabindex="-1"></a><span class="in"># Define valence similarity tolerance</span></span>
<span id="cb18-1336"><a href="#cb18-1336" aria-hidden="true" tabindex="-1"></a><span class="in">tolerance &lt;- 0.05</span></span>
<span id="cb18-1337"><a href="#cb18-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1338"><a href="#cb18-1338" aria-hidden="true" tabindex="-1"></a><span class="in"># Initialize empty playlist</span></span>
<span id="cb18-1339"><a href="#cb18-1339" aria-hidden="true" tabindex="-1"></a><span class="in">playlist &lt;- data.frame()</span></span>
<span id="cb18-1340"><a href="#cb18-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1341"><a href="#cb18-1341" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine anchor songs and ensure uniqueness</span></span>
<span id="cb18-1342"><a href="#cb18-1342" aria-hidden="true" tabindex="-1"></a><span class="in">base_songs &lt;- bind_rows(anchor_songs) |&gt; distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-1343"><a href="#cb18-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1344"><a href="#cb18-1344" aria-hidden="true" tabindex="-1"></a><span class="in"># Select high-confidence candidate songs</span></span>
<span id="cb18-1345"><a href="#cb18-1345" aria-hidden="true" tabindex="-1"></a><span class="in">candidates &lt;- combined_heuristics |&gt; </span></span>
<span id="cb18-1346"><a href="#cb18-1346" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(heuristic_count &gt;= 2, decade == '1980s') |&gt;</span></span>
<span id="cb18-1347"><a href="#cb18-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(track_id, .keep_all = TRUE)</span></span>
<span id="cb18-1348"><a href="#cb18-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1349"><a href="#cb18-1349" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a vector of available positions</span></span>
<span id="cb18-1350"><a href="#cb18-1350" aria-hidden="true" tabindex="-1"></a><span class="in">available_slots &lt;- 1:playlist_length</span></span>
<span id="cb18-1351"><a href="#cb18-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1352"><a href="#cb18-1352" aria-hidden="true" tabindex="-1"></a><span class="in"># Place anchor songs into playlist by matching valence to wave</span></span>
<span id="cb18-1353"><a href="#cb18-1353" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in seq_len(nrow(base_songs))) {</span></span>
<span id="cb18-1354"><a href="#cb18-1354" aria-hidden="true" tabindex="-1"></a><span class="in">  song &lt;- base_songs[i, ]</span></span>
<span id="cb18-1355"><a href="#cb18-1355" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(available_slots) == 0) break</span></span>
<span id="cb18-1356"><a href="#cb18-1356" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-1357"><a href="#cb18-1357" aria-hidden="true" tabindex="-1"></a><span class="in">  diffs &lt;- abs(valence_wave[available_slots] - song$valence)</span></span>
<span id="cb18-1358"><a href="#cb18-1358" aria-hidden="true" tabindex="-1"></a><span class="in">  best_slot &lt;- available_slots[which.min(diffs)]</span></span>
<span id="cb18-1359"><a href="#cb18-1359" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-1360"><a href="#cb18-1360" aria-hidden="true" tabindex="-1"></a><span class="in">  playlist &lt;- bind_rows(playlist, song)</span></span>
<span id="cb18-1361"><a href="#cb18-1361" aria-hidden="true" tabindex="-1"></a><span class="in">  available_slots &lt;- setdiff(available_slots, best_slot)</span></span>
<span id="cb18-1362"><a href="#cb18-1362" aria-hidden="true" tabindex="-1"></a><span class="in">  candidates &lt;- candidates |&gt; filter(track_id != song$track_id)</span></span>
<span id="cb18-1363"><a href="#cb18-1363" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1364"><a href="#cb18-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1365"><a href="#cb18-1365" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill remaining slots with best valence matches from candidates</span></span>
<span id="cb18-1366"><a href="#cb18-1366" aria-hidden="true" tabindex="-1"></a><span class="in">for (slot in available_slots) {</span></span>
<span id="cb18-1367"><a href="#cb18-1367" aria-hidden="true" tabindex="-1"></a><span class="in">  target_valence &lt;- valence_wave[slot]</span></span>
<span id="cb18-1368"><a href="#cb18-1368" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-1369"><a href="#cb18-1369" aria-hidden="true" tabindex="-1"></a><span class="in">  pool &lt;- candidates |&gt; filter(abs(valence - target_valence) &lt;= tolerance)</span></span>
<span id="cb18-1370"><a href="#cb18-1370" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-1371"><a href="#cb18-1371" aria-hidden="true" tabindex="-1"></a><span class="in">  # Expand tolerance if needed</span></span>
<span id="cb18-1372"><a href="#cb18-1372" aria-hidden="true" tabindex="-1"></a><span class="in">  if (nrow(pool) == 0) {</span></span>
<span id="cb18-1373"><a href="#cb18-1373" aria-hidden="true" tabindex="-1"></a><span class="in">    message(glue::glue("Widening tolerance at slot {slot}"))</span></span>
<span id="cb18-1374"><a href="#cb18-1374" aria-hidden="true" tabindex="-1"></a><span class="in">    pool &lt;- candidates |&gt; filter(abs(valence - target_valence) &lt;= (tolerance * 2))</span></span>
<span id="cb18-1375"><a href="#cb18-1375" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1376"><a href="#cb18-1376" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb18-1377"><a href="#cb18-1377" aria-hidden="true" tabindex="-1"></a><span class="in">  # Select one matching song if available</span></span>
<span id="cb18-1378"><a href="#cb18-1378" aria-hidden="true" tabindex="-1"></a><span class="in">  if (nrow(pool) &gt; 0) {</span></span>
<span id="cb18-1379"><a href="#cb18-1379" aria-hidden="true" tabindex="-1"></a><span class="in">    selected &lt;- sample_n(pool, 1)</span></span>
<span id="cb18-1380"><a href="#cb18-1380" aria-hidden="true" tabindex="-1"></a><span class="in">    playlist &lt;- bind_rows(playlist, selected)</span></span>
<span id="cb18-1381"><a href="#cb18-1381" aria-hidden="true" tabindex="-1"></a><span class="in">    candidates &lt;- candidates |&gt; filter(track_id != selected$track_id)</span></span>
<span id="cb18-1382"><a href="#cb18-1382" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb18-1383"><a href="#cb18-1383" aria-hidden="true" tabindex="-1"></a><span class="in">    message(glue::glue("No song could be placed at slot {slot}"))</span></span>
<span id="cb18-1384"><a href="#cb18-1384" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb18-1385"><a href="#cb18-1385" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb18-1386"><a href="#cb18-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1387"><a href="#cb18-1387" aria-hidden="true" tabindex="-1"></a><span class="in"># Add song position index</span></span>
<span id="cb18-1388"><a href="#cb18-1388" aria-hidden="true" tabindex="-1"></a><span class="in">playlist &lt;- playlist |&gt; mutate(position = row_number())</span></span>
<span id="cb18-1389"><a href="#cb18-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1390"><a href="#cb18-1390" aria-hidden="true" tabindex="-1"></a><span class="in"># Reshape for plotting</span></span>
<span id="cb18-1391"><a href="#cb18-1391" aria-hidden="true" tabindex="-1"></a><span class="in">playlist_long &lt;- playlist |&gt; pivot_longer(cols = all_of(metrics), names_to = "metric", values_to = "value")</span></span>
<span id="cb18-1392"><a href="#cb18-1392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-1393"><a href="#cb18-1393" aria-hidden="true" tabindex="-1"></a>The final result is an 80s playlist designed to, at some points, make you feel like you're about to hit 88 mph in Doc's Delorean, and at others, like you're slow-dancing alone at prom under a disco ball.</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>